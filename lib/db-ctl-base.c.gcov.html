<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - lib/db-ctl-base.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">lib</a> - db-ctl-base.c<span style="font-size: 80%;"> (source / <a href="db-ctl-base.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">921</td>
            <td class="headerCovTableEntry">968</td>
            <td class="headerCovTableEntryHi">95.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-09-14 01:02:56</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">71</td>
            <td class="headerCovTableEntry">72</td>
            <td class="headerCovTableEntryHi">98.6 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">492</td>
            <td class="headerCovTableEntry">578</td>
            <td class="headerCovTableEntryMed">85.1 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /*</a>
<span class="lineNum">       2 </span>                :            :  * Copyright (c) 2015, 2016 Nicira, Inc.
<span class="lineNum">       3 </span>                :            :  *
<span class="lineNum">       4 </span>                :            :  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class="lineNum">       5 </span>                :            :  * you may not use this file except in compliance with the License.
<span class="lineNum">       6 </span>                :            :  * You may obtain a copy of the License at:
<span class="lineNum">       7 </span>                :            :  *
<span class="lineNum">       8 </span>                :            :  *     http://www.apache.org/licenses/LICENSE-2.0
<span class="lineNum">       9 </span>                :            :  *
<span class="lineNum">      10 </span>                :            :  * Unless required by applicable law or agreed to in writing, software
<span class="lineNum">      11 </span>                :            :  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class="lineNum">      12 </span>                :            :  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class="lineNum">      13 </span>                :            :  * See the License for the specific language governing permissions and
<span class="lineNum">      14 </span>                :            :  * limitations under the License.
<span class="lineNum">      15 </span>                :            :  */
<span class="lineNum">      16 </span>                :            : 
<span class="lineNum">      17 </span>                :            : #include &lt;config.h&gt;
<span class="lineNum">      18 </span>                :            : 
<span class="lineNum">      19 </span>                :            : #include &lt;ctype.h&gt;
<span class="lineNum">      20 </span>                :            : #include &lt;getopt.h&gt;
<span class="lineNum">      21 </span>                :            : #include &lt;unistd.h&gt;
<span class="lineNum">      22 </span>                :            : 
<span class="lineNum">      23 </span>                :            : #include &quot;db-ctl-base.h&quot;
<span class="lineNum">      24 </span>                :            : 
<span class="lineNum">      25 </span>                :            : #include &quot;command-line.h&quot;
<span class="lineNum">      26 </span>                :            : #include &quot;compiler.h&quot;
<span class="lineNum">      27 </span>                :            : #include &quot;dirs.h&quot;
<span class="lineNum">      28 </span>                :            : #include &quot;openvswitch/dynamic-string.h&quot;
<span class="lineNum">      29 </span>                :            : #include &quot;fatal-signal.h&quot;
<span class="lineNum">      30 </span>                :            : #include &quot;hash.h&quot;
<span class="lineNum">      31 </span>                :            : #include &quot;openvswitch/json.h&quot;
<span class="lineNum">      32 </span>                :            : #include &quot;openvswitch/vlog.h&quot;
<span class="lineNum">      33 </span>                :            : #include &quot;ovsdb-data.h&quot;
<span class="lineNum">      34 </span>                :            : #include &quot;ovsdb-idl.h&quot;
<span class="lineNum">      35 </span>                :            : #include &quot;ovsdb-idl-provider.h&quot;
<span class="lineNum">      36 </span>                :            : #include &quot;openvswitch/shash.h&quot;
<span class="lineNum">      37 </span>                :            : #include &quot;sset.h&quot;
<span class="lineNum">      38 </span>                :            : #include &quot;string.h&quot;
<span class="lineNum">      39 </span>                :            : #include &quot;table.h&quot;
<a name="40"><span class="lineNum">      40 </span>                :            : #include &quot;util.h&quot;</a>
<span class="lineNum">      41 </span>                :            : 
<span class="lineNum">      42 </span>                :<span class="lineCov">      12916 : VLOG_DEFINE_THIS_MODULE(db_ctl_base);</span>
<span class="lineNum">      43 </span>                :            : 
<span class="lineNum">      44 </span>                :            : /* This array defines the 'show' command output format.  User can check the
<span class="lineNum">      45 </span>                :            :  * definition in utilities/ovs-vsctl.c as reference.
<span class="lineNum">      46 </span>                :            :  *
<span class="lineNum">      47 </span>                :            :  * Particularly, if an element in 'columns[]' represents a reference to
<span class="lineNum">      48 </span>                :            :  * another table, the referred table must also be defined as an entry in
<span class="lineNum">      49 </span>                :            :  * in 'cmd_show_tables[]'.
<span class="lineNum">      50 </span>                :            :  *
<span class="lineNum">      51 </span>                :            :  * The definition must end with an all-NULL entry.  It is initalized once
<span class="lineNum">      52 </span>                :            :  * when ctl_init() is called.
<span class="lineNum">      53 </span>                :            :  *
<span class="lineNum">      54 </span>                :            :  * */
<span class="lineNum">      55 </span>                :            : static const struct cmd_show_table *cmd_show_tables;
<span class="lineNum">      56 </span>                :            : 
<span class="lineNum">      57 </span>                :            : /* ctl_exit() is called by ctl_fatal(). User can optionally supply an exit
<span class="lineNum">      58 </span>                :            :  * function ctl_exit_func() via ctl_init. If supplied, this function will
<span class="lineNum">      59 </span>                :            :  * be called by ctl_exit()
<span class="lineNum">      60 </span>                :            :  */
<span class="lineNum">      61 </span>                :            : static void (*ctl_exit_func)(int status) = NULL;
<span class="lineNum">      62 </span>                :            : OVS_NO_RETURN static void ctl_exit(int status);
<span class="lineNum">      63 </span>                :            : 
<span class="lineNum">      64 </span>                :            : /* Represents all tables in the schema.  User must define 'tables'
<span class="lineNum">      65 </span>                :            :  * in implementation and supply via ctl_init().  The definition must end
<span class="lineNum">      66 </span>                :            :  * with an all-NULL entry. */
<span class="lineNum">      67 </span>                :            : static const struct ctl_table_class *tables;
<span class="lineNum">      68 </span>                :            : 
<span class="lineNum">      69 </span>                :            : static struct shash all_commands = SHASH_INITIALIZER(&amp;all_commands);
<span class="lineNum">      70 </span>                :            : static const struct ctl_table_class *get_table(const char *table_name);
<span class="lineNum">      71 </span>                :            : static void set_column(const struct ctl_table_class *,
<span class="lineNum">      72 </span>                :            :                        const struct ovsdb_idl_row *, const char *,
<span class="lineNum">      73 </span>                :            :                        struct ovsdb_symbol_table *);
<span class="lineNum">      74 </span>                :            : 
<a name="75"><span class="lineNum">      75 </span>                :            : </a>
<span class="lineNum">      76 </span>                :            : static struct option *
<span class="lineNum">      77 </span>                :<span class="lineCov">     142201 : find_option(const char *name, struct option *options, size_t n_options)</span>
<span class="lineNum">      78 </span>                :            : {
<span class="lineNum">      79 </span>                :            :     size_t i;
<span class="lineNum">      80 </span>                :            : 
<span class="lineNum">      81 </span>        [<span class="branchCov" title="Branch 0 was taken 3818604 times"> + </span><span class="branchCov" title="Branch 1 was taken 57326 times"> + </span>]:<span class="lineCov">    3875930 :     for (i = 0; i &lt; n_options; i++) {</span>
<span class="lineNum">      82 </span>        [<span class="branchCov" title="Branch 0 was taken 84875 times"> + </span><span class="branchCov" title="Branch 1 was taken 3733729 times"> + </span>]:<span class="lineCov">    3818604 :         if (!strcmp(options[i].name, name)) {</span>
<span class="lineNum">      83 </span>                :<span class="lineCov">      84875 :             return &amp;options[i];</span>
<span class="lineNum">      84 </span>                :            :         }
<span class="lineNum">      85 </span>                :            :     }
<span class="lineNum">      86 </span>                :<span class="lineCov">      57326 :     return NULL;</span>
<span class="lineNum">      87 </span>                :            : }
<a name="88"><span class="lineNum">      88 </span>                :            : </a>
<span class="lineNum">      89 </span>                :            : static struct option *
<span class="lineNum">      90 </span>                :<span class="lineCov">      63784 : add_option(struct option **optionsp, size_t *n_optionsp,</span>
<span class="lineNum">      91 </span>                :            :            size_t *allocated_optionsp)
<span class="lineNum">      92 </span>                :            : {
<span class="lineNum">      93 </span>        [<span class="branchCov" title="Branch 0 was taken 6458 times"> + </span><span class="branchCov" title="Branch 1 was taken 57326 times"> + </span>]:<span class="lineCov">      63784 :     if (*n_optionsp &gt;= *allocated_optionsp) {</span>
<span class="lineNum">      94 </span>                :<span class="lineCov">       6458 :         *optionsp = x2nrealloc(*optionsp, allocated_optionsp,</span>
<span class="lineNum">      95 </span>                :            :                                sizeof **optionsp);
<span class="lineNum">      96 </span>                :            :     }
<span class="lineNum">      97 </span>                :<span class="lineCov">      63784 :     return &amp;(*optionsp)[(*n_optionsp)++];</span>
<span class="lineNum">      98 </span>                :            : }
<span class="lineNum">      99 </span>                :            : 
<span class="lineNum">     100 </span>                :            : /* Converts the command arguments into format that can be parsed by
<span class="lineNum">     101 </span>                :            :  * bash completion script.
<span class="lineNum">     102 </span>                :            :  *
<span class="lineNum">     103 </span>                :            :  * Therein, arguments will be attached with following prefixes:
<span class="lineNum">     104 </span>                :            :  *
<span class="lineNum">     105 </span>                :            :  *    !argument :: The argument is required
<span class="lineNum">     106 </span>                :            :  *    ?argument :: The argument is optional
<span class="lineNum">     107 </span>                :            :  *    *argument :: The argument may appear any number (0 or more) times
<span class="lineNum">     108 </span>                :            :  *    +argument :: The argument may appear one or more times
<span class="lineNum">     109 </span>                :            :  *
<a name="110"><span class="lineNum">     110 </span>                :            :  */</a>
<span class="lineNum">     111 </span>                :            : static void
<span class="lineNum">     112 </span>                :<span class="lineCov">       2464 : print_command_arguments(const struct ctl_command_syntax *command)</span>
<span class="lineNum">     113 </span>                :            : {
<span class="lineNum">     114 </span>                :            :     /*
<span class="lineNum">     115 </span>                :            :      * The argument string is parsed in reverse.  We use a stack 'oew_stack' to
<span class="lineNum">     116 </span>                :            :      * keep track of nested optionals.  Whenever a ']' is encountered, we push
<span class="lineNum">     117 </span>                :            :      * a bit to 'oew_stack'.  The bit is set to 1 if the ']' is not nested.
<span class="lineNum">     118 </span>                :            :      * Subsequently, we pop an entry everytime '[' is met.
<span class="lineNum">     119 </span>                :            :      *
<span class="lineNum">     120 </span>                :            :      * We use 'whole_word_is_optional' value to decide whether or not a ! or +
<span class="lineNum">     121 </span>                :            :      * should be added on encountering a space: if the optional surrounds the
<span class="lineNum">     122 </span>                :            :      * whole word then it shouldn't be, but if it is only a part of the word
<span class="lineNum">     123 </span>                :            :      * (i.e. [key=]value), it should be.
<span class="lineNum">     124 </span>                :            :      */
<span class="lineNum">     125 </span>                :<span class="lineCov">       2464 :     uint32_t oew_stack = 0;</span>
<span class="lineNum">     126 </span>                :            : 
<span class="lineNum">     127 </span>                :<span class="lineCov">       2464 :     const char *arguments = command-&gt;arguments;</span>
<span class="lineNum">     128 </span>                :<span class="lineCov">       2464 :     int length = strlen(arguments);</span>
<span class="lineNum">     129 </span>        [<span class="branchCov" title="Branch 0 was taken 448 times"> + </span><span class="branchCov" title="Branch 1 was taken 2016 times"> + </span>]:<span class="lineCov">       2464 :     if (!length) {</span>
<span class="lineNum">     130 </span>                :<span class="lineCov">        448 :         return;</span>
<span class="lineNum">     131 </span>                :            :     }
<span class="lineNum">     132 </span>                :            : 
<span class="lineNum">     133 </span>                :            :     /* Output buffer, written backward from end. */
<span class="lineNum">     134 </span>                :<span class="lineCov">       2016 :     char *output = xmalloc(2 * length);</span>
<span class="lineNum">     135 </span>                :<span class="lineCov">       2016 :     char *outp = output + 2 * length;</span>
<span class="lineNum">     136 </span>                :<span class="lineCov">       2016 :     *--outp = '\0';</span>
<span class="lineNum">     137 </span>                :            : 
<span class="lineNum">     138 </span>                :<span class="lineCov">       2016 :     bool in_repeated = false;</span>
<span class="lineNum">     139 </span>                :<span class="lineCov">       2016 :     bool whole_word_is_optional = false;</span>
<span class="lineNum">     140 </span>                :            : 
<span class="lineNum">     141 </span>        [<span class="branchCov" title="Branch 0 was taken 35840 times"> + </span><span class="branchCov" title="Branch 1 was taken 2016 times"> + </span>]:<span class="lineCov">      37856 :     for (const char *inp = arguments + length; inp &gt; arguments; ) {</span>
<span class="lineNum">     142 </span>  [<span class="branchCov" title="Branch 0 was taken 1176 times"> + </span><span class="branchCov" title="Branch 1 was taken 1176 times"> + </span><span class="branchCov" title="Branch 2 was taken 2072 times"> + </span><span class="branchCov" title="Branch 3 was taken 2688 times"> + </span> :<span class="lineCov">      35840 :         switch (*--inp) {</span>
<span class="lineNum">         </span>            <span class="branchCov" title="Branch 4 was taken 28728 times"> + </span>]
<span class="lineNum">     143 </span>                :            :         case ']':
<span class="lineNum">     144 </span>                :<span class="lineCov">       1176 :             oew_stack &lt;&lt;= 1;</span>
<span class="lineNum">     145 </span>[<span class="branchCov" title="Branch 0 was taken 1008 times"> + </span><span class="branchCov" title="Branch 1 was taken 168 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 896 times"> + </span><span class="branchCov" title="Branch 3 was taken 112 times"> + </span>]:<span class="lineCov">       1176 :             if (inp[1] == '\0' || inp[1] == ' ' || inp[1] == '.') {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 448 times"> + </span><span class="branchCov" title="Branch 5 was taken 448 times"> + </span>]
<span class="lineNum">     146 </span>                :<span class="lineCov">        728 :                 oew_stack |= 1;</span>
<span class="lineNum">     147 </span>                :            :             }
<span class="lineNum">     148 </span>                :<span class="lineCov">       1176 :             break;</span>
<span class="lineNum">     149 </span>                :            :         case '[':
<span class="lineNum">     150 </span>                :            :             /* Checks if the whole word is optional, and sets the
<span class="lineNum">     151 </span>                :            :              * 'whole_word_is_optional' accordingly. */
<span class="lineNum">     152 </span>[<span class="branchCov" title="Branch 0 was taken 1064 times"> + </span><span class="branchCov" title="Branch 1 was taken 112 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 672 times"> + </span><span class="branchCov" title="Branch 3 was taken 392 times"> + </span>]:<span class="lineCov">       1176 :             if ((inp == arguments || inp[-1] == ' ') &amp;&amp; oew_stack &amp; 1) {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 728 times"> + </span><span class="branchCov" title="Branch 5 was taken 56 times"> + </span>]
<span class="lineNum">     153 </span>        [<span class="branchCov" title="Branch 0 was taken 448 times"> + </span><span class="branchCov" title="Branch 1 was taken 280 times"> + </span>]:<span class="lineCov">        728 :                 *--outp = in_repeated ? '*' : '?';</span>
<span class="lineNum">     154 </span>                :<span class="lineCov">        728 :                 whole_word_is_optional = true;</span>
<span class="lineNum">     155 </span>                :            :             } else {
<span class="lineNum">     156 </span>                :<span class="lineCov">        448 :                 *--outp = '?';</span>
<span class="lineNum">     157 </span>                :<span class="lineCov">        448 :                 whole_word_is_optional = false;</span>
<span class="lineNum">     158 </span>                :            :             }
<span class="lineNum">     159 </span>                :<span class="lineCov">       1176 :             oew_stack &gt;&gt;= 1;</span>
<span class="lineNum">     160 </span>                :<span class="lineCov">       1176 :             break;</span>
<span class="lineNum">     161 </span>                :            :         case ' ':
<span class="lineNum">     162 </span>        [<span class="branchCov" title="Branch 0 was taken 1456 times"> + </span><span class="branchCov" title="Branch 1 was taken 616 times"> + </span>]:<span class="lineCov">       2072 :             if (!whole_word_is_optional) {</span>
<span class="lineNum">     163 </span>        [<span class="branchCov" title="Branch 0 was taken 392 times"> + </span><span class="branchCov" title="Branch 1 was taken 1064 times"> + </span>]:<span class="lineCov">       1456 :                 *--outp = in_repeated ? '+' : '!';</span>
<span class="lineNum">     164 </span>                :            :             }
<span class="lineNum">     165 </span>                :<span class="lineCov">       2072 :             *--outp = ' ';</span>
<span class="lineNum">     166 </span>                :<span class="lineCov">       2072 :             in_repeated = false;</span>
<span class="lineNum">     167 </span>                :<span class="lineCov">       2072 :             whole_word_is_optional = false;</span>
<span class="lineNum">     168 </span>                :<span class="lineCov">       2072 :             break;</span>
<span class="lineNum">     169 </span>                :            :         case '.':
<span class="lineNum">     170 </span>                :<span class="lineCov">       2688 :             in_repeated = true;</span>
<span class="lineNum">     171 </span>                :<span class="lineCov">       2688 :             break;</span>
<span class="lineNum">     172 </span>                :            :         default:
<span class="lineNum">     173 </span>                :<span class="lineCov">      28728 :             *--outp = *inp;</span>
<span class="lineNum">     174 </span>                :<span class="lineCov">      28728 :             break;</span>
<span class="lineNum">     175 </span>                :            :         }
<span class="lineNum">     176 </span>                :            :     }
<span class="lineNum">     177 </span>[<span class="branchCov" title="Branch 0 was taken 1904 times"> + </span><span class="branchCov" title="Branch 1 was taken 112 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1904 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2016 :     if (arguments[0] != '[' &amp;&amp; outp != output + 2 * length - 1) {</span>
<span class="lineNum">     178 </span>        [<span class="branchCov" title="Branch 0 was taken 56 times"> + </span><span class="branchCov" title="Branch 1 was taken 1848 times"> + </span>]:<span class="lineCov">       1904 :         *--outp = in_repeated ? '+' : '!';</span>
<span class="lineNum">     179 </span>                :            :     }
<span class="lineNum">     180 </span>                :<span class="lineCov">       2016 :     printf(&quot;%s&quot;, outp);</span>
<span class="lineNum">     181 </span>                :<span class="lineCov">       2016 :     free(output);</span>
<span class="lineNum">     182 </span>                :            : }
<a name="183"><span class="lineNum">     183 </span>                :            : </a>
<span class="lineNum">     184 </span>                :            : static void
<span class="lineNum">     185 </span>                :<span class="lineCov">      42092 : die_if_error(char *error)</span>
<span class="lineNum">     186 </span>                :            : {
<span class="lineNum">     187 </span>        [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchCov" title="Branch 1 was taken 42079 times"> + </span>]:<span class="lineCov">      42092 :     if (error) {</span>
<span class="lineNum">     188 </span>                :<span class="lineCov">         13 :         ctl_fatal(&quot;%s&quot;, error);</span>
<span class="lineNum">     189 </span>                :            :     }
<span class="lineNum">     190 </span>                :<span class="lineCov">      42079 : }</span>
<a name="191"><span class="lineNum">     191 </span>                :            : </a>
<span class="lineNum">     192 </span>                :            : static int
<span class="lineNum">     193 </span>                :<span class="lineCov">    1755704 : to_lower_and_underscores(unsigned c)</span>
<span class="lineNum">     194 </span>                :            : {
<span class="lineNum">     195 </span>        [<span class="branchCov" title="Branch 0 was taken 1746837 times"> + </span><span class="branchCov" title="Branch 1 was taken 8867 times"> + </span>]:<span class="lineCov">    1755704 :     return c == '-' ? '_' : tolower(c);</span>
<span class="lineNum">     196 </span>                :            : }
<a name="197"><span class="lineNum">     197 </span>                :            : </a>
<span class="lineNum">     198 </span>                :            : static unsigned int
<span class="lineNum">     199 </span>                :<span class="lineCov">     688389 : score_partial_match(const char *name, const char *s)</span>
<span class="lineNum">     200 </span>                :            : {
<span class="lineNum">     201 </span>                :            :     int score;
<span class="lineNum">     202 </span>                :            : 
<span class="lineNum">     203 </span>        [<span class="branchCov" title="Branch 0 was taken 19850 times"> + </span><span class="branchCov" title="Branch 1 was taken 668539 times"> + </span>]:<span class="lineCov">     688389 :     if (!strcmp(name, s)) {</span>
<span class="lineNum">     204 </span>                :<span class="lineCov">      19850 :         return UINT_MAX;</span>
<span class="lineNum">     205 </span>                :            :     }
<span class="lineNum">     206 </span>                :<span class="lineCov">     668539 :     for (score = 0; ; score++, name++, s++) {</span>
<span class="lineNum">     207 </span>        [<span class="branchCov" title="Branch 2 was taken 658441 times"> + </span><span class="branchCov" title="Branch 3 was taken 219411 times"> + </span>]:<span class="lineCov">     877852 :         if (to_lower_and_underscores(*name) != to_lower_and_underscores(*s)) {</span>
<span class="lineNum">     208 </span>                :<span class="lineCov">     658441 :             break;</span>
<span class="lineNum">     209 </span>        [<span class="branchCov" title="Branch 0 was taken 10098 times"> + </span><span class="branchCov" title="Branch 1 was taken 209313 times"> + </span>]:<span class="lineCov">     219411 :         } else if (*name == '\0') {</span>
<span class="lineNum">     210 </span>                :<span class="lineCov">      10098 :             return UINT_MAX - 1;</span>
<span class="lineNum">     211 </span>                :            :         }
<span class="lineNum">     212 </span>                :<span class="lineCov">     209313 :     }</span>
<span class="lineNum">     213 </span>        [<span class="branchCov" title="Branch 0 was taken 2201 times"> + </span><span class="branchCov" title="Branch 1 was taken 656240 times"> + </span>]:<span class="lineCov">     658441 :     return *s == '\0' ? score : 0;</span>
<span class="lineNum">     214 </span>                :            : }
<a name="215"><span class="lineNum">     215 </span>                :            : </a>
<span class="lineNum">     216 </span>                :            : static struct ovsdb_symbol *
<span class="lineNum">     217 </span>                :<span class="lineCov">        139 : create_symbol(struct ovsdb_symbol_table *symtab, const char *id, bool *newp)</span>
<span class="lineNum">     218 </span>                :            : {
<span class="lineNum">     219 </span>                :            :     struct ovsdb_symbol *symbol;
<span class="lineNum">     220 </span>                :            : 
<span class="lineNum">     221 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 139 times"> + </span>]:<span class="lineCov">        139 :     if (id[0] != '@') {</span>
<span class="lineNum">     222 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;row id \&quot;%s\&quot; does not begin with \&quot;@\&quot;&quot;, id);</span>
<span class="lineNum">     223 </span>                :            :     }
<span class="lineNum">     224 </span>                :            : 
<span class="lineNum">     225 </span>        [<span class="branchCov" title="Branch 0 was taken 31 times"> + </span><span class="branchCov" title="Branch 1 was taken 108 times"> + </span>]:<span class="lineCov">        139 :     if (newp) {</span>
<span class="lineNum">     226 </span>                :<span class="lineCov">         31 :         *newp = ovsdb_symbol_table_get(symtab, id) == NULL;</span>
<span class="lineNum">     227 </span>                :            :     }
<span class="lineNum">     228 </span>                :            : 
<span class="lineNum">     229 </span>                :<span class="lineCov">        139 :     symbol = ovsdb_symbol_table_insert(symtab, id);</span>
<span class="lineNum">     230 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 139 times"> + </span>]:<span class="lineCov">        139 :     if (symbol-&gt;created) {</span>
<span class="lineNum">     231 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;row id \&quot;%s\&quot; may only be specified on one --id option&quot;,</span>
<span class="lineNum">     232 </span>                :            :                   id);
<span class="lineNum">     233 </span>                :            :     }
<span class="lineNum">     234 </span>                :<span class="lineCov">        139 :     symbol-&gt;created = true;</span>
<span class="lineNum">     235 </span>                :<span class="lineCov">        139 :     return symbol;</span>
<span class="lineNum">     236 </span>                :            : }
<a name="237"><span class="lineNum">     237 </span>                :            : </a>
<span class="lineNum">     238 </span>                :            : static const struct ovsdb_idl_row *
<span class="lineNum">     239 </span>                :<span class="lineCov">       4558 : get_row_by_id(struct ctl_context *ctx, const struct ctl_table_class *table,</span>
<span class="lineNum">     240 </span>                :            :               const struct ctl_row_id *id, const char *record_id)
<span class="lineNum">     241 </span>                :            : {
<span class="lineNum">     242 </span>                :            :     const struct ovsdb_idl_row *referrer, *final;
<span class="lineNum">     243 </span>                :            : 
<span class="lineNum">     244 </span>        [<span class="branchCov" title="Branch 0 was taken 20 times"> + </span><span class="branchCov" title="Branch 1 was taken 4538 times"> + </span>]:<span class="lineCov">       4558 :     if (!id-&gt;table) {</span>
<span class="lineNum">     245 </span>                :<span class="lineCov">         20 :         return NULL;</span>
<span class="lineNum">     246 </span>                :            :     }
<span class="lineNum">     247 </span>                :            : 
<span class="lineNum">     248 </span>        [<span class="branchCov" title="Branch 0 was taken 251 times"> + </span><span class="branchCov" title="Branch 1 was taken 4287 times"> + </span>]:<span class="lineCov">       4538 :     if (!id-&gt;name_column) {</span>
<span class="lineNum">     249 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 242 times"> + </span>]:<span class="lineCov">        251 :         if (strcmp(record_id, &quot;.&quot;)) {</span>
<span class="lineNum">     250 </span>                :<span class="lineCov">          9 :             return NULL;</span>
<span class="lineNum">     251 </span>                :            :         }
<span class="lineNum">     252 </span>                :<span class="lineCov">        242 :         referrer = ovsdb_idl_first_row(ctx-&gt;idl, id-&gt;table);</span>
<span class="lineNum">     253 </span>[<span class="branchCov" title="Branch 0 was taken 242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 242 times"> + </span>]:<span class="lineCov">        242 :         if (!referrer || ovsdb_idl_next_row(referrer)) {</span>
<span class="lineNum">     254 </span>                :<span class="lineNoCov">          0 :             return NULL;</span>
<span class="lineNum">     255 </span>                :            :         }
<span class="lineNum">     256 </span>                :            :     } else {
<span class="lineNum">     257 </span>                :<span class="lineCov">       4287 :         referrer = NULL;</span>
<span class="lineNum">     258 </span>                :            : 
<span class="lineNum">     259 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 4287 times"> + </span>]:<span class="lineCov">       4287 :         ovs_assert(id-&gt;name_column-&gt;type.value.type == OVSDB_TYPE_VOID);</span>
<span class="lineNum">     260 </span>                :            : 
<span class="lineNum">     261 </span>                :<span class="lineCov">       4287 :         enum ovsdb_atomic_type key = id-&gt;name_column-&gt;type.key.type;</span>
<span class="lineNum">     262 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 4285 times"> + </span>]:<span class="lineCov">       4287 :         if (key == OVSDB_TYPE_INTEGER) {</span>
<span class="lineNum">     263 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">          2 :             if (!record_id[0] || record_id[strspn(record_id, &quot;0123456789&quot;)]) {</span>
<span class="lineNum">     264 </span>                :<span class="lineNoCov">          0 :                 return NULL;</span>
<span class="lineNum">     265 </span>                :            :             }
<span class="lineNum">     266 </span>                :            :         } else {
<span class="lineNum">     267 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 4285 times"> + </span>]:<span class="lineCov">       4285 :             ovs_assert(key == OVSDB_TYPE_STRING);</span>
<span class="lineNum">     268 </span>                :            :         }
<span class="lineNum">     269 </span>                :            : 
<span class="lineNum">     270 </span>        [<span class="branchCov" title="Branch 1 was taken 35020 times"> + </span><span class="branchCov" title="Branch 2 was taken 4286 times"> + </span>]:<span class="lineCov">      39306 :         for (const struct ovsdb_idl_row *row = ovsdb_idl_first_row(ctx-&gt;idl,</span>
<span class="lineNum">     271 </span>                :            :                                                                    id-&gt;table);
<span class="lineNum">     272 </span>                :            :              row != NULL;
<span class="lineNum">     273 </span>                :<span class="lineCov">      35019 :              row = ovsdb_idl_next_row(row)) {</span>
<span class="lineNum">     274 </span>                :<span class="lineCov">      35020 :             const struct ovsdb_datum *name = ovsdb_idl_get(</span>
<span class="lineNum">     275 </span>                :            :                 row, id-&gt;name_column, key, OVSDB_TYPE_VOID);
<span class="lineNum">     276 </span>        [<span class="branchCov" title="Branch 0 was taken 35020 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">      35020 :             if (name-&gt;n == 1) {</span>
<span class="lineNum">     277 </span>                :<span class="lineCov">      35020 :                 const union ovsdb_atom *atom = &amp;name-&gt;keys[0];</span>
<span class="lineNum">     278 </span>[<span class="branchCov" title="Branch 0 was taken 35018 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 4259 times"> + </span><span class="branchCov" title="Branch 3 was taken 30761 times"> + </span>]:<span class="lineCov">      35022 :                 if (key == OVSDB_TYPE_STRING</span>
<span class="lineNum">     279 </span>                :<span class="lineCov">      35018 :                     ? !strcmp(atom-&gt;string, record_id)</span>
<span class="lineNum">     280 </span>                :<span class="lineCov">          2 :                     : atom-&gt;integer == strtoll(record_id, NULL, 10)) {</span>
<span class="lineNum">     281 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 4258 times"> + </span>]:<span class="lineCov">       4259 :                     if (referrer) {</span>
<span class="lineNum">     282 </span>                :<span class="lineCov">          1 :                         ctl_fatal(&quot;multiple rows in %s match \&quot;%s\&quot;&quot;,</span>
<span class="lineNum">     283 </span>                :<span class="lineCov">          1 :                                   table-&gt;class-&gt;name, record_id);</span>
<span class="lineNum">     284 </span>                :            :                     }
<span class="lineNum">     285 </span>                :<span class="lineCov">       4258 :                     referrer = row;</span>
<span class="lineNum">     286 </span>                :            :                 }
<span class="lineNum">     287 </span>                :            :             }
<span class="lineNum">     288 </span>                :            :         }
<span class="lineNum">     289 </span>                :            :     }
<span class="lineNum">     290 </span>        [<span class="branchCov" title="Branch 0 was taken 29 times"> + </span><span class="branchCov" title="Branch 1 was taken 4499 times"> + </span>]:<span class="lineCov">       4528 :     if (!referrer) {</span>
<span class="lineNum">     291 </span>                :<span class="lineCov">         29 :         return NULL;</span>
<span class="lineNum">     292 </span>                :            :     }
<span class="lineNum">     293 </span>                :            : 
<span class="lineNum">     294 </span>                :<span class="lineCov">       4499 :     final = NULL;</span>
<span class="lineNum">     295 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 4497 times"> + </span>]:<span class="lineCov">       4499 :     if (id-&gt;uuid_column) {</span>
<span class="lineNum">     296 </span>                :            :         const struct ovsdb_datum *uuid;
<span class="lineNum">     297 </span>                :            : 
<span class="lineNum">     298 </span>                :<span class="lineCov">          2 :         ovsdb_idl_txn_verify(referrer, id-&gt;uuid_column);</span>
<span class="lineNum">     299 </span>                :<span class="lineCov">          2 :         uuid = ovsdb_idl_get(referrer, id-&gt;uuid_column,</span>
<span class="lineNum">     300 </span>                :            :                              OVSDB_TYPE_UUID, OVSDB_TYPE_VOID);
<span class="lineNum">     301 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :         if (uuid-&gt;n == 1) {</span>
<span class="lineNum">     302 </span>                :<span class="lineCov">          2 :             final = ovsdb_idl_get_row_for_uuid(ctx-&gt;idl, table-&gt;class,</span>
<span class="lineNum">     303 </span>                :<span class="lineCov">          2 :                                                &amp;uuid-&gt;keys[0].uuid);</span>
<span class="lineNum">     304 </span>                :            :         }
<span class="lineNum">     305 </span>                :            :     } else {
<span class="lineNum">     306 </span>                :<span class="lineCov">       4497 :         final = referrer;</span>
<span class="lineNum">     307 </span>                :            :     }
<span class="lineNum">     308 </span>                :            : 
<span class="lineNum">     309 </span>                :<span class="lineCov">       4499 :     return final;</span>
<span class="lineNum">     310 </span>                :            : }
<a name="311"><span class="lineNum">     311 </span>                :            : </a>
<span class="lineNum">     312 </span>                :            : static const struct ovsdb_idl_row *
<span class="lineNum">     313 </span>                :<span class="lineCov">       4676 : get_row(struct ctl_context *ctx,</span>
<span class="lineNum">     314 </span>                :            :         const struct ctl_table_class *table, const char *record_id,
<span class="lineNum">     315 </span>                :            :         bool must_exist)
<span class="lineNum">     316 </span>                :            : {
<span class="lineNum">     317 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">     318 </span>                :            :     struct uuid uuid;
<span class="lineNum">     319 </span>                :            : 
<span class="lineNum">     320 </span>                :<span class="lineCov">       4676 :     row = NULL;</span>
<span class="lineNum">     321 </span>        [<span class="branchCov" title="Branch 1 was taken 148 times"> + </span><span class="branchCov" title="Branch 2 was taken 4528 times"> + </span>]:<span class="lineCov">       4676 :     if (uuid_from_string(&amp;uuid, record_id)) {</span>
<span class="lineNum">     322 </span>                :<span class="lineCov">        148 :         row = ovsdb_idl_get_row_for_uuid(ctx-&gt;idl, table-&gt;class, &amp;uuid);</span>
<span class="lineNum">     323 </span>                :            :     }
<span class="lineNum">     324 </span>        [<span class="branchCov" title="Branch 0 was taken 4529 times"> + </span><span class="branchCov" title="Branch 1 was taken 147 times"> + </span>]:<span class="lineCov">       4676 :     if (!row) {</span>
<span class="lineNum">     325 </span>                :            :         int i;
<span class="lineNum">     326 </span>                :            : 
<span class="lineNum">     327 </span>        [<span class="branchCov" title="Branch 0 was taken 4558 times"> + </span><span class="branchCov" title="Branch 1 was taken 29 times"> + </span>]:<span class="lineCov">       4587 :         for (i = 0; i &lt; ARRAY_SIZE(table-&gt;row_ids); i++) {</span>
<span class="lineNum">     328 </span>                :<span class="lineCov">       4558 :             row = get_row_by_id(ctx, table, &amp;table-&gt;row_ids[i], record_id);</span>
<span class="lineNum">     329 </span>        [<span class="branchCov" title="Branch 0 was taken 4499 times"> + </span><span class="branchCov" title="Branch 1 was taken 58 times"> + </span>]:<span class="lineCov">       4557 :             if (row) {</span>
<span class="lineNum">     330 </span>                :<span class="lineCov">       4499 :                 break;</span>
<span class="lineNum">     331 </span>                :            :             }
<span class="lineNum">     332 </span>                :            :         }
<span class="lineNum">     333 </span>                :            :     }
<span class="lineNum">     334 </span>[<span class="branchCov" title="Branch 0 was taken 4565 times"> + </span><span class="branchCov" title="Branch 1 was taken 110 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 18 times"> + </span><span class="branchCov" title="Branch 3 was taken 4547 times"> + </span>]:<span class="lineCov">       4675 :     if (must_exist &amp;&amp; !row) {</span>
<span class="lineNum">     335 </span>                :<span class="lineCov">         18 :         ctl_fatal(&quot;no row \&quot;%s\&quot; in table %s&quot;,</span>
<span class="lineNum">     336 </span>                :<span class="lineCov">         18 :                   record_id, table-&gt;class-&gt;name);</span>
<span class="lineNum">     337 </span>                :            :     }
<span class="lineNum">     338 </span>                :<span class="lineCov">       4657 :     return row;</span>
<span class="lineNum">     339 </span>                :            : }
<a name="340"><span class="lineNum">     340 </span>                :            : </a>
<span class="lineNum">     341 </span>                :            : static char *
<span class="lineNum">     342 </span>                :<span class="lineCov">      19767 : get_column(const struct ctl_table_class *table, const char *column_name,</span>
<span class="lineNum">     343 </span>                :            :            const struct ovsdb_idl_column **columnp)
<span class="lineNum">     344 </span>                :            : {
<span class="lineNum">     345 </span>                :<span class="lineCov">      19767 :     const struct ovsdb_idl_column *best_match = NULL;</span>
<span class="lineNum">     346 </span>                :<span class="lineCov">      19767 :     unsigned int best_score = 0;</span>
<span class="lineNum">     347 </span>                :            :     size_t i;
<span class="lineNum">     348 </span>                :            : 
<span class="lineNum">     349 </span>        [<span class="branchCov" title="Branch 0 was taken 526995 times"> + </span><span class="branchCov" title="Branch 1 was taken 19767 times"> + </span>]:<span class="lineCov">     546762 :     for (i = 0; i &lt; table-&gt;class-&gt;n_columns; i++) {</span>
<span class="lineNum">     350 </span>                :<span class="lineCov">     526995 :         const struct ovsdb_idl_column *column = &amp;table-&gt;class-&gt;columns[i];</span>
<span class="lineNum">     351 </span>                :<span class="lineCov">     526995 :         unsigned int score = score_partial_match(column-&gt;name, column_name);</span>
<span class="lineNum">     352 </span>        [<span class="branchCov" title="Branch 0 was taken 19764 times"> + </span><span class="branchCov" title="Branch 1 was taken 507231 times"> + </span>]:<span class="lineCov">     526995 :         if (score &gt; best_score) {</span>
<span class="lineNum">     353 </span>                :<span class="lineCov">      19764 :             best_match = column;</span>
<span class="lineNum">     354 </span>                :<span class="lineCov">      19764 :             best_score = score;</span>
<span class="lineNum">     355 </span>        [<span class="branchCov" title="Branch 0 was taken 350950 times"> + </span><span class="branchCov" title="Branch 1 was taken 156281 times"> + </span>]:<span class="lineCov">     507231 :         } else if (score == best_score) {</span>
<span class="lineNum">     356 </span>                :<span class="lineCov">     350950 :             best_match = NULL;</span>
<span class="lineNum">     357 </span>                :            :         }
<span class="lineNum">     358 </span>                :            :     }
<span class="lineNum">     359 </span>                :            : 
<span class="lineNum">     360 </span>                :<span class="lineCov">      19767 :     *columnp = best_match;</span>
<span class="lineNum">     361 </span>        [<span class="branchCov" title="Branch 0 was taken 19763 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">      19767 :     if (best_match) {</span>
<span class="lineNum">     362 </span>                :<span class="lineCov">      19763 :         return NULL;</span>
<span class="lineNum">     363 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">          4 :     } else if (best_score) {</span>
<span class="lineNum">     364 </span>                :<span class="lineCov">          1 :         return xasprintf(&quot;%s contains more than one column whose name &quot;</span>
<span class="lineNum">     365 </span>                :<span class="lineCov">          1 :                          &quot;matches \&quot;%s\&quot;&quot;, table-&gt;class-&gt;name, column_name);</span>
<span class="lineNum">     366 </span>                :            :     } else {
<span class="lineNum">     367 </span>                :<span class="lineCov">          3 :         return xasprintf(&quot;%s does not contain a column whose name matches &quot;</span>
<span class="lineNum">     368 </span>                :<span class="lineCov">          3 :                          &quot;\&quot;%s\&quot;&quot;, table-&gt;class-&gt;name, column_name);</span>
<span class="lineNum">     369 </span>                :            :     }
<span class="lineNum">     370 </span>                :            : }
<a name="371"><span class="lineNum">     371 </span>                :            : </a>
<span class="lineNum">     372 </span>                :            : static void
<span class="lineNum">     373 </span>                :<span class="lineCov">       9136 : pre_get_column(struct ctl_context *ctx,</span>
<span class="lineNum">     374 </span>                :            :                const struct ctl_table_class *table, const char *column_name,
<span class="lineNum">     375 </span>                :            :                const struct ovsdb_idl_column **columnp)
<span class="lineNum">     376 </span>                :            : {
<span class="lineNum">     377 </span>                :<span class="lineCov">       9136 :     die_if_error(get_column(table, column_name, columnp));</span>
<span class="lineNum">     378 </span>                :<span class="lineCov">       9134 :     ovsdb_idl_add_column(ctx-&gt;idl, *columnp);</span>
<span class="lineNum">     379 </span>                :<span class="lineCov">       9134 : }</span>
<a name="380"><span class="lineNum">     380 </span>                :            : </a>
<span class="lineNum">     381 </span>                :            : static const struct ctl_table_class *
<span class="lineNum">     382 </span>                :<span class="lineCov">       4978 : pre_get_table(struct ctl_context *ctx, const char *table_name)</span>
<span class="lineNum">     383 </span>                :            : {
<span class="lineNum">     384 </span>                :            :     const struct ctl_table_class *table_class;
<span class="lineNum">     385 </span>                :            :     int i;
<span class="lineNum">     386 </span>                :            : 
<span class="lineNum">     387 </span>                :<span class="lineCov">       4978 :     table_class = get_table(table_name);</span>
<span class="lineNum">     388 </span>                :<span class="lineCov">       4977 :     ovsdb_idl_add_table(ctx-&gt;idl, table_class-&gt;class);</span>
<span class="lineNum">     389 </span>                :            : 
<span class="lineNum">     390 </span>        [<span class="branchCov" title="Branch 0 was taken 9954 times"> + </span><span class="branchCov" title="Branch 1 was taken 4977 times"> + </span>]:<span class="lineCov">      14931 :     for (i = 0; i &lt; ARRAY_SIZE(table_class-&gt;row_ids); i++) {</span>
<span class="lineNum">     391 </span>                :<span class="lineCov">       9954 :         const struct ctl_row_id *id = &amp;table_class-&gt;row_ids[i];</span>
<span class="lineNum">     392 </span>        [<span class="branchCov" title="Branch 0 was taken 5750 times"> + </span><span class="branchCov" title="Branch 1 was taken 4204 times"> + </span>]:<span class="lineCov">       9954 :         if (id-&gt;table) {</span>
<span class="lineNum">     393 </span>                :<span class="lineCov">       5750 :             ovsdb_idl_add_table(ctx-&gt;idl, id-&gt;table);</span>
<span class="lineNum">     394 </span>                :            :         }
<span class="lineNum">     395 </span>        [<span class="branchCov" title="Branch 0 was taken 4524 times"> + </span><span class="branchCov" title="Branch 1 was taken 5430 times"> + </span>]:<span class="lineCov">       9954 :         if (id-&gt;name_column) {</span>
<span class="lineNum">     396 </span>                :<span class="lineCov">       4524 :             ovsdb_idl_add_column(ctx-&gt;idl, id-&gt;name_column);</span>
<span class="lineNum">     397 </span>                :            :         }
<span class="lineNum">     398 </span>        [<span class="branchCov" title="Branch 0 was taken 993 times"> + </span><span class="branchCov" title="Branch 1 was taken 8961 times"> + </span>]:<span class="lineCov">       9954 :         if (id-&gt;uuid_column) {</span>
<span class="lineNum">     399 </span>                :<span class="lineCov">        993 :             ovsdb_idl_add_column(ctx-&gt;idl, id-&gt;uuid_column);</span>
<span class="lineNum">     400 </span>                :            :         }
<span class="lineNum">     401 </span>                :            :     }
<span class="lineNum">     402 </span>                :            : 
<span class="lineNum">     403 </span>                :<span class="lineCov">       4977 :     return table_class;</span>
<span class="lineNum">     404 </span>                :            : }
<a name="405"><span class="lineNum">     405 </span>                :            : </a>
<span class="lineNum">     406 </span>                :            : static char *
<span class="lineNum">     407 </span>                :<span class="lineCov">          2 : missing_operator_error(const char *arg, const char **allowed_operators,</span>
<span class="lineNum">     408 </span>                :            :                        size_t n_allowed)
<span class="lineNum">     409 </span>                :            : {
<span class="lineNum">     410 </span>                :            :     struct ds s;
<span class="lineNum">     411 </span>                :            : 
<span class="lineNum">     412 </span>                :<span class="lineCov">          2 :     ds_init(&amp;s);</span>
<span class="lineNum">     413 </span>                :<span class="lineCov">          2 :     ds_put_format(&amp;s, &quot;%s: argument does not end in &quot;, arg);</span>
<span class="lineNum">     414 </span>                :<span class="lineCov">          2 :     ds_put_format(&amp;s, &quot;\&quot;%s\&quot;&quot;, allowed_operators[0]);</span>
<span class="lineNum">     415 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          2 :     if (n_allowed == 2) {</span>
<span class="lineNum">     416 </span>                :<span class="lineNoCov">          0 :         ds_put_format(&amp;s, &quot; or \&quot;%s\&quot;&quot;, allowed_operators[1]);</span>
<span class="lineNum">     417 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          2 :     } else if (n_allowed &gt; 2) {</span>
<span class="lineNum">     418 </span>                :            :         size_t i;
<span class="lineNum">     419 </span>                :            : 
<span class="lineNum">     420 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">         11 :         for (i = 1; i &lt; n_allowed - 1; i++) {</span>
<span class="lineNum">     421 </span>                :<span class="lineCov">         10 :             ds_put_format(&amp;s, &quot;, \&quot;%s\&quot;&quot;, allowed_operators[i]);</span>
<span class="lineNum">     422 </span>                :            :         }
<span class="lineNum">     423 </span>                :<span class="lineCov">          1 :         ds_put_format(&amp;s, &quot;, or \&quot;%s\&quot;&quot;, allowed_operators[i]);</span>
<span class="lineNum">     424 </span>                :            :     }
<span class="lineNum">     425 </span>                :<span class="lineCov">          2 :     ds_put_format(&amp;s, &quot; followed by a value.&quot;);</span>
<span class="lineNum">     426 </span>                :            : 
<span class="lineNum">     427 </span>                :<span class="lineCov">          2 :     return ds_steal_cstr(&amp;s);</span>
<span class="lineNum">     428 </span>                :            : }
<span class="lineNum">     429 </span>                :            : 
<span class="lineNum">     430 </span>                :            : /* Breaks 'arg' apart into a number of fields in the following order:
<span class="lineNum">     431 </span>                :            :  *
<span class="lineNum">     432 </span>                :            :  *      - The name of a column in 'table', stored into '*columnp'.  The column
<span class="lineNum">     433 </span>                :            :  *        name may be abbreviated.
<span class="lineNum">     434 </span>                :            :  *
<span class="lineNum">     435 </span>                :            :  *      - Optionally ':' followed by a key string.  The key is stored as a
<span class="lineNum">     436 </span>                :            :  *        malloc()'d string into '*keyp', or NULL if no key is present in
<span class="lineNum">     437 </span>                :            :  *        'arg'.
<span class="lineNum">     438 </span>                :            :  *
<span class="lineNum">     439 </span>                :            :  *      - If 'valuep' is nonnull, an operator followed by a value string.  The
<span class="lineNum">     440 </span>                :            :  *        allowed operators are the 'n_allowed' string in 'allowed_operators',
<span class="lineNum">     441 </span>                :            :  *        or just &quot;=&quot; if 'n_allowed' is 0.  If 'operatorp' is nonnull, then the
<span class="lineNum">     442 </span>                :            :  *        index of the operator within 'allowed_operators' is stored into
<span class="lineNum">     443 </span>                :            :  *        '*operatorp'.  The value is stored as a malloc()'d string into
<span class="lineNum">     444 </span>                :            :  *        '*valuep', or NULL if no value is present in 'arg'.
<span class="lineNum">     445 </span>                :            :  *
<span class="lineNum">     446 </span>                :            :  * On success, returns NULL.  On failure, returned a malloc()'d string error
<a name="447"><span class="lineNum">     447 </span>                :            :  * message and stores NULL into all of the nonnull output arguments. */</a>
<span class="lineNum">     448 </span>                :            : static char * OVS_WARN_UNUSED_RESULT
<span class="lineNum">     449 </span>                :<span class="lineCov">      10132 : parse_column_key_value(const char *arg,</span>
<span class="lineNum">     450 </span>                :            :                        const struct ctl_table_class *table,
<span class="lineNum">     451 </span>                :            :                        const struct ovsdb_idl_column **columnp, char **keyp,
<span class="lineNum">     452 </span>                :            :                        int *operatorp,
<span class="lineNum">     453 </span>                :            :                        const char **allowed_operators, size_t n_allowed,
<span class="lineNum">     454 </span>                :            :                        char **valuep)
<span class="lineNum">     455 </span>                :            : {
<span class="lineNum">     456 </span>                :<span class="lineCov">      10132 :     const char *p = arg;</span>
<span class="lineNum">     457 </span>                :            :     char *column_name;
<span class="lineNum">     458 </span>                :            :     char *error;
<span class="lineNum">     459 </span>                :            : 
<span class="lineNum">     460 </span>[<span class="branchCov" title="Branch 0 was taken 863 times"> + </span><span class="branchCov" title="Branch 1 was taken 9269 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 863 times"> + </span>]:<span class="lineCov">      10132 :     ovs_assert(!(operatorp &amp;&amp; !valuep));</span>
<span class="lineNum">     461 </span>                :<span class="lineCov">      10132 :     *keyp = NULL;</span>
<span class="lineNum">     462 </span>        [<span class="branchCov" title="Branch 0 was taken 9236 times"> + </span><span class="branchCov" title="Branch 1 was taken 896 times"> + </span>]:<span class="lineCov">      10132 :     if (valuep) {</span>
<span class="lineNum">     463 </span>                :<span class="lineCov">       9236 :         *valuep = NULL;</span>
<span class="lineNum">     464 </span>                :            :     }
<span class="lineNum">     465 </span>                :            : 
<span class="lineNum">     466 </span>                :            :     /* Parse column name. */
<span class="lineNum">     467 </span>                :<span class="lineCov">      10132 :     error = ovsdb_token_parse(&amp;p, &amp;column_name);</span>
<span class="lineNum">     468 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 10132 times"> + </span>]:<span class="lineCov">      10132 :     if (error) {</span>
<span class="lineNum">     469 </span>                :<span class="lineNoCov">          0 :         goto error;</span>
<span class="lineNum">     470 </span>                :            :     }
<span class="lineNum">     471 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 10132 times"> + </span>]:<span class="lineCov">      10132 :     if (column_name[0] == '\0') {</span>
<span class="lineNum">     472 </span>                :<span class="lineNoCov">          0 :         free(column_name);</span>
<span class="lineNum">     473 </span>                :<span class="lineNoCov">          0 :         error = xasprintf(&quot;%s: missing column name&quot;, arg);</span>
<span class="lineNum">     474 </span>                :<span class="lineNoCov">          0 :         goto error;</span>
<span class="lineNum">     475 </span>                :            :     }
<span class="lineNum">     476 </span>                :<span class="lineCov">      10132 :     error = get_column(table, column_name, columnp);</span>
<span class="lineNum">     477 </span>                :<span class="lineCov">      10132 :     free(column_name);</span>
<span class="lineNum">     478 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 10132 times"> + </span>]:<span class="lineCov">      10132 :     if (error) {</span>
<span class="lineNum">     479 </span>                :<span class="lineNoCov">          0 :         goto error;</span>
<span class="lineNum">     480 </span>                :            :     }
<span class="lineNum">     481 </span>                :            : 
<span class="lineNum">     482 </span>                :            :     /* Parse key string. */
<span class="lineNum">     483 </span>        [<span class="branchCov" title="Branch 0 was taken 3990 times"> + </span><span class="branchCov" title="Branch 1 was taken 6142 times"> + </span>]:<span class="lineCov">      10132 :     if (*p == ':') {</span>
<span class="lineNum">     484 </span>                :<span class="lineCov">       3990 :         p++;</span>
<span class="lineNum">     485 </span>                :<span class="lineCov">       3990 :         error = ovsdb_token_parse(&amp;p, keyp);</span>
<span class="lineNum">     486 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3990 times"> + </span>]:<span class="lineCov">       3990 :         if (error) {</span>
<span class="lineNum">     487 </span>                :<span class="lineNoCov">          0 :             goto error;</span>
<span class="lineNum">     488 </span>                :            :         }
<span class="lineNum">     489 </span>                :            :     }
<span class="lineNum">     490 </span>                :            : 
<span class="lineNum">     491 </span>                :            :     /* Parse value string. */
<span class="lineNum">     492 </span>        [<span class="branchCov" title="Branch 0 was taken 9236 times"> + </span><span class="branchCov" title="Branch 1 was taken 896 times"> + </span>]:<span class="lineCov">      10132 :     if (valuep) {</span>
<span class="lineNum">     493 </span>                :            :         size_t best_len;
<span class="lineNum">     494 </span>                :            :         size_t i;
<span class="lineNum">     495 </span>                :            :         int best;
<span class="lineNum">     496 </span>                :            : 
<span class="lineNum">     497 </span>        [<span class="branchCov" title="Branch 0 was taken 8373 times"> + </span><span class="branchCov" title="Branch 1 was taken 863 times"> + </span>]:<span class="lineCov">       9236 :         if (!allowed_operators) {</span>
<span class="lineNum">     498 </span>                :            :             static const char *equals = &quot;=&quot;;
<span class="lineNum">     499 </span>                :<span class="lineCov">       8373 :             allowed_operators = &amp;equals;</span>
<span class="lineNum">     500 </span>                :<span class="lineCov">       8373 :             n_allowed = 1;</span>
<span class="lineNum">     501 </span>                :            :         }
<span class="lineNum">     502 </span>                :            : 
<span class="lineNum">     503 </span>                :<span class="lineCov">       9236 :         best = -1;</span>
<span class="lineNum">     504 </span>                :<span class="lineCov">       9236 :         best_len = 0;</span>
<span class="lineNum">     505 </span>        [<span class="branchCov" title="Branch 0 was taken 18729 times"> + </span><span class="branchCov" title="Branch 1 was taken 9236 times"> + </span>]:<span class="lineCov">      27965 :         for (i = 0; i &lt; n_allowed; i++) {</span>
<span class="lineNum">     506 </span>                :<span class="lineCov">      18729 :             const char *op = allowed_operators[i];</span>
<span class="lineNum">     507 </span>                :<span class="lineCov">      18729 :             size_t op_len = strlen(op);</span>
<span class="lineNum">     508 </span>                :            : 
<span class="lineNum">     509 </span>[<span class="branchCov" title="Branch 0 was taken 17256 times"> + </span><span class="branchCov" title="Branch 1 was taken 1473 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 9282 times"> + </span><span class="branchCov" title="Branch 3 was taken 7974 times"> + </span>]:<span class="lineCov">      18729 :             if (op_len &gt; best_len &amp;&amp; !strncmp(op, p, op_len) &amp;&amp; p[op_len]) {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 9282 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<span class="lineNum">     510 </span>                :<span class="lineCov">       9282 :                 best_len = op_len;</span>
<span class="lineNum">     511 </span>                :<span class="lineCov">       9282 :                 best = i;</span>
<span class="lineNum">     512 </span>                :            :             }
<span class="lineNum">     513 </span>                :            :         }
<span class="lineNum">     514 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 9234 times"> + </span>]:<span class="lineCov">       9236 :         if (best &lt; 0) {</span>
<span class="lineNum">     515 </span>                :<span class="lineCov">          2 :             error = missing_operator_error(arg, allowed_operators, n_allowed);</span>
<span class="lineNum">     516 </span>                :<span class="lineCov">          2 :             goto error;</span>
<span class="lineNum">     517 </span>                :            :         }
<span class="lineNum">     518 </span>                :            : 
<span class="lineNum">     519 </span>        [<span class="branchCov" title="Branch 0 was taken 862 times"> + </span><span class="branchCov" title="Branch 1 was taken 8372 times"> + </span>]:<span class="lineCov">       9234 :         if (operatorp) {</span>
<span class="lineNum">     520 </span>                :<span class="lineCov">        862 :             *operatorp = best;</span>
<span class="lineNum">     521 </span>                :            :         }
<span class="lineNum">     522 </span>                :<span class="lineCov">       9234 :         *valuep = xstrdup(p + best_len);</span>
<span class="lineNum">     523 </span>                :            :     } else {
<span class="lineNum">     524 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 894 times"> + </span>]:<span class="lineCov">        896 :         if (*p != '\0') {</span>
<span class="lineNum">     525 </span>                :<span class="lineCov">          2 :             error = xasprintf(&quot;%s: trailing garbage \&quot;%s\&quot; in argument&quot;,</span>
<span class="lineNum">     526 </span>                :            :                               arg, p);
<span class="lineNum">     527 </span>                :<span class="lineCov">          2 :             goto error;</span>
<span class="lineNum">     528 </span>                :            :         }
<span class="lineNum">     529 </span>                :            :     }
<span class="lineNum">     530 </span>                :<span class="lineCov">      10128 :     return NULL;</span>
<span class="lineNum">     531 </span>                :            : 
<span class="lineNum">     532 </span>                :            :  error:
<span class="lineNum">     533 </span>                :<span class="lineCov">          4 :     *columnp = NULL;</span>
<span class="lineNum">     534 </span>                :<span class="lineCov">          4 :     free(*keyp);</span>
<span class="lineNum">     535 </span>                :<span class="lineCov">          4 :     *keyp = NULL;</span>
<span class="lineNum">     536 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          4 :     if (valuep) {</span>
<span class="lineNum">     537 </span>                :<span class="lineCov">          2 :         free(*valuep);</span>
<span class="lineNum">     538 </span>                :<span class="lineCov">          2 :         *valuep = NULL;</span>
<span class="lineNum">     539 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          2 :         if (operatorp) {</span>
<span class="lineNum">     540 </span>                :<span class="lineCov">          1 :             *operatorp = -1;</span>
<span class="lineNum">     541 </span>                :            :         }
<span class="lineNum">     542 </span>                :            :     }
<span class="lineNum">     543 </span>                :<span class="lineCov">      10132 :     return error;</span>
<span class="lineNum">     544 </span>                :            : }
<a name="545"><span class="lineNum">     545 </span>                :            : </a>
<span class="lineNum">     546 </span>                :            : static const struct ovsdb_idl_column *
<span class="lineNum">     547 </span>                :<span class="lineCov">       9046 : pre_parse_column_key_value(struct ctl_context *ctx,</span>
<span class="lineNum">     548 </span>                :            :                            const char *arg,
<span class="lineNum">     549 </span>                :            :                            const struct ctl_table_class *table)
<span class="lineNum">     550 </span>                :            : {
<span class="lineNum">     551 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">     552 </span>                :            :     const char *p;
<span class="lineNum">     553 </span>                :            :     char *column_name;
<span class="lineNum">     554 </span>                :            : 
<span class="lineNum">     555 </span>                :<span class="lineCov">       9046 :     p = arg;</span>
<span class="lineNum">     556 </span>                :<span class="lineCov">       9046 :     die_if_error(ovsdb_token_parse(&amp;p, &amp;column_name));</span>
<span class="lineNum">     557 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 9045 times"> + </span>]:<span class="lineCov">       9046 :     if (column_name[0] == '\0') {</span>
<span class="lineNum">     558 </span>                :<span class="lineCov">          1 :         ctl_fatal(&quot;%s: missing column name&quot;, arg);</span>
<span class="lineNum">     559 </span>                :            :     }
<span class="lineNum">     560 </span>                :            : 
<span class="lineNum">     561 </span>                :<span class="lineCov">       9045 :     pre_get_column(ctx, table, column_name, &amp;column);</span>
<span class="lineNum">     562 </span>                :<span class="lineCov">       9043 :     free(column_name);</span>
<span class="lineNum">     563 </span>                :            : 
<span class="lineNum">     564 </span>                :<span class="lineCov">       9043 :     return column;</span>
<span class="lineNum">     565 </span>                :            : }
<a name="566"><span class="lineNum">     566 </span>                :            : </a>
<span class="lineNum">     567 </span>                :            : static void
<span class="lineNum">     568 </span>                :<span class="lineCov">       8456 : check_mutable(const struct ovsdb_idl_row *row,</span>
<span class="lineNum">     569 </span>                :            :               const struct ovsdb_idl_column *column)
<span class="lineNum">     570 </span>                :            : {
<span class="lineNum">     571 </span>        [<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchCov" title="Branch 2 was taken 8452 times"> + </span>]:<span class="lineCov">       8456 :     if (!ovsdb_idl_is_mutable(row, column)) {</span>
<span class="lineNum">     572 </span>                :<span class="lineCov">          4 :         ctl_fatal(&quot;cannot modify read-only column %s in table %s&quot;,</span>
<span class="lineNum">     573 </span>                :<span class="lineCov">          4 :                   column-&gt;name, row-&gt;table-&gt;class-&gt;name);</span>
<span class="lineNum">     574 </span>                :            :     }
<span class="lineNum">     575 </span>                :<span class="lineCov">       8452 : }</span>
<span class="lineNum">     576 </span>                :            : 
<span class="lineNum">     577 </span>                :            : #define RELOPS                                  \
<span class="lineNum">     578 </span>                :            :     RELOP(RELOP_EQ,     &quot;=&quot;)                    \
<span class="lineNum">     579 </span>                :            :     RELOP(RELOP_NE,     &quot;!=&quot;)                   \
<span class="lineNum">     580 </span>                :            :     RELOP(RELOP_LT,     &quot;&lt;&quot;)                    \
<span class="lineNum">     581 </span>                :            :     RELOP(RELOP_GT,     &quot;&gt;&quot;)                    \
<span class="lineNum">     582 </span>                :            :     RELOP(RELOP_LE,     &quot;&lt;=&quot;)                   \
<span class="lineNum">     583 </span>                :            :     RELOP(RELOP_GE,     &quot;&gt;=&quot;)                   \
<span class="lineNum">     584 </span>                :            :     RELOP(RELOP_SET_EQ, &quot;{=}&quot;)                  \
<span class="lineNum">     585 </span>                :            :     RELOP(RELOP_SET_NE, &quot;{!=}&quot;)                 \
<span class="lineNum">     586 </span>                :            :     RELOP(RELOP_SET_LT, &quot;{&lt;}&quot;)                  \
<span class="lineNum">     587 </span>                :            :     RELOP(RELOP_SET_GT, &quot;{&gt;}&quot;)                  \
<span class="lineNum">     588 </span>                :            :     RELOP(RELOP_SET_LE, &quot;{&lt;=}&quot;)                 \
<span class="lineNum">     589 </span>                :            :     RELOP(RELOP_SET_GE, &quot;{&gt;=}&quot;)
<span class="lineNum">     590 </span>                :            : 
<span class="lineNum">     591 </span>                :            : enum relop {
<span class="lineNum">     592 </span>                :            : #define RELOP(ENUM, STRING) ENUM,
<span class="lineNum">     593 </span>                :            :     RELOPS
<span class="lineNum">     594 </span>                :            : #undef RELOP
<span class="lineNum">     595 </span>                :            : };
<a name="596"><span class="lineNum">     596 </span>                :            : </a>
<span class="lineNum">     597 </span>                :            : static bool
<span class="lineNum">     598 </span>                :<span class="lineCov">        195 : is_set_operator(enum relop op)</span>
<span class="lineNum">     599 </span>                :            : {
<span class="lineNum">     600 </span>[<span class="branchCov" title="Branch 0 was taken 155 times"> + </span><span class="branchCov" title="Branch 1 was taken 20 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 130 times"> + </span><span class="branchCov" title="Branch 3 was taken 25 times"> + </span>]:<span class="lineCov">        370 :     return (op == RELOP_SET_EQ || op == RELOP_SET_NE ||</span>
<span class="lineNum">     601 </span>[<span class="branchCov" title="Branch 0 was taken 105 times"> + </span><span class="branchCov" title="Branch 1 was taken 25 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 75 times"> + </span><span class="branchCov" title="Branch 3 was taken 30 times"> + </span>]:<span class="lineCov">        130 :             op == RELOP_SET_LT || op == RELOP_SET_GT ||</span>
<span class="lineNum">     602 </span>[<span class="branchCov" title="Branch 0 was taken 175 times"> + </span><span class="branchCov" title="Branch 1 was taken 20 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 25 times"> + </span><span class="branchCov" title="Branch 3 was taken 50 times"> + </span>]:<span class="lineCov">        370 :             op == RELOP_SET_LE || op == RELOP_SET_GE);</span>
<span class="lineNum">     603 </span>                :            : }
<a name="604"><span class="lineNum">     604 </span>                :            : </a>
<span class="lineNum">     605 </span>                :            : static bool
<span class="lineNum">     606 </span>                :<span class="lineCov">        812 : evaluate_relop(const struct ovsdb_datum *a, const struct ovsdb_datum *b,</span>
<span class="lineNum">     607 </span>                :            :                const struct ovsdb_type *type, enum relop op)
<span class="lineNum">     608 </span>                :            : {
<span class="lineNum">     609 </span>  [<span class="branchCov" title="Branch 0 was taken 333 times"> + </span><span class="branchCov" title="Branch 1 was taken 127 times"> + </span><span class="branchCov" title="Branch 2 was taken 20 times"> + </span><span class="branchCov" title="Branch 3 was taken 22 times"> + </span> :<span class="lineCov">        812 :     switch (op) {</span>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 19 times"> + </span><span class="branchCov" title="Branch 5 was taken 19 times"> + </span><span class="branchCov" title="Branch 6 was taken 64 times"> + </span><span class="branchCov" title="Branch 7 was taken 64 times"> + </span><span class="branchCov" title="Branch 8 was taken 72 times"> + </span> 
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 9 was taken 72 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>]
<span class="lineNum">     610 </span>                :            :     case RELOP_EQ:
<span class="lineNum">     611 </span>                :            :     case RELOP_SET_EQ:
<span class="lineNum">     612 </span>                :<span class="lineCov">        333 :         return ovsdb_datum_compare_3way(a, b, type) == 0;</span>
<span class="lineNum">     613 </span>                :            :     case RELOP_NE:
<span class="lineNum">     614 </span>                :            :     case RELOP_SET_NE:
<span class="lineNum">     615 </span>                :<span class="lineCov">        127 :         return ovsdb_datum_compare_3way(a, b, type) != 0;</span>
<span class="lineNum">     616 </span>                :            :     case RELOP_LT:
<span class="lineNum">     617 </span>                :<span class="lineCov">         20 :         return ovsdb_datum_compare_3way(a, b, type) &lt; 0;</span>
<span class="lineNum">     618 </span>                :            :     case RELOP_GT:
<span class="lineNum">     619 </span>                :<span class="lineCov">         22 :         return ovsdb_datum_compare_3way(a, b, type) &gt; 0;</span>
<span class="lineNum">     620 </span>                :            :     case RELOP_LE:
<span class="lineNum">     621 </span>                :<span class="lineCov">         19 :         return ovsdb_datum_compare_3way(a, b, type) &lt;= 0;</span>
<span class="lineNum">     622 </span>                :            :     case RELOP_GE:
<span class="lineNum">     623 </span>                :<span class="lineCov">         19 :         return ovsdb_datum_compare_3way(a, b, type) &gt;= 0;</span>
<span class="lineNum">     624 </span>                :            : 
<span class="lineNum">     625 </span>                :            :     case RELOP_SET_LT:
<span class="lineNum">     626 </span>[<span class="branchCov" title="Branch 0 was taken 25 times"> + </span><span class="branchCov" title="Branch 1 was taken 39 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 24 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">         64 :         return b-&gt;n &gt; a-&gt;n &amp;&amp; ovsdb_datum_includes_all(a, b, type);</span>
<span class="lineNum">     627 </span>                :            :     case RELOP_SET_GT:
<span class="lineNum">     628 </span>[<span class="branchCov" title="Branch 0 was taken 15 times"> + </span><span class="branchCov" title="Branch 1 was taken 49 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 14 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">         64 :         return a-&gt;n &gt; b-&gt;n &amp;&amp; ovsdb_datum_includes_all(b, a, type);</span>
<span class="lineNum">     629 </span>                :            :     case RELOP_SET_LE:
<span class="lineNum">     630 </span>                :<span class="lineCov">         72 :         return ovsdb_datum_includes_all(a, b, type);</span>
<span class="lineNum">     631 </span>                :            :     case RELOP_SET_GE:
<span class="lineNum">     632 </span>                :<span class="lineCov">         72 :         return ovsdb_datum_includes_all(b, a, type);</span>
<span class="lineNum">     633 </span>                :            : 
<span class="lineNum">     634 </span>                :            :     default:
<span class="lineNum">     635 </span>                :<span class="lineNoCov">          0 :         OVS_NOT_REACHED();</span>
<span class="lineNum">     636 </span>                :            :     }
<span class="lineNum">     637 </span>                :            : }
<a name="638"><span class="lineNum">     638 </span>                :            : </a>
<span class="lineNum">     639 </span>                :            : static bool
<span class="lineNum">     640 </span>                :<span class="lineCov">        863 : is_condition_satisfied(const struct ctl_table_class *table,</span>
<span class="lineNum">     641 </span>                :            :                        const struct ovsdb_idl_row *row, const char *arg,
<span class="lineNum">     642 </span>                :            :                        struct ovsdb_symbol_table *symtab)
<span class="lineNum">     643 </span>                :            : {
<span class="lineNum">     644 </span>                :            :     static const char *operators[] = {
<span class="lineNum">     645 </span>                :            : #define RELOP(ENUM, STRING) STRING,
<span class="lineNum">     646 </span>                :            :         RELOPS
<span class="lineNum">     647 </span>                :            : #undef RELOP
<span class="lineNum">     648 </span>                :            :     };
<span class="lineNum">     649 </span>                :            : 
<span class="lineNum">     650 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">     651 </span>                :            :     const struct ovsdb_datum *have_datum;
<span class="lineNum">     652 </span>                :            :     char *key_string, *value_string;
<span class="lineNum">     653 </span>                :            :     struct ovsdb_type type;
<span class="lineNum">     654 </span>                :            :     int operator;
<span class="lineNum">     655 </span>                :            :     bool retval;
<span class="lineNum">     656 </span>                :            :     char *error;
<span class="lineNum">     657 </span>                :            : 
<span class="lineNum">     658 </span>                :<span class="lineCov">        863 :     error = parse_column_key_value(arg, table, &amp;column, &amp;key_string,</span>
<span class="lineNum">     659 </span>                :            :                                    &amp;operator, operators, ARRAY_SIZE(operators),
<span class="lineNum">     660 </span>                :            :                                    &amp;value_string);
<span class="lineNum">     661 </span>                :<span class="lineCov">        863 :     die_if_error(error);</span>
<span class="lineNum">     662 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 862 times"> + </span>]:<span class="lineCov">        862 :     if (!value_string) {</span>
<span class="lineNum">     663 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;%s: missing value&quot;, arg);</span>
<span class="lineNum">     664 </span>                :            :     }
<span class="lineNum">     665 </span>                :            : 
<span class="lineNum">     666 </span>                :<span class="lineCov">        862 :     type = column-&gt;type;</span>
<span class="lineNum">     667 </span>                :<span class="lineCov">        862 :     type.n_max = UINT_MAX;</span>
<span class="lineNum">     668 </span>                :            : 
<span class="lineNum">     669 </span>                :<span class="lineCov">        862 :     have_datum = ovsdb_idl_read(row, column);</span>
<span class="lineNum">     670 </span>        [<span class="branchCov" title="Branch 0 was taken 315 times"> + </span><span class="branchCov" title="Branch 1 was taken 547 times"> + </span>]:<span class="lineCov">        862 :     if (key_string) {</span>
<span class="lineNum">     671 </span>                :            :         union ovsdb_atom want_key;
<span class="lineNum">     672 </span>                :            :         struct ovsdb_datum b;
<span class="lineNum">     673 </span>                :            :         unsigned int idx;
<span class="lineNum">     674 </span>                :            : 
<span class="lineNum">     675 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 315 times"> + </span>]:<span class="lineCov">        315 :         if (column-&gt;type.value.type == OVSDB_TYPE_VOID) {</span>
<span class="lineNum">     676 </span>                :<span class="lineNoCov">          0 :             ctl_fatal(&quot;cannot specify key to check for non-map column %s&quot;,</span>
<span class="lineNum">     677 </span>                :<span class="lineNoCov">          0 :                       column-&gt;name);</span>
<span class="lineNum">     678 </span>                :            :         }
<span class="lineNum">     679 </span>                :            : 
<span class="lineNum">     680 </span>                :<span class="lineCov">        315 :         die_if_error(ovsdb_atom_from_string(&amp;want_key, &amp;column-&gt;type.key,</span>
<span class="lineNum">     681 </span>                :            :                                             key_string, symtab));
<span class="lineNum">     682 </span>                :            : 
<span class="lineNum">     683 </span>                :<span class="lineCov">        315 :         type.key = type.value;</span>
<span class="lineNum">     684 </span>                :<span class="lineCov">        315 :         type.value.type = OVSDB_TYPE_VOID;</span>
<span class="lineNum">     685 </span>                :<span class="lineCov">        315 :         die_if_error(ovsdb_datum_from_string(&amp;b, &amp;type, value_string, symtab));</span>
<span class="lineNum">     686 </span>                :            : 
<span class="lineNum">     687 </span>                :<span class="lineCov">        315 :         idx = ovsdb_datum_find_key(have_datum,</span>
<span class="lineNum">     688 </span>                :<span class="lineCov">        315 :                                    &amp;want_key, column-&gt;type.key.type);</span>
<span class="lineNum">     689 </span>[<span class="branchCov" title="Branch 0 was taken 195 times"> + </span><span class="branchCov" title="Branch 1 was taken 120 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 50 times"> + </span><span class="branchCov" title="Branch 4 was taken 145 times"> + </span>]:<span class="lineCov">        315 :         if (idx == UINT_MAX &amp;&amp; !is_set_operator(operator)) {</span>
<span class="lineNum">     690 </span>                :<span class="lineCov">         50 :             retval = false;</span>
<span class="lineNum">     691 </span>                :            :         } else {
<span class="lineNum">     692 </span>                :            :             struct ovsdb_datum a;
<span class="lineNum">     693 </span>                :            : 
<span class="lineNum">     694 </span>        [<span class="branchCov" title="Branch 0 was taken 120 times"> + </span><span class="branchCov" title="Branch 1 was taken 145 times"> + </span>]:<span class="lineCov">        265 :             if (idx != UINT_MAX) {</span>
<span class="lineNum">     695 </span>                :<span class="lineCov">        120 :                 a.n = 1;</span>
<span class="lineNum">     696 </span>                :<span class="lineCov">        120 :                 a.keys = &amp;have_datum-&gt;values[idx];</span>
<span class="lineNum">     697 </span>                :<span class="lineCov">        120 :                 a.values = NULL;</span>
<span class="lineNum">     698 </span>                :            :             } else {
<span class="lineNum">     699 </span>                :<span class="lineCov">        145 :                 a.n = 0;</span>
<span class="lineNum">     700 </span>                :<span class="lineCov">        145 :                 a.keys = NULL;</span>
<span class="lineNum">     701 </span>                :<span class="lineCov">        145 :                 a.values = NULL;</span>
<span class="lineNum">     702 </span>                :            :             }
<span class="lineNum">     703 </span>                :            : 
<span class="lineNum">     704 </span>                :<span class="lineCov">        265 :             retval = evaluate_relop(&amp;a, &amp;b, &amp;type, operator);</span>
<span class="lineNum">     705 </span>                :            :         }
<span class="lineNum">     706 </span>                :            : 
<span class="lineNum">     707 </span>                :<span class="lineCov">        315 :         ovsdb_atom_destroy(&amp;want_key, column-&gt;type.key.type);</span>
<span class="lineNum">     708 </span>                :<span class="lineCov">        315 :         ovsdb_datum_destroy(&amp;b, &amp;type);</span>
<span class="lineNum">     709 </span>                :            :     } else {
<span class="lineNum">     710 </span>                :            :         struct ovsdb_datum want_datum;
<span class="lineNum">     711 </span>                :            : 
<span class="lineNum">     712 </span>                :<span class="lineCov">        547 :         die_if_error(ovsdb_datum_from_string(&amp;want_datum, &amp;column-&gt;type,</span>
<span class="lineNum">     713 </span>                :            :                                              value_string, symtab));
<span class="lineNum">     714 </span>                :<span class="lineCov">        547 :         retval = evaluate_relop(have_datum, &amp;want_datum, &amp;type, operator);</span>
<span class="lineNum">     715 </span>                :<span class="lineCov">        547 :         ovsdb_datum_destroy(&amp;want_datum, &amp;column-&gt;type);</span>
<span class="lineNum">     716 </span>                :            :     }
<span class="lineNum">     717 </span>                :            : 
<span class="lineNum">     718 </span>                :<span class="lineCov">        862 :     free(key_string);</span>
<span class="lineNum">     719 </span>                :<span class="lineCov">        862 :     free(value_string);</span>
<span class="lineNum">     720 </span>                :            : 
<span class="lineNum">     721 </span>                :<span class="lineCov">        862 :     return retval;</span>
<span class="lineNum">     722 </span>                :            : }
<a name="723"><span class="lineNum">     723 </span>                :            : </a>
<span class="lineNum">     724 </span>                :            : static void
<span class="lineNum">     725 </span>                :<span class="lineCov">      19997 : invalidate_cache(struct ctl_context *ctx)</span>
<span class="lineNum">     726 </span>                :            : {
<span class="lineNum">     727 </span>        [<span class="branchCov" title="Branch 0 was taken 18844 times"> + </span><span class="branchCov" title="Branch 1 was taken 1153 times"> + </span>]:<span class="lineCov">      19997 :     if (ctx-&gt;invalidate_cache) {</span>
<span class="lineNum">     728 </span>                :<span class="lineCov">      18844 :         (ctx-&gt;invalidate_cache)(ctx);</span>
<span class="lineNum">     729 </span>                :            :     }
<span class="lineNum">     730 </span>                :<span class="lineCov">      19997 : }</span>
<a name="731"><span class="lineNum">     731 </span>                :            : </a>
<span class="lineNum">     732 </span>                :            : static void
<span class="lineNum">     733 </span>                :<span class="lineCov">        922 : pre_cmd_get(struct ctl_context *ctx)</span>
<span class="lineNum">     734 </span>                :            : {
<span class="lineNum">     735 </span>                :<span class="lineCov">        922 :     const char *id = shash_find_data(&amp;ctx-&gt;options, &quot;--id&quot;);</span>
<span class="lineNum">     736 </span>                :<span class="lineCov">        922 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">     737 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">     738 </span>                :            :     int i;
<span class="lineNum">     739 </span>                :            : 
<span class="lineNum">     740 </span>                :            :     /* Using &quot;get&quot; without --id or a column name could possibly make sense.
<span class="lineNum">     741 </span>                :            :      * Maybe, for example, a *ctl command run wants to assert that a row
<span class="lineNum">     742 </span>                :            :      * exists.  But it is unlikely that an interactive user would want to do
<span class="lineNum">     743 </span>                :            :      * that, so issue a warning if we're running on a terminal. */
<span class="lineNum">     744 </span>[<span class="branchCov" title="Branch 0 was taken 891 times"> + </span><span class="branchCov" title="Branch 1 was taken 31 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 891 times"> + </span>]:<span class="lineCov">        922 :     if (!id &amp;&amp; ctx-&gt;argc &lt;= 3 &amp;&amp; isatty(STDOUT_FILENO)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]
<span class="lineNum">     745 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         VLOG_WARN(&quot;\&quot;get\&quot; command without row arguments or \&quot;--id\&quot; is &quot;</span>
<span class="lineNum">     746 </span>                :            :                   &quot;possibly erroneous&quot;);
<span class="lineNum">     747 </span>                :            :     }
<span class="lineNum">     748 </span>                :            : 
<span class="lineNum">     749 </span>                :<span class="lineCov">        922 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">     750 </span>        [<span class="branchCov" title="Branch 0 was taken 908 times"> + </span><span class="branchCov" title="Branch 1 was taken 919 times"> + </span>]:<span class="lineCov">       1827 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">     751 </span>        [<span class="branchCov" title="Branch 0 was taken 906 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        908 :         if (!strcasecmp(ctx-&gt;argv[i], &quot;_uuid&quot;)</span>
<span class="lineNum">     752 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 906 times"> + </span>]:<span class="lineCov">        906 :             || !strcasecmp(ctx-&gt;argv[i], &quot;-uuid&quot;)) {</span>
<span class="lineNum">     753 </span>                :<span class="lineCov">          2 :             continue;</span>
<span class="lineNum">     754 </span>                :            :         }
<span class="lineNum">     755 </span>                :            : 
<span class="lineNum">     756 </span>                :<span class="lineCov">        906 :         pre_parse_column_key_value(ctx, ctx-&gt;argv[i], table);</span>
<span class="lineNum">     757 </span>                :            :     }
<span class="lineNum">     758 </span>                :<span class="lineCov">        919 : }</span>
<a name="759"><span class="lineNum">     759 </span>                :            : </a>
<span class="lineNum">     760 </span>                :            : static void
<span class="lineNum">     761 </span>                :<span class="lineCov">        919 : cmd_get(struct ctl_context *ctx)</span>
<span class="lineNum">     762 </span>                :            : {
<span class="lineNum">     763 </span>                :<span class="lineCov">        919 :     const char *id = shash_find_data(&amp;ctx-&gt;options, &quot;--id&quot;);</span>
<span class="lineNum">     764 </span>                :<span class="lineCov">        919 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">     765 </span>                :<span class="lineCov">        919 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">     766 </span>                :<span class="lineCov">        919 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">     767 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">     768 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">     769 </span>                :<span class="lineCov">        919 :     struct ds *out = &amp;ctx-&gt;output;</span>
<span class="lineNum">     770 </span>                :            :     int i;
<span class="lineNum">     771 </span>                :            : 
<span class="lineNum">     772 </span>[<span class="branchCov" title="Branch 0 was taken 31 times"> + </span><span class="branchCov" title="Branch 1 was taken 888 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 31 times"> + </span>]:<span class="lineCov">        919 :     if (id &amp;&amp; !must_exist) {</span>
<span class="lineNum">     773 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;--if-exists and --id may not be specified together&quot;);</span>
<span class="lineNum">     774 </span>                :            :     }
<span class="lineNum">     775 </span>                :            : 
<span class="lineNum">     776 </span>                :<span class="lineCov">        919 :     table = get_table(table_name);</span>
<span class="lineNum">     777 </span>                :<span class="lineCov">        919 :     row = get_row(ctx, table, record_id, must_exist);</span>
<span class="lineNum">     778 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 912 times"> + </span>]:<span class="lineCov">        913 :     if (!row) {</span>
<span class="lineNum">     779 </span>                :<span class="lineCov">          1 :         return;</span>
<span class="lineNum">     780 </span>                :            :     }
<span class="lineNum">     781 </span>                :            : 
<span class="lineNum">     782 </span>        [<span class="branchCov" title="Branch 0 was taken 31 times"> + </span><span class="branchCov" title="Branch 1 was taken 881 times"> + </span>]:<span class="lineCov">        912 :     if (id) {</span>
<span class="lineNum">     783 </span>                :            :         struct ovsdb_symbol *symbol;
<span class="lineNum">     784 </span>                :            :         bool new;
<span class="lineNum">     785 </span>                :            : 
<span class="lineNum">     786 </span>                :<span class="lineCov">         31 :         symbol = create_symbol(ctx-&gt;symtab, id, &amp;new);</span>
<span class="lineNum">     787 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 31 times"> + </span>]:<span class="lineCov">         31 :         if (!new) {</span>
<span class="lineNum">     788 </span>                :<span class="lineNoCov">          0 :             ctl_fatal(&quot;row id \&quot;%s\&quot; specified on \&quot;get\&quot; command was used &quot;</span>
<span class="lineNum">     789 </span>                :            :                       &quot;before it was defined&quot;, id);
<span class="lineNum">     790 </span>                :            :         }
<span class="lineNum">     791 </span>                :<span class="lineCov">         31 :         symbol-&gt;uuid = row-&gt;uuid;</span>
<span class="lineNum">     792 </span>                :            : 
<span class="lineNum">     793 </span>                :            :         /* This symbol refers to a row that already exists, so disable warnings
<span class="lineNum">     794 </span>                :            :          * about it being unreferenced. */
<span class="lineNum">     795 </span>                :<span class="lineCov">         31 :         symbol-&gt;strong_ref = true;</span>
<span class="lineNum">     796 </span>                :            :     }
<span class="lineNum">     797 </span>        [<span class="branchCov" title="Branch 0 was taken 898 times"> + </span><span class="branchCov" title="Branch 1 was taken 906 times"> + </span>]:<span class="lineCov">       1804 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">     798 </span>                :            :         const struct ovsdb_idl_column *column;
<span class="lineNum">     799 </span>                :            :         const struct ovsdb_datum *datum;
<span class="lineNum">     800 </span>                :            :         char *key_string;
<span class="lineNum">     801 </span>                :            : 
<span class="lineNum">     802 </span>                :            :         /* Special case for obtaining the UUID of a row.  We can't just do this
<span class="lineNum">     803 </span>                :            :          * through parse_column_key_value() below since it returns a &quot;struct
<span class="lineNum">     804 </span>                :            :          * ovsdb_idl_column&quot; and the UUID column doesn't have one. */
<span class="lineNum">     805 </span>        [<span class="branchCov" title="Branch 0 was taken 896 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        898 :         if (!strcasecmp(ctx-&gt;argv[i], &quot;_uuid&quot;)</span>
<span class="lineNum">     806 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 896 times"> + </span>]:<span class="lineCov">        896 :             || !strcasecmp(ctx-&gt;argv[i], &quot;-uuid&quot;)) {</span>
<span class="lineNum">     807 </span>                :<span class="lineCov">          2 :             ds_put_format(out, UUID_FMT&quot;\n&quot;, UUID_ARGS(&amp;row-&gt;uuid));</span>
<span class="lineNum">     808 </span>                :<span class="lineCov">          2 :             continue;</span>
<span class="lineNum">     809 </span>                :            :         }
<span class="lineNum">     810 </span>                :            : 
<span class="lineNum">     811 </span>                :<span class="lineCov">        896 :         die_if_error(parse_column_key_value(ctx-&gt;argv[i], table,</span>
<span class="lineNum">     812 </span>                :            :                                             &amp;column, &amp;key_string,
<span class="lineNum">     813 </span>                :            :                                             NULL, NULL, 0, NULL));
<span class="lineNum">     814 </span>                :            : 
<span class="lineNum">     815 </span>                :<span class="lineCov">        894 :         ovsdb_idl_txn_verify(row, column);</span>
<span class="lineNum">     816 </span>                :<span class="lineCov">        894 :         datum = ovsdb_idl_read(row, column);</span>
<span class="lineNum">     817 </span>        [<span class="branchCov" title="Branch 0 was taken 159 times"> + </span><span class="branchCov" title="Branch 1 was taken 735 times"> + </span>]:<span class="lineCov">        894 :         if (key_string) {</span>
<span class="lineNum">     818 </span>                :            :             union ovsdb_atom key;
<span class="lineNum">     819 </span>                :            :             unsigned int idx;
<span class="lineNum">     820 </span>                :            : 
<span class="lineNum">     821 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 158 times"> + </span>]:<span class="lineCov">        159 :             if (column-&gt;type.value.type == OVSDB_TYPE_VOID) {</span>
<span class="lineNum">     822 </span>                :<span class="lineCov">          1 :                 ctl_fatal(&quot;cannot specify key to get for non-map column %s&quot;,</span>
<span class="lineNum">     823 </span>                :<span class="lineCov">          1 :                           column-&gt;name);</span>
<span class="lineNum">     824 </span>                :            :             }
<span class="lineNum">     825 </span>                :            : 
<span class="lineNum">     826 </span>                :<span class="lineCov">        158 :             die_if_error(ovsdb_atom_from_string(&amp;key,</span>
<span class="lineNum">     827 </span>                :<span class="lineCov">        158 :                                                 &amp;column-&gt;type.key,</span>
<span class="lineNum">     828 </span>                :            :                                                 key_string, ctx-&gt;symtab));
<span class="lineNum">     829 </span>                :            : 
<span class="lineNum">     830 </span>                :<span class="lineCov">        158 :             idx = ovsdb_datum_find_key(datum, &amp;key,</span>
<span class="lineNum">     831 </span>                :<span class="lineCov">        158 :                                        column-&gt;type.key.type);</span>
<span class="lineNum">     832 </span>        [<span class="branchCov" title="Branch 0 was taken 82 times"> + </span><span class="branchCov" title="Branch 1 was taken 76 times"> + </span>]:<span class="lineCov">        158 :             if (idx == UINT_MAX) {</span>
<span class="lineNum">     833 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 79 times"> + </span>]:<span class="lineCov">         82 :                 if (must_exist) {</span>
<span class="lineNum">     834 </span>                :<span class="lineCov">          3 :                     ctl_fatal(&quot;no key \&quot;%s\&quot; in %s record \&quot;%s\&quot; column %s&quot;,</span>
<span class="lineNum">     835 </span>                :<span class="lineCov">          3 :                               key_string, table-&gt;class-&gt;name, record_id,</span>
<span class="lineNum">     836 </span>                :<span class="lineCov">          3 :                               column-&gt;name);</span>
<span class="lineNum">     837 </span>                :            :                 }
<span class="lineNum">     838 </span>                :            :             } else {
<span class="lineNum">     839 </span>                :<span class="lineCov">         76 :                 ovsdb_atom_to_string(&amp;datum-&gt;values[idx],</span>
<span class="lineNum">     840 </span>                :<span class="lineCov">         76 :                                      column-&gt;type.value.type, out);</span>
<span class="lineNum">     841 </span>                :            :             }
<span class="lineNum">     842 </span>                :<span class="lineCov">        155 :             ovsdb_atom_destroy(&amp;key, column-&gt;type.key.type);</span>
<span class="lineNum">     843 </span>                :            :         } else {
<span class="lineNum">     844 </span>                :<span class="lineCov">        735 :             ovsdb_datum_to_string(datum, &amp;column-&gt;type, out);</span>
<span class="lineNum">     845 </span>                :            :         }
<span class="lineNum">     846 </span>                :<span class="lineCov">        890 :         ds_put_char(out, '\n');</span>
<span class="lineNum">     847 </span>                :            : 
<span class="lineNum">     848 </span>                :<span class="lineCov">        890 :         free(key_string);</span>
<span class="lineNum">     849 </span>                :            :     }
<span class="lineNum">     850 </span>                :            : }
<a name="851"><span class="lineNum">     851 </span>                :            : </a>
<span class="lineNum">     852 </span>                :            : static void
<span class="lineNum">     853 </span>                :<span class="lineCov">        850 : parse_column_names(const char *column_names,</span>
<span class="lineNum">     854 </span>                :            :                    const struct ctl_table_class *table,
<span class="lineNum">     855 </span>                :            :                    const struct ovsdb_idl_column ***columnsp,
<span class="lineNum">     856 </span>                :            :                    size_t *n_columnsp)
<span class="lineNum">     857 </span>                :            : {
<span class="lineNum">     858 </span>                :            :     const struct ovsdb_idl_column **columns;
<span class="lineNum">     859 </span>                :            :     size_t n_columns;
<span class="lineNum">     860 </span>                :            : 
<span class="lineNum">     861 </span>        [<span class="branchCov" title="Branch 0 was taken 390 times"> + </span><span class="branchCov" title="Branch 1 was taken 460 times"> + </span>]:<span class="lineCov">        850 :     if (!column_names) {</span>
<span class="lineNum">     862 </span>                :            :         size_t i;
<span class="lineNum">     863 </span>                :            : 
<span class="lineNum">     864 </span>                :<span class="lineCov">        390 :         n_columns = table-&gt;class-&gt;n_columns + 1;</span>
<span class="lineNum">     865 </span>                :<span class="lineCov">        390 :         columns = xmalloc(n_columns * sizeof *columns);</span>
<span class="lineNum">     866 </span>                :<span class="lineCov">        390 :         columns[0] = NULL;</span>
<span class="lineNum">     867 </span>        [<span class="branchCov" title="Branch 0 was taken 7802 times"> + </span><span class="branchCov" title="Branch 1 was taken 390 times"> + </span>]:<span class="lineCov">       8192 :         for (i = 0; i &lt; table-&gt;class-&gt;n_columns; i++) {</span>
<span class="lineNum">     868 </span>                :<span class="lineCov">       7802 :             columns[i + 1] = &amp;table-&gt;class-&gt;columns[i];</span>
<span class="lineNum">     869 </span>                :            :         }
<span class="lineNum">     870 </span>                :            :     } else {
<span class="lineNum">     871 </span>                :<span class="lineCov">        460 :         char *s = xstrdup(column_names);</span>
<span class="lineNum">     872 </span>                :            :         size_t allocated_columns;
<span class="lineNum">     873 </span>                :<span class="lineCov">        460 :         char *save_ptr = NULL;</span>
<span class="lineNum">     874 </span>                :            :         char *column_name;
<span class="lineNum">     875 </span>                :            : 
<span class="lineNum">     876 </span>                :<span class="lineCov">        460 :         columns = NULL;</span>
<span class="lineNum">     877 </span>                :<span class="lineCov">        460 :         allocated_columns = n_columns = 0;</span>
<span class="lineNum">     878 </span>        [<span class="branchCov" title="Branch 1 was taken 498 times"> + </span><span class="branchCov" title="Branch 2 was taken 458 times"> + </span>]:<span class="lineCov">        956 :         for (column_name = strtok_r(s, &quot;, &quot;, &amp;save_ptr); column_name;</span>
<span class="lineNum">     879 </span>                :<span class="lineCov">        496 :              column_name = strtok_r(NULL, &quot;, &quot;, &amp;save_ptr)) {</span>
<span class="lineNum">     880 </span>                :            :             const struct ovsdb_idl_column *column;
<span class="lineNum">     881 </span>                :            : 
<span class="lineNum">     882 </span>        [<span class="branchCov" title="Branch 0 was taken 88 times"> + </span><span class="branchCov" title="Branch 1 was taken 410 times"> + </span>]:<span class="lineCov">        498 :             if (!strcasecmp(column_name, &quot;_uuid&quot;)) {</span>
<span class="lineNum">     883 </span>                :<span class="lineCov">         88 :                 column = NULL;</span>
<span class="lineNum">     884 </span>                :            :             } else {
<span class="lineNum">     885 </span>                :<span class="lineCov">        410 :                 die_if_error(get_column(table, column_name, &amp;column));</span>
<span class="lineNum">     886 </span>                :            :             }
<span class="lineNum">     887 </span>        [<span class="branchCov" title="Branch 0 was taken 494 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        496 :             if (n_columns &gt;= allocated_columns) {</span>
<span class="lineNum">     888 </span>                :<span class="lineCov">        494 :                 columns = x2nrealloc(columns, &amp;allocated_columns,</span>
<span class="lineNum">     889 </span>                :            :                                      sizeof *columns);
<span class="lineNum">     890 </span>                :            :             }
<span class="lineNum">     891 </span>                :<span class="lineCov">        496 :             columns[n_columns++] = column;</span>
<span class="lineNum">     892 </span>                :            :         }
<span class="lineNum">     893 </span>                :<span class="lineCov">        458 :         free(s);</span>
<span class="lineNum">     894 </span>                :            : 
<span class="lineNum">     895 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 458 times"> + </span>]:<span class="lineCov">        458 :         if (!n_columns) {</span>
<span class="lineNum">     896 </span>                :<span class="lineCov">        458 :             ctl_fatal(&quot;must specify at least one column name&quot;);</span>
<span class="lineNum">     897 </span>                :            :         }
<span class="lineNum">     898 </span>                :            :     }
<span class="lineNum">     899 </span>                :<span class="lineCov">        848 :     *columnsp = columns;</span>
<span class="lineNum">     900 </span>                :<span class="lineCov">        848 :     *n_columnsp = n_columns;</span>
<span class="lineNum">     901 </span>                :<span class="lineCov">        848 : }</span>
<a name="902"><span class="lineNum">     902 </span>                :            : </a>
<span class="lineNum">     903 </span>                :            : static void
<span class="lineNum">     904 </span>                :<span class="lineCov">        426 : pre_list_columns(struct ctl_context *ctx,</span>
<span class="lineNum">     905 </span>                :            :                  const struct ctl_table_class *table,
<span class="lineNum">     906 </span>                :            :                  const char *column_names)
<span class="lineNum">     907 </span>                :            : {
<span class="lineNum">     908 </span>                :            :     const struct ovsdb_idl_column **columns;
<span class="lineNum">     909 </span>                :            :     size_t n_columns;
<span class="lineNum">     910 </span>                :            :     size_t i;
<span class="lineNum">     911 </span>                :            : 
<span class="lineNum">     912 </span>                :<span class="lineCov">        426 :     parse_column_names(column_names, table, &amp;columns, &amp;n_columns);</span>
<span class="lineNum">     913 </span>        [<span class="branchCov" title="Branch 0 was taken 4344 times"> + </span><span class="branchCov" title="Branch 1 was taken 424 times"> + </span>]:<span class="lineCov">       4768 :     for (i = 0; i &lt; n_columns; i++) {</span>
<span class="lineNum">     914 </span>        [<span class="branchCov" title="Branch 0 was taken 4105 times"> + </span><span class="branchCov" title="Branch 1 was taken 239 times"> + </span>]:<span class="lineCov">       4344 :         if (columns[i]) {</span>
<span class="lineNum">     915 </span>                :<span class="lineCov">       4105 :             ovsdb_idl_add_column(ctx-&gt;idl, columns[i]);</span>
<span class="lineNum">     916 </span>                :            :         }
<span class="lineNum">     917 </span>                :            :     }
<span class="lineNum">     918 </span>                :<span class="lineCov">        424 :     free(columns);</span>
<span class="lineNum">     919 </span>                :<span class="lineCov">        424 : }</span>
<a name="920"><span class="lineNum">     920 </span>                :            : </a>
<span class="lineNum">     921 </span>                :            : static void
<span class="lineNum">     922 </span>                :<span class="lineCov">        291 : pre_cmd_list(struct ctl_context *ctx)</span>
<span class="lineNum">     923 </span>                :            : {
<span class="lineNum">     924 </span>                :<span class="lineCov">        291 :     const char *column_names = shash_find_data(&amp;ctx-&gt;options, &quot;--columns&quot;);</span>
<span class="lineNum">     925 </span>                :<span class="lineCov">        291 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">     926 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">     927 </span>                :            : 
<span class="lineNum">     928 </span>                :<span class="lineCov">        291 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">     929 </span>                :<span class="lineCov">        290 :     pre_list_columns(ctx, table, column_names);</span>
<span class="lineNum">     930 </span>                :<span class="lineCov">        288 : }</span>
<a name="931"><span class="lineNum">     931 </span>                :            : </a>
<span class="lineNum">     932 </span>                :            : static struct table *
<span class="lineNum">     933 </span>                :<span class="lineCov">        424 : list_make_table(const struct ovsdb_idl_column **columns, size_t n_columns)</span>
<span class="lineNum">     934 </span>                :            : {
<span class="lineNum">     935 </span>                :            :     struct table *out;
<span class="lineNum">     936 </span>                :            :     size_t i;
<span class="lineNum">     937 </span>                :            : 
<span class="lineNum">     938 </span>                :<span class="lineCov">        424 :     out = xmalloc(sizeof *out);</span>
<span class="lineNum">     939 </span>                :<span class="lineCov">        424 :     table_init(out);</span>
<span class="lineNum">     940 </span>                :            : 
<span class="lineNum">     941 </span>        [<span class="branchCov" title="Branch 0 was taken 4344 times"> + </span><span class="branchCov" title="Branch 1 was taken 424 times"> + </span>]:<span class="lineCov">       4768 :     for (i = 0; i &lt; n_columns; i++) {</span>
<span class="lineNum">     942 </span>                :<span class="lineCov">       4344 :         const struct ovsdb_idl_column *column = columns[i];</span>
<span class="lineNum">     943 </span>        [<span class="branchCov" title="Branch 0 was taken 4105 times"> + </span><span class="branchCov" title="Branch 1 was taken 239 times"> + </span>]:<span class="lineCov">       4344 :         const char *column_name = column ? column-&gt;name : &quot;_uuid&quot;;</span>
<span class="lineNum">     944 </span>                :            : 
<span class="lineNum">     945 </span>                :<span class="lineCov">       4344 :         table_add_column(out, &quot;%s&quot;, column_name);</span>
<span class="lineNum">     946 </span>                :            :     }
<span class="lineNum">     947 </span>                :            : 
<span class="lineNum">     948 </span>                :<span class="lineCov">        424 :     return out;</span>
<span class="lineNum">     949 </span>                :            : }
<a name="950"><span class="lineNum">     950 </span>                :            : </a>
<span class="lineNum">     951 </span>                :            : static void
<span class="lineNum">     952 </span>                :<span class="lineCov">       1783 : list_record(const struct ovsdb_idl_row *row,</span>
<span class="lineNum">     953 </span>                :            :             const struct ovsdb_idl_column **columns, size_t n_columns,
<span class="lineNum">     954 </span>                :            :             struct table *out)
<span class="lineNum">     955 </span>                :            : {
<span class="lineNum">     956 </span>                :            :     size_t i;
<span class="lineNum">     957 </span>                :            : 
<span class="lineNum">     958 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1782 times"> + </span>]:<span class="lineCov">       1783 :     if (!row) {</span>
<span class="lineNum">     959 </span>                :<span class="lineCov">          1 :         return;</span>
<span class="lineNum">     960 </span>                :            :     }
<span class="lineNum">     961 </span>                :            : 
<span class="lineNum">     962 </span>                :<span class="lineCov">       1782 :     table_add_row(out);</span>
<span class="lineNum">     963 </span>        [<span class="branchCov" title="Branch 0 was taken 11603 times"> + </span><span class="branchCov" title="Branch 1 was taken 1782 times"> + </span>]:<span class="lineCov">      13385 :     for (i = 0; i &lt; n_columns; i++) {</span>
<span class="lineNum">     964 </span>                :<span class="lineCov">      11603 :         const struct ovsdb_idl_column *column = columns[i];</span>
<span class="lineNum">     965 </span>                :<span class="lineCov">      11603 :         struct cell *cell = table_add_cell(out);</span>
<span class="lineNum">     966 </span>                :            : 
<span class="lineNum">     967 </span>        [<span class="branchCov" title="Branch 0 was taken 1067 times"> + </span><span class="branchCov" title="Branch 1 was taken 10536 times"> + </span>]:<span class="lineCov">      11603 :         if (!column) {</span>
<span class="lineNum">     968 </span>                :            :             struct ovsdb_datum datum;
<span class="lineNum">     969 </span>                :            :             union ovsdb_atom atom;
<span class="lineNum">     970 </span>                :            : 
<span class="lineNum">     971 </span>                :<span class="lineCov">       1067 :             atom.uuid = row-&gt;uuid;</span>
<span class="lineNum">     972 </span>                :            : 
<span class="lineNum">     973 </span>                :<span class="lineCov">       1067 :             datum.keys = &amp;atom;</span>
<span class="lineNum">     974 </span>                :<span class="lineCov">       1067 :             datum.values = NULL;</span>
<span class="lineNum">     975 </span>                :<span class="lineCov">       1067 :             datum.n = 1;</span>
<span class="lineNum">     976 </span>                :            : 
<span class="lineNum">     977 </span>                :<span class="lineCov">       1067 :             cell-&gt;json = ovsdb_datum_to_json(&amp;datum, &amp;ovsdb_type_uuid);</span>
<span class="lineNum">     978 </span>                :<span class="lineCov">       1067 :             cell-&gt;type = &amp;ovsdb_type_uuid;</span>
<span class="lineNum">     979 </span>                :            :         } else {
<span class="lineNum">     980 </span>                :<span class="lineCov">      10536 :             const struct ovsdb_datum *datum = ovsdb_idl_read(row, column);</span>
<span class="lineNum">     981 </span>                :            : 
<span class="lineNum">     982 </span>                :<span class="lineCov">      10536 :             cell-&gt;json = ovsdb_datum_to_json(datum, &amp;column-&gt;type);</span>
<span class="lineNum">     983 </span>                :<span class="lineCov">      10536 :             cell-&gt;type = &amp;column-&gt;type;</span>
<span class="lineNum">     984 </span>                :            :         }
<span class="lineNum">     985 </span>                :            :     }
<span class="lineNum">     986 </span>                :            : }
<a name="987"><span class="lineNum">     987 </span>                :            : </a>
<span class="lineNum">     988 </span>                :            : static void
<span class="lineNum">     989 </span>                :<span class="lineCov">        288 : cmd_list(struct ctl_context *ctx)</span>
<span class="lineNum">     990 </span>                :            : {
<span class="lineNum">     991 </span>                :<span class="lineCov">        288 :     const char *column_names = shash_find_data(&amp;ctx-&gt;options, &quot;--columns&quot;);</span>
<span class="lineNum">     992 </span>                :<span class="lineCov">        288 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">     993 </span>                :            :     const struct ovsdb_idl_column **columns;
<span class="lineNum">     994 </span>                :<span class="lineCov">        288 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">     995 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">     996 </span>                :            :     struct table *out;
<span class="lineNum">     997 </span>                :            :     size_t n_columns;
<span class="lineNum">     998 </span>                :            :     int i;
<span class="lineNum">     999 </span>                :            : 
<span class="lineNum">    1000 </span>                :<span class="lineCov">        288 :     table = get_table(table_name);</span>
<span class="lineNum">    1001 </span>                :<span class="lineCov">        288 :     parse_column_names(column_names, table, &amp;columns, &amp;n_columns);</span>
<span class="lineNum">    1002 </span>                :<span class="lineCov">        288 :     out = ctx-&gt;table = list_make_table(columns, n_columns);</span>
<span class="lineNum">    1003 </span>        [<span class="branchCov" title="Branch 0 was taken 121 times"> + </span><span class="branchCov" title="Branch 1 was taken 167 times"> + </span>]:<span class="lineCov">        288 :     if (ctx-&gt;argc &gt; 2) {</span>
<span class="lineNum">    1004 </span>        [<span class="branchCov" title="Branch 0 was taken 123 times"> + </span><span class="branchCov" title="Branch 1 was taken 116 times"> + </span>]:<span class="lineCov">        239 :         for (i = 2; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1005 </span>                :<span class="lineCov">        123 :             list_record(get_row(ctx, table, ctx-&gt;argv[i], must_exist),</span>
<span class="lineNum">    1006 </span>                :            :                         columns, n_columns, out);
<span class="lineNum">    1007 </span>                :            :         }
<span class="lineNum">    1008 </span>                :            :     } else {
<span class="lineNum">    1009 </span>                :            :         const struct ovsdb_idl_row *row;
<span class="lineNum">    1010 </span>                :            : 
<span class="lineNum">    1011 </span>        [<span class="branchCov" title="Branch 1 was taken 1342 times"> + </span><span class="branchCov" title="Branch 2 was taken 167 times"> + </span>]:<span class="lineCov">       1509 :         for (row = ovsdb_idl_first_row(ctx-&gt;idl, table-&gt;class); row != NULL;</span>
<span class="lineNum">    1012 </span>                :<span class="lineCov">       1342 :              row = ovsdb_idl_next_row(row)) {</span>
<span class="lineNum">    1013 </span>                :<span class="lineCov">       1342 :             list_record(row, columns, n_columns, out);</span>
<span class="lineNum">    1014 </span>                :            :         }
<span class="lineNum">    1015 </span>                :            :     }
<span class="lineNum">    1016 </span>                :<span class="lineCov">        283 :     free(columns);</span>
<span class="lineNum">    1017 </span>                :<span class="lineCov">        283 : }</span>
<span class="lineNum">    1018 </span>                :            : 
<span class="lineNum">    1019 </span>                :            : /* Finds and returns the &quot;struct ctl_table_class *&quot; with 'table_name' by
<a name="1020"><span class="lineNum">    1020 </span>                :            :  * searching the 'tables'. */</a>
<span class="lineNum">    1021 </span>                :            : static const struct ctl_table_class *
<span class="lineNum">    1022 </span>                :<span class="lineCov">      10299 : get_table(const char *table_name)</span>
<span class="lineNum">    1023 </span>                :            : {
<span class="lineNum">    1024 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1025 </span>                :<span class="lineCov">      10299 :     const struct ctl_table_class *best_match = NULL;</span>
<span class="lineNum">    1026 </span>                :<span class="lineCov">      10299 :     unsigned int best_score = 0;</span>
<span class="lineNum">    1027 </span>                :            : 
<span class="lineNum">    1028 </span>        [<span class="branchCov" title="Branch 0 was taken 161394 times"> + </span><span class="branchCov" title="Branch 1 was taken 10299 times"> + </span>]:<span class="lineCov">     171693 :     for (table = tables; table-&gt;class; table++) {</span>
<span class="lineNum">    1029 </span>                :<span class="lineCov">     161394 :         unsigned int score = score_partial_match(table-&gt;class-&gt;name,</span>
<span class="lineNum">    1030 </span>                :            :                                                  table_name);
<span class="lineNum">    1031 </span>        [<span class="branchCov" title="Branch 0 was taken 10298 times"> + </span><span class="branchCov" title="Branch 1 was taken 151096 times"> + </span>]:<span class="lineCov">     161394 :         if (score &gt; best_score) {</span>
<span class="lineNum">    1032 </span>                :<span class="lineCov">      10298 :             best_match = table;</span>
<span class="lineNum">    1033 </span>                :<span class="lineCov">      10298 :             best_score = score;</span>
<span class="lineNum">    1034 </span>        [<span class="branchCov" title="Branch 0 was taken 25324 times"> + </span><span class="branchCov" title="Branch 1 was taken 125772 times"> + </span>]:<span class="lineCov">     151096 :         } else if (score == best_score) {</span>
<span class="lineNum">    1035 </span>                :<span class="lineCov">      25324 :             best_match = NULL;</span>
<span class="lineNum">    1036 </span>                :            :         }
<span class="lineNum">    1037 </span>                :            :     }
<span class="lineNum">    1038 </span>        [<span class="branchCov" title="Branch 0 was taken 10298 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">      10299 :     if (best_match) {</span>
<span class="lineNum">    1039 </span>                :<span class="lineCov">      10298 :         return best_match;</span>
<span class="lineNum">    1040 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :     } else if (best_score) {</span>
<span class="lineNum">    1041 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;multiple table names match \&quot;%s\&quot;&quot;, table_name);</span>
<span class="lineNum">    1042 </span>                :            :     } else {
<span class="lineNum">    1043 </span>                :<span class="lineCov">          1 :         ctl_fatal(&quot;unknown table \&quot;%s\&quot;&quot;, table_name);</span>
<span class="lineNum">    1044 </span>                :            :     }
<span class="lineNum">    1045 </span>                :            :     return NULL;
<span class="lineNum">    1046 </span>                :            : }
<a name="1047"><span class="lineNum">    1047 </span>                :            : </a>
<span class="lineNum">    1048 </span>                :            : static void
<span class="lineNum">    1049 </span>                :<span class="lineCov">        136 : pre_cmd_find(struct ctl_context *ctx)</span>
<span class="lineNum">    1050 </span>                :            : {
<span class="lineNum">    1051 </span>                :<span class="lineCov">        136 :     const char *column_names = shash_find_data(&amp;ctx-&gt;options, &quot;--columns&quot;);</span>
<span class="lineNum">    1052 </span>                :<span class="lineCov">        136 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1053 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1054 </span>                :            :     int i;
<span class="lineNum">    1055 </span>                :            : 
<span class="lineNum">    1056 </span>                :<span class="lineCov">        136 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1057 </span>                :<span class="lineCov">        136 :     pre_list_columns(ctx, table, column_names);</span>
<span class="lineNum">    1058 </span>        [<span class="branchCov" title="Branch 0 was taken 136 times"> + </span><span class="branchCov" title="Branch 1 was taken 136 times"> + </span>]:<span class="lineCov">        272 :     for (i = 2; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1059 </span>                :<span class="lineCov">        136 :         pre_parse_column_key_value(ctx, ctx-&gt;argv[i], table);</span>
<span class="lineNum">    1060 </span>                :            :     }
<span class="lineNum">    1061 </span>                :<span class="lineCov">        136 : }</span>
<a name="1062"><span class="lineNum">    1062 </span>                :            : </a>
<span class="lineNum">    1063 </span>                :            : static void
<span class="lineNum">    1064 </span>                :<span class="lineCov">        136 : cmd_find(struct ctl_context *ctx)</span>
<span class="lineNum">    1065 </span>                :            : {
<span class="lineNum">    1066 </span>                :<span class="lineCov">        136 :     const char *column_names = shash_find_data(&amp;ctx-&gt;options, &quot;--columns&quot;);</span>
<span class="lineNum">    1067 </span>                :            :     const struct ovsdb_idl_column **columns;
<span class="lineNum">    1068 </span>                :<span class="lineCov">        136 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1069 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1070 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1071 </span>                :            :     struct table *out;
<span class="lineNum">    1072 </span>                :            :     size_t n_columns;
<span class="lineNum">    1073 </span>                :            : 
<span class="lineNum">    1074 </span>                :<span class="lineCov">        136 :     table = get_table(table_name);</span>
<span class="lineNum">    1075 </span>                :<span class="lineCov">        136 :     parse_column_names(column_names, table, &amp;columns, &amp;n_columns);</span>
<span class="lineNum">    1076 </span>                :<span class="lineCov">        136 :     out = ctx-&gt;table = list_make_table(columns, n_columns);</span>
<span class="lineNum">    1077 </span>        [<span class="branchCov" title="Branch 1 was taken 843 times"> + </span><span class="branchCov" title="Branch 2 was taken 136 times"> + </span>]:<span class="lineCov">        979 :     for (row = ovsdb_idl_first_row(ctx-&gt;idl, table-&gt;class); row;</span>
<span class="lineNum">    1078 </span>                :<span class="lineCov">        843 :          row = ovsdb_idl_next_row(row)) {</span>
<span class="lineNum">    1079 </span>                :            :         int i;
<span class="lineNum">    1080 </span>                :            : 
<span class="lineNum">    1081 </span>        [<span class="branchCov" title="Branch 0 was taken 843 times"> + </span><span class="branchCov" title="Branch 1 was taken 323 times"> + </span>]:<span class="lineCov">       1166 :         for (i = 2; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1082 </span>        [<span class="branchCov" title="Branch 1 was taken 520 times"> + </span><span class="branchCov" title="Branch 2 was taken 323 times"> + </span>]:<span class="lineCov">        843 :             if (!is_condition_satisfied(table, row, ctx-&gt;argv[i],</span>
<span class="lineNum">    1083 </span>                :            :                                         ctx-&gt;symtab)) {
<span class="lineNum">    1084 </span>                :<span class="lineCov">        520 :                 goto next_row;</span>
<span class="lineNum">    1085 </span>                :            :             }
<span class="lineNum">    1086 </span>                :            :         }
<span class="lineNum">    1087 </span>                :<span class="lineCov">        323 :         list_record(row, columns, n_columns, out);</span>
<span class="lineNum">    1088 </span>                :            : 
<span class="lineNum">    1089 </span>                :            :     next_row: ;
<span class="lineNum">    1090 </span>                :            :     }
<span class="lineNum">    1091 </span>                :<span class="lineCov">        136 :     free(columns);</span>
<span class="lineNum">    1092 </span>                :<span class="lineCov">        136 : }</span>
<span class="lineNum">    1093 </span>                :            : 
<a name="1094"><span class="lineNum">    1094 </span>                :            : /* Sets the column of 'row' in 'table'. */</a>
<span class="lineNum">    1095 </span>                :            : static void
<span class="lineNum">    1096 </span>                :<span class="lineCov">       8373 : set_column(const struct ctl_table_class *table,</span>
<span class="lineNum">    1097 </span>                :            :            const struct ovsdb_idl_row *row, const char *arg,
<span class="lineNum">    1098 </span>                :            :            struct ovsdb_symbol_table *symtab)
<span class="lineNum">    1099 </span>                :            : {
<span class="lineNum">    1100 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">    1101 </span>                :            :     char *key_string, *value_string;
<span class="lineNum">    1102 </span>                :            :     char *error;
<span class="lineNum">    1103 </span>                :            : 
<span class="lineNum">    1104 </span>                :<span class="lineCov">       8373 :     error = parse_column_key_value(arg, table, &amp;column, &amp;key_string,</span>
<span class="lineNum">    1105 </span>                :            :                                    NULL, NULL, 0, &amp;value_string);
<span class="lineNum">    1106 </span>                :<span class="lineCov">       8373 :     die_if_error(error);</span>
<span class="lineNum">    1107 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 8372 times"> + </span>]:<span class="lineCov">       8372 :     if (!value_string) {</span>
<span class="lineNum">    1108 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;%s: missing value&quot;, arg);</span>
<span class="lineNum">    1109 </span>                :            :     }
<span class="lineNum">    1110 </span>                :<span class="lineCov">       8372 :     check_mutable(row, column);</span>
<span class="lineNum">    1111 </span>                :            : 
<span class="lineNum">    1112 </span>        [<span class="branchCov" title="Branch 0 was taken 3512 times"> + </span><span class="branchCov" title="Branch 1 was taken 4859 times"> + </span>]:<span class="lineCov">       8371 :     if (key_string) {</span>
<span class="lineNum">    1113 </span>                :            :         union ovsdb_atom key, value;
<span class="lineNum">    1114 </span>                :            :         struct ovsdb_datum datum;
<span class="lineNum">    1115 </span>                :            : 
<span class="lineNum">    1116 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 3511 times"> + </span>]:<span class="lineCov">       3512 :         if (column-&gt;type.value.type == OVSDB_TYPE_VOID) {</span>
<span class="lineNum">    1117 </span>                :<span class="lineCov">          1 :             ctl_fatal(&quot;cannot specify key to set for non-map column %s&quot;,</span>
<span class="lineNum">    1118 </span>                :<span class="lineCov">          1 :                       column-&gt;name);</span>
<span class="lineNum">    1119 </span>                :            :         }
<span class="lineNum">    1120 </span>                :            : 
<span class="lineNum">    1121 </span>                :<span class="lineCov">       3511 :         die_if_error(ovsdb_atom_from_string(&amp;key, &amp;column-&gt;type.key,</span>
<span class="lineNum">    1122 </span>                :            :                                             key_string, symtab));
<span class="lineNum">    1123 </span>                :<span class="lineCov">       3511 :         die_if_error(ovsdb_atom_from_string(&amp;value, &amp;column-&gt;type.value,</span>
<span class="lineNum">    1124 </span>                :            :                                             value_string, symtab));
<span class="lineNum">    1125 </span>                :            : 
<span class="lineNum">    1126 </span>                :<span class="lineCov">       3511 :         ovsdb_datum_init_empty(&amp;datum);</span>
<span class="lineNum">    1127 </span>                :<span class="lineCov">       3511 :         ovsdb_datum_add_unsafe(&amp;datum, &amp;key, &amp;value, &amp;column-&gt;type);</span>
<span class="lineNum">    1128 </span>                :            : 
<span class="lineNum">    1129 </span>                :<span class="lineCov">       3511 :         ovsdb_atom_destroy(&amp;key, column-&gt;type.key.type);</span>
<span class="lineNum">    1130 </span>                :<span class="lineCov">       3511 :         ovsdb_atom_destroy(&amp;value, column-&gt;type.value.type);</span>
<span class="lineNum">    1131 </span>                :            : 
<span class="lineNum">    1132 </span>                :<span class="lineCov">       3511 :         ovsdb_datum_union(&amp;datum, ovsdb_idl_read(row, column),</span>
<span class="lineNum">    1133 </span>                :<span class="lineCov">       3511 :                           &amp;column-&gt;type, false);</span>
<span class="lineNum">    1134 </span>                :<span class="lineCov">       3511 :         ovsdb_idl_txn_verify(row, column);</span>
<span class="lineNum">    1135 </span>                :<span class="lineCov">       3511 :         ovsdb_idl_txn_write(row, column, &amp;datum);</span>
<span class="lineNum">    1136 </span>                :            :     } else {
<span class="lineNum">    1137 </span>                :            :         struct ovsdb_datum datum;
<span class="lineNum">    1138 </span>                :            : 
<span class="lineNum">    1139 </span>                :<span class="lineCov">       4859 :         die_if_error(ovsdb_datum_from_string(&amp;datum, &amp;column-&gt;type,</span>
<span class="lineNum">    1140 </span>                :            :                                              value_string, symtab));
<span class="lineNum">    1141 </span>                :<span class="lineCov">       4854 :         ovsdb_idl_txn_write(row, column, &amp;datum);</span>
<span class="lineNum">    1142 </span>                :            :     }
<span class="lineNum">    1143 </span>                :            : 
<span class="lineNum">    1144 </span>                :<span class="lineCov">       8365 :     free(key_string);</span>
<span class="lineNum">    1145 </span>                :<span class="lineCov">       8365 :     free(value_string);</span>
<span class="lineNum">    1146 </span>                :<span class="lineCov">       8365 : }</span>
<a name="1147"><span class="lineNum">    1147 </span>                :            : </a>
<span class="lineNum">    1148 </span>                :            : static void
<span class="lineNum">    1149 </span>                :<span class="lineCov">       3511 : pre_cmd_set(struct ctl_context *ctx)</span>
<span class="lineNum">    1150 </span>                :            : {
<span class="lineNum">    1151 </span>                :<span class="lineCov">       3511 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1152 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1153 </span>                :            :     int i;
<span class="lineNum">    1154 </span>                :            : 
<span class="lineNum">    1155 </span>                :<span class="lineCov">       3511 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1156 </span>        [<span class="branchCov" title="Branch 0 was taken 7985 times"> + </span><span class="branchCov" title="Branch 1 was taken 3511 times"> + </span>]:<span class="lineCov">      11496 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1157 </span>                :<span class="lineCov">       7985 :         pre_parse_column_key_value(ctx, ctx-&gt;argv[i], table);</span>
<span class="lineNum">    1158 </span>                :            :     }
<span class="lineNum">    1159 </span>                :<span class="lineCov">       3511 : }</span>
<a name="1160"><span class="lineNum">    1160 </span>                :            : </a>
<span class="lineNum">    1161 </span>                :            : static void
<span class="lineNum">    1162 </span>                :<span class="lineCov">       3511 : cmd_set(struct ctl_context *ctx)</span>
<span class="lineNum">    1163 </span>                :            : {
<span class="lineNum">    1164 </span>                :<span class="lineCov">       3511 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">    1165 </span>                :<span class="lineCov">       3511 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1166 </span>                :<span class="lineCov">       3511 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">    1167 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1168 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1169 </span>                :            :     int i;
<span class="lineNum">    1170 </span>                :            : 
<span class="lineNum">    1171 </span>                :<span class="lineCov">       3511 :     table = get_table(table_name);</span>
<span class="lineNum">    1172 </span>                :<span class="lineCov">       3511 :     row = get_row(ctx, table, record_id, must_exist);</span>
<span class="lineNum">    1173 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 3508 times"> + </span>]:<span class="lineCov">       3509 :     if (!row) {</span>
<span class="lineNum">    1174 </span>                :<span class="lineCov">          1 :         return;</span>
<span class="lineNum">    1175 </span>                :            :     }
<span class="lineNum">    1176 </span>                :            : 
<span class="lineNum">    1177 </span>        [<span class="branchCov" title="Branch 0 was taken 7982 times"> + </span><span class="branchCov" title="Branch 1 was taken 3500 times"> + </span>]:<span class="lineCov">      11482 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1178 </span>                :<span class="lineCov">       7982 :         set_column(table, row, ctx-&gt;argv[i], ctx-&gt;symtab);</span>
<span class="lineNum">    1179 </span>                :            :     }
<span class="lineNum">    1180 </span>                :            : 
<span class="lineNum">    1181 </span>                :<span class="lineCov">       3500 :     invalidate_cache(ctx);</span>
<span class="lineNum">    1182 </span>                :            : }
<a name="1183"><span class="lineNum">    1183 </span>                :            : </a>
<span class="lineNum">    1184 </span>                :            : static void
<span class="lineNum">    1185 </span>                :<span class="lineCov">         29 : pre_cmd_add(struct ctl_context *ctx)</span>
<span class="lineNum">    1186 </span>                :            : {
<span class="lineNum">    1187 </span>                :<span class="lineCov">         29 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1188 </span>                :<span class="lineCov">         29 :     const char *column_name = ctx-&gt;argv[3];</span>
<span class="lineNum">    1189 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1190 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">    1191 </span>                :            : 
<span class="lineNum">    1192 </span>                :<span class="lineCov">         29 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1193 </span>                :<span class="lineCov">         29 :     pre_get_column(ctx, table, column_name, &amp;column);</span>
<span class="lineNum">    1194 </span>                :<span class="lineCov">         29 : }</span>
<a name="1195"><span class="lineNum">    1195 </span>                :            : </a>
<span class="lineNum">    1196 </span>                :            : static void
<span class="lineNum">    1197 </span>                :<span class="lineCov">         29 : cmd_add(struct ctl_context *ctx)</span>
<span class="lineNum">    1198 </span>                :            : {
<span class="lineNum">    1199 </span>                :<span class="lineCov">         29 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">    1200 </span>                :<span class="lineCov">         29 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1201 </span>                :<span class="lineCov">         29 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">    1202 </span>                :<span class="lineCov">         29 :     const char *column_name = ctx-&gt;argv[3];</span>
<span class="lineNum">    1203 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1204 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">    1205 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1206 </span>                :            :     const struct ovsdb_type *type;
<span class="lineNum">    1207 </span>                :            :     struct ovsdb_datum old;
<span class="lineNum">    1208 </span>                :            :     int i;
<span class="lineNum">    1209 </span>                :            : 
<span class="lineNum">    1210 </span>                :<span class="lineCov">         29 :     table = get_table(table_name);</span>
<span class="lineNum">    1211 </span>                :<span class="lineCov">         29 :     die_if_error(get_column(table, column_name, &amp;column));</span>
<span class="lineNum">    1212 </span>                :<span class="lineCov">         29 :     row = get_row(ctx, table, record_id, must_exist);</span>
<span class="lineNum">    1213 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 29 times"> + </span>]:<span class="lineCov">         29 :     if (!row) {</span>
<span class="lineNum">    1214 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1215 </span>                :            :     }
<span class="lineNum">    1216 </span>                :<span class="lineCov">         29 :     check_mutable(row, column);</span>
<span class="lineNum">    1217 </span>                :            : 
<span class="lineNum">    1218 </span>                :<span class="lineCov">         28 :     type = &amp;column-&gt;type;</span>
<span class="lineNum">    1219 </span>                :<span class="lineCov">         28 :     ovsdb_datum_clone(&amp;old, ovsdb_idl_read(row, column), &amp;column-&gt;type);</span>
<span class="lineNum">    1220 </span>        [<span class="branchCov" title="Branch 0 was taken 30 times"> + </span><span class="branchCov" title="Branch 1 was taken 28 times"> + </span>]:<span class="lineCov">         58 :     for (i = 4; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1221 </span>                :            :         struct ovsdb_type add_type;
<span class="lineNum">    1222 </span>                :            :         struct ovsdb_datum add;
<span class="lineNum">    1223 </span>                :            : 
<span class="lineNum">    1224 </span>                :<span class="lineCov">         30 :         add_type = *type;</span>
<span class="lineNum">    1225 </span>                :<span class="lineCov">         30 :         add_type.n_min = 1;</span>
<span class="lineNum">    1226 </span>                :<span class="lineCov">         30 :         add_type.n_max = UINT_MAX;</span>
<span class="lineNum">    1227 </span>                :<span class="lineCov">         30 :         die_if_error(ovsdb_datum_from_string(&amp;add, &amp;add_type, ctx-&gt;argv[i],</span>
<span class="lineNum">    1228 </span>                :            :                                              ctx-&gt;symtab));
<span class="lineNum">    1229 </span>                :<span class="lineCov">         30 :         ovsdb_datum_union(&amp;old, &amp;add, type, false);</span>
<span class="lineNum">    1230 </span>                :<span class="lineCov">         30 :         ovsdb_datum_destroy(&amp;add, type);</span>
<span class="lineNum">    1231 </span>                :            :     }
<span class="lineNum">    1232 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 27 times"> + </span>]:<span class="lineCov">         28 :     if (old.n &gt; type-&gt;n_max) {</span>
<span class="lineNum">    1233 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         ctl_fatal(&quot;\&quot;add\&quot; operation would put %u %s in column %s of &quot;</span>
<span class="lineNum">    1234 </span>                :            :                   &quot;table %s but the maximum number is %u&quot;,
<span class="lineNum">    1235 </span>                :            :                   old.n,
<span class="lineNum">    1236 </span>                :<span class="lineCov">          1 :                   type-&gt;value.type == OVSDB_TYPE_VOID ? &quot;values&quot; : &quot;pairs&quot;,</span>
<span class="lineNum">    1237 </span>                :<span class="lineCov">          2 :                   column-&gt;name, table-&gt;class-&gt;name, type-&gt;n_max);</span>
<span class="lineNum">    1238 </span>                :            :     }
<span class="lineNum">    1239 </span>                :<span class="lineCov">         27 :     ovsdb_idl_txn_verify(row, column);</span>
<span class="lineNum">    1240 </span>                :<span class="lineCov">         27 :     ovsdb_idl_txn_write(row, column, &amp;old);</span>
<span class="lineNum">    1241 </span>                :            : 
<span class="lineNum">    1242 </span>                :<span class="lineCov">         27 :     invalidate_cache(ctx);</span>
<span class="lineNum">    1243 </span>                :            : }
<a name="1244"><span class="lineNum">    1244 </span>                :            : </a>
<span class="lineNum">    1245 </span>                :            : static void
<span class="lineNum">    1246 </span>                :<span class="lineCov">         48 : pre_cmd_remove(struct ctl_context *ctx)</span>
<span class="lineNum">    1247 </span>                :            : {
<span class="lineNum">    1248 </span>                :<span class="lineCov">         48 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1249 </span>                :<span class="lineCov">         48 :     const char *column_name = ctx-&gt;argv[3];</span>
<span class="lineNum">    1250 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1251 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">    1252 </span>                :            : 
<span class="lineNum">    1253 </span>                :<span class="lineCov">         48 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1254 </span>                :<span class="lineCov">         48 :     pre_get_column(ctx, table, column_name, &amp;column);</span>
<span class="lineNum">    1255 </span>                :<span class="lineCov">         48 : }</span>
<a name="1256"><span class="lineNum">    1256 </span>                :            : </a>
<span class="lineNum">    1257 </span>                :            : static void
<span class="lineNum">    1258 </span>                :<span class="lineCov">         48 : cmd_remove(struct ctl_context *ctx)</span>
<span class="lineNum">    1259 </span>                :            : {
<span class="lineNum">    1260 </span>                :<span class="lineCov">         48 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">    1261 </span>                :<span class="lineCov">         48 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1262 </span>                :<span class="lineCov">         48 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">    1263 </span>                :<span class="lineCov">         48 :     const char *column_name = ctx-&gt;argv[3];</span>
<span class="lineNum">    1264 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1265 </span>                :            :     const struct ovsdb_idl_column *column;
<span class="lineNum">    1266 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1267 </span>                :            :     const struct ovsdb_type *type;
<span class="lineNum">    1268 </span>                :            :     struct ovsdb_datum old;
<span class="lineNum">    1269 </span>                :            :     int i;
<span class="lineNum">    1270 </span>                :            : 
<span class="lineNum">    1271 </span>                :<span class="lineCov">         48 :     table = get_table(table_name);</span>
<span class="lineNum">    1272 </span>                :<span class="lineCov">         48 :     die_if_error(get_column(table, column_name, &amp;column));</span>
<span class="lineNum">    1273 </span>                :<span class="lineCov">         48 :     row = get_row(ctx, table, record_id, must_exist);</span>
<span class="lineNum">    1274 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 43 times"> + </span>]:<span class="lineCov">         44 :     if (!row) {</span>
<span class="lineNum">    1275 </span>                :<span class="lineCov">          1 :         return;</span>
<span class="lineNum">    1276 </span>                :            :     }
<span class="lineNum">    1277 </span>                :<span class="lineCov">         43 :     check_mutable(row, column);</span>
<span class="lineNum">    1278 </span>                :            : 
<span class="lineNum">    1279 </span>                :<span class="lineCov">         42 :     type = &amp;column-&gt;type;</span>
<span class="lineNum">    1280 </span>                :<span class="lineCov">         42 :     ovsdb_datum_clone(&amp;old, ovsdb_idl_read(row, column), &amp;column-&gt;type);</span>
<span class="lineNum">    1281 </span>        [<span class="branchCov" title="Branch 0 was taken 43 times"> + </span><span class="branchCov" title="Branch 1 was taken 41 times"> + </span>]:<span class="lineCov">         84 :     for (i = 4; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1282 </span>                :            :         struct ovsdb_type rm_type;
<span class="lineNum">    1283 </span>                :            :         struct ovsdb_datum rm;
<span class="lineNum">    1284 </span>                :            :         char *error;
<span class="lineNum">    1285 </span>                :            : 
<span class="lineNum">    1286 </span>                :<span class="lineCov">         43 :         rm_type = *type;</span>
<span class="lineNum">    1287 </span>                :<span class="lineCov">         43 :         rm_type.n_min = 1;</span>
<span class="lineNum">    1288 </span>                :<span class="lineCov">         43 :         rm_type.n_max = UINT_MAX;</span>
<span class="lineNum">    1289 </span>                :<span class="lineCov">         43 :         error = ovsdb_datum_from_string(&amp;rm, &amp;rm_type,</span>
<span class="lineNum">    1290 </span>                :<span class="lineCov">         43 :                                         ctx-&gt;argv[i], ctx-&gt;symtab);</span>
<span class="lineNum">    1291 </span>                :            : 
<span class="lineNum">    1292 </span>        [<span class="branchCov" title="Branch 0 was taken 34 times"> + </span><span class="branchCov" title="Branch 1 was taken 9 times"> + </span>]:<span class="lineCov">         43 :         if (error) {</span>
<span class="lineNum">    1293 </span>        [<span class="branchCov" title="Branch 1 was taken 33 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">         34 :             if (ovsdb_type_is_map(&amp;rm_type)) {</span>
<span class="lineNum">    1294 </span>                :<span class="lineCov">         33 :                 rm_type.value.type = OVSDB_TYPE_VOID;</span>
<span class="lineNum">    1295 </span>                :<span class="lineCov">         33 :                 free(error);</span>
<span class="lineNum">    1296 </span>                :<span class="lineCov">         33 :                 die_if_error(ovsdb_datum_from_string(</span>
<span class="lineNum">    1297 </span>                :<span class="lineCov">         33 :                                                      &amp;rm, &amp;rm_type, ctx-&gt;argv[i], ctx-&gt;symtab));</span>
<span class="lineNum">    1298 </span>                :            :             } else {
<span class="lineNum">    1299 </span>                :<span class="lineCov">          1 :                 ctl_fatal(&quot;%s&quot;, error);</span>
<span class="lineNum">    1300 </span>                :            :             }
<span class="lineNum">    1301 </span>                :            :         }
<span class="lineNum">    1302 </span>                :<span class="lineCov">         42 :         ovsdb_datum_subtract(&amp;old, type, &amp;rm, &amp;rm_type);</span>
<span class="lineNum">    1303 </span>                :<span class="lineCov">         42 :         ovsdb_datum_destroy(&amp;rm, &amp;rm_type);</span>
<span class="lineNum">    1304 </span>                :            :     }
<span class="lineNum">    1305 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 40 times"> + </span>]:<span class="lineCov">         41 :     if (old.n &lt; type-&gt;n_min) {</span>
<span class="lineNum">    1306 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         ctl_fatal(&quot;\&quot;remove\&quot; operation would put %u %s in column %s of &quot;</span>
<span class="lineNum">    1307 </span>                :            :                   &quot;table %s but the minimum number is %u&quot;,
<span class="lineNum">    1308 </span>                :            :                   old.n,
<span class="lineNum">    1309 </span>                :<span class="lineCov">          1 :                   type-&gt;value.type == OVSDB_TYPE_VOID ? &quot;values&quot; : &quot;pairs&quot;,</span>
<span class="lineNum">    1310 </span>                :<span class="lineCov">          2 :                   column-&gt;name, table-&gt;class-&gt;name, type-&gt;n_min);</span>
<span class="lineNum">    1311 </span>                :            :     }
<span class="lineNum">    1312 </span>                :<span class="lineCov">         40 :     ovsdb_idl_txn_verify(row, column);</span>
<span class="lineNum">    1313 </span>                :<span class="lineCov">         40 :     ovsdb_idl_txn_write(row, column, &amp;old);</span>
<span class="lineNum">    1314 </span>                :            : 
<span class="lineNum">    1315 </span>                :<span class="lineCov">         40 :     invalidate_cache(ctx);</span>
<span class="lineNum">    1316 </span>                :            : }
<a name="1317"><span class="lineNum">    1317 </span>                :            : </a>
<span class="lineNum">    1318 </span>                :            : static void
<span class="lineNum">    1319 </span>                :<span class="lineCov">         14 : pre_cmd_clear(struct ctl_context *ctx)</span>
<span class="lineNum">    1320 </span>                :            : {
<span class="lineNum">    1321 </span>                :<span class="lineCov">         14 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1322 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1323 </span>                :            :     int i;
<span class="lineNum">    1324 </span>                :            : 
<span class="lineNum">    1325 </span>                :<span class="lineCov">         14 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1326 </span>        [<span class="branchCov" title="Branch 0 was taken 14 times"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">         28 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1327 </span>                :            :         const struct ovsdb_idl_column *column;
<span class="lineNum">    1328 </span>                :            : 
<span class="lineNum">    1329 </span>                :<span class="lineCov">         14 :         pre_get_column(ctx, table, ctx-&gt;argv[i], &amp;column);</span>
<span class="lineNum">    1330 </span>                :            :     }
<span class="lineNum">    1331 </span>                :<span class="lineCov">         14 : }</span>
<a name="1332"><span class="lineNum">    1332 </span>                :            : </a>
<span class="lineNum">    1333 </span>                :            : static void
<span class="lineNum">    1334 </span>                :<span class="lineCov">         14 : cmd_clear(struct ctl_context *ctx)</span>
<span class="lineNum">    1335 </span>                :            : {
<span class="lineNum">    1336 </span>                :<span class="lineCov">         14 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">    1337 </span>                :<span class="lineCov">         14 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1338 </span>                :<span class="lineCov">         14 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">    1339 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1340 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1341 </span>                :            :     int i;
<span class="lineNum">    1342 </span>                :            : 
<span class="lineNum">    1343 </span>                :<span class="lineCov">         14 :     table = get_table(table_name);</span>
<span class="lineNum">    1344 </span>                :<span class="lineCov">         14 :     row = get_row(ctx, table, record_id, must_exist);</span>
<span class="lineNum">    1345 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 12 times"> + </span>]:<span class="lineCov">         13 :     if (!row) {</span>
<span class="lineNum">    1346 </span>                :<span class="lineCov">          1 :         return;</span>
<span class="lineNum">    1347 </span>                :            :     }
<span class="lineNum">    1348 </span>                :            : 
<span class="lineNum">    1349 </span>        [<span class="branchCov" title="Branch 0 was taken 12 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">         22 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1350 </span>                :            :         const struct ovsdb_idl_column *column;
<span class="lineNum">    1351 </span>                :            :         const struct ovsdb_type *type;
<span class="lineNum">    1352 </span>                :            :         struct ovsdb_datum datum;
<span class="lineNum">    1353 </span>                :            : 
<span class="lineNum">    1354 </span>                :<span class="lineCov">         12 :         die_if_error(get_column(table, ctx-&gt;argv[i], &amp;column));</span>
<span class="lineNum">    1355 </span>                :<span class="lineCov">         12 :         check_mutable(row, column);</span>
<span class="lineNum">    1356 </span>                :            : 
<span class="lineNum">    1357 </span>                :<span class="lineCov">         11 :         type = &amp;column-&gt;type;</span>
<span class="lineNum">    1358 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">         11 :         if (type-&gt;n_min &gt; 0) {</span>
<span class="lineNum">    1359 </span>                :<span class="lineCov">          1 :             ctl_fatal(&quot;\&quot;clear\&quot; operation cannot be applied to column %s &quot;</span>
<span class="lineNum">    1360 </span>                :            :                       &quot;of table %s, which is not allowed to be empty&quot;,
<span class="lineNum">    1361 </span>                :<span class="lineCov">          2 :                       column-&gt;name, table-&gt;class-&gt;name);</span>
<span class="lineNum">    1362 </span>                :            :         }
<span class="lineNum">    1363 </span>                :            : 
<span class="lineNum">    1364 </span>                :<span class="lineCov">         10 :         ovsdb_datum_init_empty(&amp;datum);</span>
<span class="lineNum">    1365 </span>                :<span class="lineCov">         10 :         ovsdb_idl_txn_write(row, column, &amp;datum);</span>
<span class="lineNum">    1366 </span>                :            :     }
<span class="lineNum">    1367 </span>                :            : 
<span class="lineNum">    1368 </span>                :<span class="lineCov">         10 :     invalidate_cache(ctx);</span>
<span class="lineNum">    1369 </span>                :            : }
<a name="1370"><span class="lineNum">    1370 </span>                :            : </a>
<span class="lineNum">    1371 </span>                :            : static void
<span class="lineNum">    1372 </span>                :<span class="lineCov">        138 : pre_create(struct ctl_context *ctx)</span>
<span class="lineNum">    1373 </span>                :            : {
<span class="lineNum">    1374 </span>                :<span class="lineCov">        138 :     const char *id = shash_find_data(&amp;ctx-&gt;options, &quot;--id&quot;);</span>
<span class="lineNum">    1375 </span>                :<span class="lineCov">        138 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1376 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1377 </span>                :            : 
<span class="lineNum">    1378 </span>                :<span class="lineCov">        138 :     table = get_table(table_name);</span>
<span class="lineNum">    1379 </span>[<span class="branchCov" title="Branch 0 was taken 29 times"> + </span><span class="branchCov" title="Branch 1 was taken 109 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 28 times"> + </span>]:<span class="lineCov">        138 :     if (!id &amp;&amp; !table-&gt;class-&gt;is_root) {</span>
<span class="lineNum">    1380 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         VLOG_WARN(&quot;applying \&quot;create\&quot; command to table %s without --id &quot;</span>
<span class="lineNum">    1381 </span>                :            :                   &quot;option will have no effect&quot;, table-&gt;class-&gt;name);
<span class="lineNum">    1382 </span>                :            :     }
<span class="lineNum">    1383 </span>                :<span class="lineCov">        138 : }</span>
<a name="1384"><span class="lineNum">    1384 </span>                :            : </a>
<span class="lineNum">    1385 </span>                :            : static void
<span class="lineNum">    1386 </span>                :<span class="lineCov">        137 : cmd_create(struct ctl_context *ctx)</span>
<span class="lineNum">    1387 </span>                :            : {
<span class="lineNum">    1388 </span>                :<span class="lineCov">        137 :     const char *id = shash_find_data(&amp;ctx-&gt;options, &quot;--id&quot;);</span>
<span class="lineNum">    1389 </span>                :<span class="lineCov">        137 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1390 </span>                :<span class="lineCov">        137 :     const struct ctl_table_class *table = get_table(table_name);</span>
<span class="lineNum">    1391 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1392 </span>                :            :     const struct uuid *uuid;
<span class="lineNum">    1393 </span>                :            :     int i;
<span class="lineNum">    1394 </span>                :            : 
<span class="lineNum">    1395 </span>        [<span class="branchCov" title="Branch 0 was taken 108 times"> + </span><span class="branchCov" title="Branch 1 was taken 29 times"> + </span>]:<span class="lineCov">        137 :     if (id) {</span>
<span class="lineNum">    1396 </span>                :<span class="lineCov">        108 :         struct ovsdb_symbol *symbol = create_symbol(ctx-&gt;symtab, id, NULL);</span>
<span class="lineNum">    1397 </span>        [<span class="branchCov" title="Branch 0 was taken 16 times"> + </span><span class="branchCov" title="Branch 1 was taken 92 times"> + </span>]:<span class="lineCov">        108 :         if (table-&gt;class-&gt;is_root) {</span>
<span class="lineNum">    1398 </span>                :            :             /* This table is in the root set, meaning that rows created in it
<span class="lineNum">    1399 </span>                :            :              * won't disappear even if they are unreferenced, so disable
<span class="lineNum">    1400 </span>                :            :              * warnings about that by pretending that there is a reference. */
<span class="lineNum">    1401 </span>                :<span class="lineCov">         16 :             symbol-&gt;strong_ref = true;</span>
<span class="lineNum">    1402 </span>                :            :         }
<span class="lineNum">    1403 </span>                :<span class="lineCov">        108 :         uuid = &amp;symbol-&gt;uuid;</span>
<span class="lineNum">    1404 </span>                :            :     } else {
<span class="lineNum">    1405 </span>                :<span class="lineCov">         29 :         uuid = NULL;</span>
<span class="lineNum">    1406 </span>                :            :     }
<span class="lineNum">    1407 </span>                :            : 
<span class="lineNum">    1408 </span>                :<span class="lineCov">        137 :     row = ovsdb_idl_txn_insert(ctx-&gt;txn, table-&gt;class, uuid);</span>
<span class="lineNum">    1409 </span>        [<span class="branchCov" title="Branch 0 was taken 324 times"> + </span><span class="branchCov" title="Branch 1 was taken 137 times"> + </span>]:<span class="lineCov">        461 :     for (i = 2; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1410 </span>                :<span class="lineCov">        324 :         set_column(table, row, ctx-&gt;argv[i], ctx-&gt;symtab);</span>
<span class="lineNum">    1411 </span>                :            :     }
<span class="lineNum">    1412 </span>                :<span class="lineCov">        137 :     ds_put_format(&amp;ctx-&gt;output, UUID_FMT, UUID_ARGS(&amp;row-&gt;uuid));</span>
<span class="lineNum">    1413 </span>                :<span class="lineCov">        137 : }</span>
<span class="lineNum">    1414 </span>                :            : 
<span class="lineNum">    1415 </span>                :            : /* This function may be used as the 'postprocess' function for commands that
<span class="lineNum">    1416 </span>                :            :  * insert new rows into the database.  It expects that the command's 'run'
<span class="lineNum">    1417 </span>                :            :  * function prints the UUID reported by ovsdb_idl_txn_insert() as the command's
<span class="lineNum">    1418 </span>                :            :  * sole output.  It replaces that output by the row's permanent UUID assigned
<span class="lineNum">    1419 </span>                :            :  * by the database server and appends a new-line.
<span class="lineNum">    1420 </span>                :            :  *
<span class="lineNum">    1421 </span>                :            :  * Currently we use this only for &quot;create&quot;, because the higher-level commands
<span class="lineNum">    1422 </span>                :            :  * are supposed to be independent of the actual structure of the vswitch
<a name="1423"><span class="lineNum">    1423 </span>                :            :  * configuration. */</a>
<span class="lineNum">    1424 </span>                :            : static void
<span class="lineNum">    1425 </span>                :<span class="lineCov">        137 : post_create(struct ctl_context *ctx)</span>
<span class="lineNum">    1426 </span>                :            : {
<span class="lineNum">    1427 </span>                :            :     const struct uuid *real;
<span class="lineNum">    1428 </span>                :            :     struct uuid dummy;
<span class="lineNum">    1429 </span>                :            : 
<span class="lineNum">    1430 </span>        [<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 137 times"> + </span>]:<span class="lineCov">        137 :     if (!uuid_from_string(&amp;dummy, ds_cstr(&amp;ctx-&gt;output))) {</span>
<span class="lineNum">    1431 </span>                :<span class="lineNoCov">          0 :         OVS_NOT_REACHED();</span>
<span class="lineNum">    1432 </span>                :            :     }
<span class="lineNum">    1433 </span>                :<span class="lineCov">        137 :     real = ovsdb_idl_txn_get_insert_uuid(ctx-&gt;txn, &amp;dummy);</span>
<span class="lineNum">    1434 </span>        [<span class="branchCov" title="Branch 0 was taken 137 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        137 :     if (real) {</span>
<span class="lineNum">    1435 </span>                :<span class="lineCov">        137 :         ds_clear(&amp;ctx-&gt;output);</span>
<span class="lineNum">    1436 </span>                :<span class="lineCov">        137 :         ds_put_format(&amp;ctx-&gt;output, UUID_FMT, UUID_ARGS(real));</span>
<span class="lineNum">    1437 </span>                :            :     }
<span class="lineNum">    1438 </span>                :<span class="lineCov">        137 :     ds_put_char(&amp;ctx-&gt;output, '\n');</span>
<span class="lineNum">    1439 </span>                :<span class="lineCov">        137 : }</span>
<a name="1440"><span class="lineNum">    1440 </span>                :            : </a>
<span class="lineNum">    1441 </span>                :            : static void
<span class="lineNum">    1442 </span>                :<span class="lineCov">          9 : pre_cmd_destroy(struct ctl_context *ctx)</span>
<span class="lineNum">    1443 </span>                :            : {
<span class="lineNum">    1444 </span>                :<span class="lineCov">          9 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1445 </span>                :            : 
<span class="lineNum">    1446 </span>                :<span class="lineCov">          9 :     pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1447 </span>                :<span class="lineCov">          9 : }</span>
<a name="1448"><span class="lineNum">    1448 </span>                :            : </a>
<span class="lineNum">    1449 </span>                :            : static void
<span class="lineNum">    1450 </span>                :<span class="lineCov">          9 : cmd_destroy(struct ctl_context *ctx)</span>
<span class="lineNum">    1451 </span>                :            : {
<span class="lineNum">    1452 </span>                :<span class="lineCov">          9 :     bool must_exist = !shash_find(&amp;ctx-&gt;options, &quot;--if-exists&quot;);</span>
<span class="lineNum">    1453 </span>                :<span class="lineCov">          9 :     bool delete_all = shash_find(&amp;ctx-&gt;options, &quot;--all&quot;);</span>
<span class="lineNum">    1454 </span>                :<span class="lineCov">          9 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1455 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1456 </span>                :            :     int i;
<span class="lineNum">    1457 </span>                :            : 
<span class="lineNum">    1458 </span>                :<span class="lineCov">          9 :     table = get_table(table_name);</span>
<span class="lineNum">    1459 </span>                :            : 
<span class="lineNum">    1460 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">          9 :     if (delete_all &amp;&amp; ctx-&gt;argc &gt; 2) {</span>
<span class="lineNum">    1461 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;--all and records argument should not be specified together&quot;);</span>
<span class="lineNum">    1462 </span>                :            :     }
<span class="lineNum">    1463 </span>                :            : 
<span class="lineNum">    1464 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">          9 :     if (delete_all &amp;&amp; !must_exist) {</span>
<span class="lineNum">    1465 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;--all and --if-exists should not be specified together&quot;);</span>
<span class="lineNum">    1466 </span>                :            :     }
<span class="lineNum">    1467 </span>                :            : 
<span class="lineNum">    1468 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>]:<span class="lineCov">          9 :     if (delete_all) {</span>
<span class="lineNum">    1469 </span>                :            :         const struct ovsdb_idl_row *row;
<span class="lineNum">    1470 </span>                :            :         const struct ovsdb_idl_row *next_row;
<span class="lineNum">    1471 </span>                :            : 
<span class="lineNum">    1472 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span>]:<span class="lineCov">          5 :         for (row = ovsdb_idl_first_row(ctx-&gt;idl, table-&gt;class);</span>
<span class="lineNum">    1473 </span>                :            :              row;) {
<span class="lineNum">    1474 </span>                :<span class="lineCov">          3 :             next_row = ovsdb_idl_next_row(row);</span>
<span class="lineNum">    1475 </span>                :<span class="lineCov">          3 :             ovsdb_idl_txn_delete(row);</span>
<span class="lineNum">    1476 </span>                :<span class="lineCov">          3 :             row = next_row;</span>
<span class="lineNum">    1477 </span>                :            :         }
<span class="lineNum">    1478 </span>                :            :     } else {
<span class="lineNum">    1479 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">         13 :         for (i = 2; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1480 </span>                :            :             const struct ovsdb_idl_row *row;
<span class="lineNum">    1481 </span>                :            : 
<span class="lineNum">    1482 </span>                :<span class="lineCov">          7 :             row = get_row(ctx, table, ctx-&gt;argv[i], must_exist);</span>
<span class="lineNum">    1483 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :             if (row) {</span>
<span class="lineNum">    1484 </span>                :<span class="lineCov">          6 :                 ovsdb_idl_txn_delete(row);</span>
<span class="lineNum">    1485 </span>                :            :             }
<span class="lineNum">    1486 </span>                :            :         }
<span class="lineNum">    1487 </span>                :            :     }
<span class="lineNum">    1488 </span>                :<span class="lineCov">          8 :     invalidate_cache(ctx);</span>
<span class="lineNum">    1489 </span>                :<span class="lineCov">          8 : }</span>
<a name="1490"><span class="lineNum">    1490 </span>                :            : </a>
<span class="lineNum">    1491 </span>                :            : static void
<span class="lineNum">    1492 </span>                :<span class="lineCov">         18 : pre_cmd_wait_until(struct ctl_context *ctx)</span>
<span class="lineNum">    1493 </span>                :            : {
<span class="lineNum">    1494 </span>                :<span class="lineCov">         18 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1495 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1496 </span>                :            :     int i;
<span class="lineNum">    1497 </span>                :            : 
<span class="lineNum">    1498 </span>                :<span class="lineCov">         18 :     table = pre_get_table(ctx, table_name);</span>
<span class="lineNum">    1499 </span>                :            : 
<span class="lineNum">    1500 </span>        [<span class="branchCov" title="Branch 0 was taken 19 times"> + </span><span class="branchCov" title="Branch 1 was taken 18 times"> + </span>]:<span class="lineCov">         37 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1501 </span>                :<span class="lineCov">         19 :         pre_parse_column_key_value(ctx, ctx-&gt;argv[i], table);</span>
<span class="lineNum">    1502 </span>                :            :     }
<span class="lineNum">    1503 </span>                :<span class="lineCov">         18 : }</span>
<a name="1504"><span class="lineNum">    1504 </span>                :            : </a>
<span class="lineNum">    1505 </span>                :            : static void
<span class="lineNum">    1506 </span>                :<span class="lineCov">         25 : cmd_wait_until(struct ctl_context *ctx)</span>
<span class="lineNum">    1507 </span>                :            : {
<span class="lineNum">    1508 </span>                :<span class="lineCov">         25 :     const char *table_name = ctx-&gt;argv[1];</span>
<span class="lineNum">    1509 </span>                :<span class="lineCov">         25 :     const char *record_id = ctx-&gt;argv[2];</span>
<span class="lineNum">    1510 </span>                :            :     const struct ctl_table_class *table;
<span class="lineNum">    1511 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1512 </span>                :            :     int i;
<span class="lineNum">    1513 </span>                :            : 
<span class="lineNum">    1514 </span>                :<span class="lineCov">         25 :     table = get_table(table_name);</span>
<span class="lineNum">    1515 </span>                :            : 
<span class="lineNum">    1516 </span>                :<span class="lineCov">         25 :     row = get_row(ctx, table, record_id, false);</span>
<span class="lineNum">    1517 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 19 times"> + </span>]:<span class="lineCov">         25 :     if (!row) {</span>
<span class="lineNum">    1518 </span>                :<span class="lineCov">          6 :         ctx-&gt;try_again = true;</span>
<span class="lineNum">    1519 </span>                :<span class="lineCov">          6 :         return;</span>
<span class="lineNum">    1520 </span>                :            :     }
<span class="lineNum">    1521 </span>                :            : 
<span class="lineNum">    1522 </span>        [<span class="branchCov" title="Branch 0 was taken 20 times"> + </span><span class="branchCov" title="Branch 1 was taken 17 times"> + </span>]:<span class="lineCov">         37 :     for (i = 3; i &lt; ctx-&gt;argc; i++) {</span>
<span class="lineNum">    1523 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 18 times"> + </span>]:<span class="lineCov">         20 :         if (!is_condition_satisfied(table, row, ctx-&gt;argv[i], ctx-&gt;symtab)) {</span>
<span class="lineNum">    1524 </span>                :<span class="lineCov">          1 :             ctx-&gt;try_again = true;</span>
<span class="lineNum">    1525 </span>                :<span class="lineCov">          1 :             return;</span>
<span class="lineNum">    1526 </span>                :            :         }
<span class="lineNum">    1527 </span>                :            :     }
<span class="lineNum">    1528 </span>                :            : }
<span class="lineNum">    1529 </span>                :            : 
<a name="1530"><span class="lineNum">    1530 </span>                :            : /* Parses one command. */</a>
<span class="lineNum">    1531 </span>                :            : static void
<span class="lineNum">    1532 </span>                :<span class="lineCov">      11708 : parse_command(int argc, char *argv[], struct shash *local_options,</span>
<span class="lineNum">    1533 </span>                :            :               struct ctl_command *command)
<span class="lineNum">    1534 </span>                :            : {
<span class="lineNum">    1535 </span>                :            :     const struct ctl_command_syntax *p;
<span class="lineNum">    1536 </span>                :            :     struct shash_node *node;
<span class="lineNum">    1537 </span>                :            :     int n_arg;
<span class="lineNum">    1538 </span>                :            :     int i;
<span class="lineNum">    1539 </span>                :            : 
<span class="lineNum">    1540 </span>                :<span class="lineCov">      11708 :     shash_init(&amp;command-&gt;options);</span>
<span class="lineNum">    1541 </span>                :<span class="lineCov">      11708 :     shash_swap(local_options, &amp;command-&gt;options);</span>
<span class="lineNum">    1542 </span>        [<span class="branchCov" title="Branch 0 was taken 11935 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">      11936 :     for (i = 0; i &lt; argc; i++) {</span>
<span class="lineNum">    1543 </span>                :<span class="lineCov">      11935 :         const char *option = argv[i];</span>
<span class="lineNum">    1544 </span>                :            :         const char *equals;
<span class="lineNum">    1545 </span>                :            :         char *key, *value;
<span class="lineNum">    1546 </span>                :            : 
<span class="lineNum">    1547 </span>        [<span class="branchCov" title="Branch 0 was taken 11707 times"> + </span><span class="branchCov" title="Branch 1 was taken 228 times"> + </span>]:<span class="lineCov">      11935 :         if (option[0] != '-') {</span>
<span class="lineNum">    1548 </span>                :<span class="lineCov">      11707 :             break;</span>
<span class="lineNum">    1549 </span>                :            :         }
<span class="lineNum">    1550 </span>                :            : 
<span class="lineNum">    1551 </span>                :<span class="lineCov">        228 :         equals = strchr(option, '=');</span>
<span class="lineNum">    1552 </span>        [<span class="branchCov" title="Branch 0 was taken 220 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>]:<span class="lineCov">        228 :         if (equals) {</span>
<span class="lineNum">    1553 </span>                :<span class="lineCov">        220 :             key = xmemdup0(option, equals - option);</span>
<span class="lineNum">    1554 </span>                :<span class="lineCov">        220 :             value = xstrdup(equals + 1);</span>
<span class="lineNum">    1555 </span>                :            :         } else {
<span class="lineNum">    1556 </span>                :<span class="lineCov">          8 :             key = xstrdup(option);</span>
<span class="lineNum">    1557 </span>                :<span class="lineCov">          8 :             value = NULL;</span>
<span class="lineNum">    1558 </span>                :            :         }
<span class="lineNum">    1559 </span>                :            : 
<span class="lineNum">    1560 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 228 times"> + </span>]:<span class="lineCov">        228 :         if (shash_find(&amp;command-&gt;options, key)) {</span>
<span class="lineNum">    1561 </span>                :<span class="lineNoCov">          0 :             ctl_fatal(&quot;'%s' option specified multiple times&quot;, argv[i]);</span>
<span class="lineNum">    1562 </span>                :            :         }
<span class="lineNum">    1563 </span>                :<span class="lineCov">        228 :         shash_add_nocopy(&amp;command-&gt;options, key, value);</span>
<span class="lineNum">    1564 </span>                :            :     }
<span class="lineNum">    1565 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 11707 times"> + </span>]:<span class="lineCov">      11708 :     if (i == argc) {</span>
<span class="lineNum">    1566 </span>                :<span class="lineCov">          1 :         ctl_fatal(&quot;missing command name (use --help for help)&quot;);</span>
<span class="lineNum">    1567 </span>                :            :     }
<span class="lineNum">    1568 </span>                :            : 
<span class="lineNum">    1569 </span>                :<span class="lineCov">      11707 :     p = shash_find_data(&amp;all_commands, argv[i]);</span>
<span class="lineNum">    1570 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 11707 times"> + </span>]:<span class="lineCov">      11707 :     if (!p) {</span>
<span class="lineNum">    1571 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;unknown command '%s'; use --help for help&quot;, argv[i]);</span>
<span class="lineNum">    1572 </span>                :            :     }
<span class="lineNum">    1573 </span>                :            : 
<span class="lineNum">    1574 </span>[<span class="branchCov" title="Branch 2 was taken 560 times"> + </span><span class="branchCov" title="Branch 3 was taken 11707 times"> + </span>][<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 11707 times"> + </span>]:<span class="lineCov">      12267 :     SHASH_FOR_EACH (node, &amp;command-&gt;options) {</span>
<span class="lineNum">    1575 </span>                :<span class="lineCov">        560 :         const char *s = strstr(p-&gt;options, node-&gt;name);</span>
<span class="lineNum">    1576 </span>        [<span class="branchCov" title="Branch 0 was taken 560 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        560 :         int end = s ? s[strlen(node-&gt;name)] : EOF;</span>
<span class="lineNum">    1577 </span>                :            : 
<span class="lineNum">    1578 </span>[<span class="branchCov" title="Branch 0 was taken 189 times"> + </span><span class="branchCov" title="Branch 1 was taken 371 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 96 times"> + </span><span class="branchCov" title="Branch 3 was taken 93 times"> + </span>]:<span class="lineCov">        560 :         if (end != '=' &amp;&amp; end != ',' &amp;&amp; end != ' ' &amp;&amp; end != '\0') {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 96 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>][<span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 96 times"> + </span>]
<span class="lineNum">    1579 </span>                :<span class="lineNoCov">          0 :             ctl_fatal(&quot;'%s' command has no '%s' option&quot;,</span>
<span class="lineNum">    1580 </span>                :<span class="lineNoCov">          0 :                       argv[i], node-&gt;name);</span>
<span class="lineNum">    1581 </span>                :            :         }
<span class="lineNum">    1582 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 560 times"> + </span>]:<span class="lineCov">        560 :         if ((end == '=') != (node-&gt;data != NULL)) {</span>
<span class="lineNum">    1583 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (end == '=') {</span>
<span class="lineNum">    1584 </span>                :<span class="lineNoCov">          0 :                 ctl_fatal(&quot;missing argument to '%s' option on '%s' &quot;</span>
<span class="lineNum">    1585 </span>                :<span class="lineNoCov">          0 :                           &quot;command&quot;, node-&gt;name, argv[i]);</span>
<span class="lineNum">    1586 </span>                :            :             } else {
<span class="lineNum">    1587 </span>                :<span class="lineNoCov">          0 :                 ctl_fatal(&quot;'%s' option on '%s' does not accept an &quot;</span>
<span class="lineNum">    1588 </span>                :<span class="lineNoCov">          0 :                           &quot;argument&quot;, node-&gt;name, argv[i]);</span>
<span class="lineNum">    1589 </span>                :            :             }
<span class="lineNum">    1590 </span>                :            :         }
<span class="lineNum">    1591 </span>                :            :     }
<span class="lineNum">    1592 </span>                :            : 
<span class="lineNum">    1593 </span>                :<span class="lineCov">      11707 :     n_arg = argc - i - 1;</span>
<span class="lineNum">    1594 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 11707 times"> + </span>]:<span class="lineCov">      11707 :     if (n_arg &lt; p-&gt;min_args) {</span>
<span class="lineNum">    1595 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;'%s' command requires at least %d arguments&quot;,</span>
<span class="lineNum">    1596 </span>                :            :                   p-&gt;name, p-&gt;min_args);
<span class="lineNum">    1597 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 11707 times"> + </span>]:<span class="lineCov">      11707 :     } else if (n_arg &gt; p-&gt;max_args) {</span>
<span class="lineNum">    1598 </span>                :            :         int j;
<span class="lineNum">    1599 </span>                :            : 
<span class="lineNum">    1600 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         for (j = i + 1; j &lt; argc; j++) {</span>
<span class="lineNum">    1601 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (argv[j][0] == '-') {</span>
<span class="lineNum">    1602 </span>                :<span class="lineNoCov">          0 :                 ctl_fatal(&quot;'%s' command takes at most %d arguments &quot;</span>
<span class="lineNum">    1603 </span>                :            :                           &quot;(note that options must precede command &quot;
<span class="lineNum">    1604 </span>                :            :                           &quot;names and follow a \&quot;--\&quot; argument)&quot;,
<span class="lineNum">    1605 </span>                :            :                           p-&gt;name, p-&gt;max_args);
<span class="lineNum">    1606 </span>                :            :             }
<span class="lineNum">    1607 </span>                :            :         }
<span class="lineNum">    1608 </span>                :            : 
<span class="lineNum">    1609 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;'%s' command takes at most %d arguments&quot;,</span>
<span class="lineNum">    1610 </span>                :            :                   p-&gt;name, p-&gt;max_args);
<span class="lineNum">    1611 </span>                :            :     }
<span class="lineNum">    1612 </span>                :            : 
<span class="lineNum">    1613 </span>                :<span class="lineCov">      11707 :     command-&gt;syntax = p;</span>
<span class="lineNum">    1614 </span>                :<span class="lineCov">      11707 :     command-&gt;argc = n_arg + 1;</span>
<span class="lineNum">    1615 </span>                :<span class="lineCov">      11707 :     command-&gt;argv = &amp;argv[i];</span>
<span class="lineNum">    1616 </span>                :<span class="lineCov">      11707 : }</span>
<a name="1617"><span class="lineNum">    1617 </span>                :            : </a>
<span class="lineNum">    1618 </span>                :            : static void
<span class="lineNum">    1619 </span>                :<span class="lineCov">         46 : pre_cmd_show(struct ctl_context *ctx)</span>
<span class="lineNum">    1620 </span>                :            : {
<span class="lineNum">    1621 </span>                :            :     const struct cmd_show_table *show;
<span class="lineNum">    1622 </span>                :            : 
<span class="lineNum">    1623 </span>        [<span class="branchCov" title="Branch 0 was taken 223 times"> + </span><span class="branchCov" title="Branch 1 was taken 46 times"> + </span>]:<span class="lineCov">        269 :     for (show = cmd_show_tables; show-&gt;table; show++) {</span>
<span class="lineNum">    1624 </span>                :            :         size_t i;
<span class="lineNum">    1625 </span>                :            : 
<span class="lineNum">    1626 </span>                :<span class="lineCov">        223 :         ovsdb_idl_add_table(ctx-&gt;idl, show-&gt;table);</span>
<span class="lineNum">    1627 </span>        [<span class="branchCov" title="Branch 0 was taken 186 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        223 :         if (show-&gt;name_column) {</span>
<span class="lineNum">    1628 </span>                :<span class="lineCov">        186 :             ovsdb_idl_add_column(ctx-&gt;idl, show-&gt;name_column);</span>
<span class="lineNum">    1629 </span>                :            :         }
<span class="lineNum">    1630 </span>        [<span class="branchCov" title="Branch 0 was taken 669 times"> + </span><span class="branchCov" title="Branch 1 was taken 223 times"> + </span>]:<span class="lineCov">        892 :         for (i = 0; i &lt; ARRAY_SIZE(show-&gt;columns); i++) {</span>
<span class="lineNum">    1631 </span>                :<span class="lineCov">        669 :             const struct ovsdb_idl_column *column = show-&gt;columns[i];</span>
<span class="lineNum">    1632 </span>        [<span class="branchCov" title="Branch 0 was taken 435 times"> + </span><span class="branchCov" title="Branch 1 was taken 234 times"> + </span>]:<span class="lineCov">        669 :             if (column) {</span>
<span class="lineNum">    1633 </span>                :<span class="lineCov">        435 :                 ovsdb_idl_add_column(ctx-&gt;idl, column);</span>
<span class="lineNum">    1634 </span>                :            :             }
<span class="lineNum">    1635 </span>                :            :         }
<span class="lineNum">    1636 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 214 times"> + </span>]:<span class="lineCov">        223 :         if (show-&gt;wref_table.table) {</span>
<span class="lineNum">    1637 </span>                :<span class="lineCov">          9 :             ovsdb_idl_add_table(ctx-&gt;idl, show-&gt;wref_table.table);</span>
<span class="lineNum">    1638 </span>                :            :         }
<span class="lineNum">    1639 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 214 times"> + </span>]:<span class="lineCov">        223 :         if (show-&gt;wref_table.name_column) {</span>
<span class="lineNum">    1640 </span>                :<span class="lineCov">          9 :             ovsdb_idl_add_column(ctx-&gt;idl, show-&gt;wref_table.name_column);</span>
<span class="lineNum">    1641 </span>                :            :         }
<span class="lineNum">    1642 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 214 times"> + </span>]:<span class="lineCov">        223 :         if (show-&gt;wref_table.wref_column) {</span>
<span class="lineNum">    1643 </span>                :<span class="lineCov">          9 :             ovsdb_idl_add_column(ctx-&gt;idl, show-&gt;wref_table.wref_column);</span>
<span class="lineNum">    1644 </span>                :            :         }
<span class="lineNum">    1645 </span>                :            :     }
<span class="lineNum">    1646 </span>                :<span class="lineCov">         46 : }</span>
<a name="1647"><span class="lineNum">    1647 </span>                :            : </a>
<span class="lineNum">    1648 </span>                :            : static const struct cmd_show_table *
<span class="lineNum">    1649 </span>                :<span class="lineCov">        400 : cmd_show_find_table_by_row(const struct ovsdb_idl_row *row)</span>
<span class="lineNum">    1650 </span>                :            : {
<span class="lineNum">    1651 </span>                :            :     const struct cmd_show_table *show;
<span class="lineNum">    1652 </span>                :            : 
<span class="lineNum">    1653 </span>        [<span class="branchCov" title="Branch 0 was taken 1189 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1189 :     for (show = cmd_show_tables; show-&gt;table; show++) {</span>
<span class="lineNum">    1654 </span>        [<span class="branchCov" title="Branch 0 was taken 400 times"> + </span><span class="branchCov" title="Branch 1 was taken 789 times"> + </span>]:<span class="lineCov">       1189 :         if (show-&gt;table == row-&gt;table-&gt;class) {</span>
<span class="lineNum">    1655 </span>                :<span class="lineCov">        400 :             return show;</span>
<span class="lineNum">    1656 </span>                :            :         }
<span class="lineNum">    1657 </span>                :            :     }
<span class="lineNum">    1658 </span>                :<span class="lineNoCov">          0 :     return NULL;</span>
<span class="lineNum">    1659 </span>                :            : }
<a name="1660"><span class="lineNum">    1660 </span>                :            : </a>
<span class="lineNum">    1661 </span>                :            : static const struct cmd_show_table *
<span class="lineNum">    1662 </span>                :<span class="lineCov">        315 : cmd_show_find_table_by_name(const char *name)</span>
<span class="lineNum">    1663 </span>                :            : {
<span class="lineNum">    1664 </span>                :            :     const struct cmd_show_table *show;
<span class="lineNum">    1665 </span>                :            : 
<span class="lineNum">    1666 </span>        [<span class="branchCov" title="Branch 0 was taken 1192 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1192 :     for (show = cmd_show_tables; show-&gt;table; show++) {</span>
<span class="lineNum">    1667 </span>        [<span class="branchCov" title="Branch 0 was taken 315 times"> + </span><span class="branchCov" title="Branch 1 was taken 877 times"> + </span>]:<span class="lineCov">       1192 :         if (!strcmp(show-&gt;table-&gt;name, name)) {</span>
<span class="lineNum">    1668 </span>                :<span class="lineCov">        315 :             return show;</span>
<span class="lineNum">    1669 </span>                :            :         }
<span class="lineNum">    1670 </span>                :            :     }
<span class="lineNum">    1671 </span>                :<span class="lineNoCov">          0 :     return NULL;</span>
<span class="lineNum">    1672 </span>                :            : }
<span class="lineNum">    1673 </span>                :            : 
<a name="1674"><span class="lineNum">    1674 </span>                :            : /*  Prints table entries that weak reference the 'cur_row'. */</a>
<span class="lineNum">    1675 </span>                :            : static void
<span class="lineNum">    1676 </span>                :<span class="lineCov">        400 : cmd_show_weak_ref(struct ctl_context *ctx, const struct cmd_show_table *show,</span>
<span class="lineNum">    1677 </span>                :            :                   const struct ovsdb_idl_row *cur_row, int level)
<span class="lineNum">    1678 </span>                :            : {
<span class="lineNum">    1679 </span>                :            :     const struct ovsdb_idl_row *row_wref;
<span class="lineNum">    1680 </span>                :<span class="lineCov">        400 :     const struct ovsdb_idl_table_class *table = show-&gt;wref_table.table;</span>
<span class="lineNum">    1681 </span>                :<span class="lineCov">        400 :     const struct ovsdb_idl_column *name_column</span>
<span class="lineNum">    1682 </span>                :            :         = show-&gt;wref_table.name_column;
<span class="lineNum">    1683 </span>                :<span class="lineCov">        400 :     const struct ovsdb_idl_column *wref_column</span>
<span class="lineNum">    1684 </span>                :            :         = show-&gt;wref_table.wref_column;
<span class="lineNum">    1685 </span>                :            : 
<span class="lineNum">    1686 </span>[<span class="branchCov" title="Branch 0 was taken 14 times"> + </span><span class="branchCov" title="Branch 1 was taken 386 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        400 :     if (!table || !name_column || !wref_column) {</span>
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 14 times"> + </span>]
<span class="lineNum">    1687 </span>                :<span class="lineCov">        386 :         return;</span>
<span class="lineNum">    1688 </span>                :            :     }
<span class="lineNum">    1689 </span>                :            : 
<span class="lineNum">    1690 </span>        [<span class="branchCov" title="Branch 1 was taken 48 times"> + </span><span class="branchCov" title="Branch 2 was taken 14 times"> + </span>]:<span class="lineCov">         62 :     for (row_wref = ovsdb_idl_first_row(ctx-&gt;idl, table); row_wref;</span>
<span class="lineNum">    1691 </span>                :<span class="lineCov">         48 :          row_wref = ovsdb_idl_next_row(row_wref)) {</span>
<span class="lineNum">    1692 </span>                :<span class="lineCov">         48 :         const struct ovsdb_datum *wref_datum</span>
<span class="lineNum">    1693 </span>                :            :             = ovsdb_idl_read(row_wref, wref_column);
<span class="lineNum">    1694 </span>                :            :         /* If weak reference refers to the 'cur_row', prints it. */
<span class="lineNum">    1695 </span>        [<span class="branchCov" title="Branch 0 was taken 42 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">         48 :         if (wref_datum-&gt;n</span>
<span class="lineNum">    1696 </span>        [<span class="branchCov" title="Branch 1 was taken 20 times"> + </span><span class="branchCov" title="Branch 2 was taken 22 times"> + </span>]:<span class="lineCov">         42 :             &amp;&amp; uuid_equals(&amp;cur_row-&gt;uuid, &amp;wref_datum-&gt;keys[0].uuid)) {</span>
<span class="lineNum">    1697 </span>                :<span class="lineCov">         20 :             const struct ovsdb_datum *name_datum</span>
<span class="lineNum">    1698 </span>                :            :                 = ovsdb_idl_read(row_wref, name_column);
<span class="lineNum">    1699 </span>                :<span class="lineCov">         20 :             ds_put_char_multiple(&amp;ctx-&gt;output, ' ', (level + 1) * 4);</span>
<span class="lineNum">    1700 </span>                :<span class="lineCov">         20 :             ds_put_format(&amp;ctx-&gt;output, &quot;%s &quot;, table-&gt;name);</span>
<span class="lineNum">    1701 </span>                :<span class="lineCov">         20 :             ovsdb_datum_to_string(name_datum, &amp;name_column-&gt;type, &amp;ctx-&gt;output);</span>
<span class="lineNum">    1702 </span>                :<span class="lineCov">         20 :             ds_put_char(&amp;ctx-&gt;output, '\n');</span>
<span class="lineNum">    1703 </span>                :            :         }
<span class="lineNum">    1704 </span>                :            :     }
<span class="lineNum">    1705 </span>                :            : }
<span class="lineNum">    1706 </span>                :            : 
<span class="lineNum">    1707 </span>                :            : /* 'shown' records the tables that has been displayed by the current
<span class="lineNum">    1708 </span>                :            :  * command to avoid duplicated prints.
<a name="1709"><span class="lineNum">    1709 </span>                :            :  */</a>
<span class="lineNum">    1710 </span>                :            : static void
<span class="lineNum">    1711 </span>                :<span class="lineCov">        400 : cmd_show_row(struct ctl_context *ctx, const struct ovsdb_idl_row *row,</span>
<span class="lineNum">    1712 </span>                :            :              int level, struct sset *shown)
<span class="lineNum">    1713 </span>                :            : {
<span class="lineNum">    1714 </span>                :<span class="lineCov">        400 :     const struct cmd_show_table *show = cmd_show_find_table_by_row(row);</span>
<span class="lineNum">    1715 </span>                :            :     size_t i;
<span class="lineNum">    1716 </span>                :            : 
<span class="lineNum">    1717 </span>                :<span class="lineCov">        400 :     ds_put_char_multiple(&amp;ctx-&gt;output, ' ', level * 4);</span>
<span class="lineNum">    1718 </span>[<span class="branchCov" title="Branch 0 was taken 400 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 365 times"> + </span><span class="branchCov" title="Branch 3 was taken 35 times"> + </span>]:<span class="lineCov">        765 :     if (show &amp;&amp; show-&gt;name_column) {</span>
<span class="lineNum">    1719 </span>                :            :         const struct ovsdb_datum *datum;
<span class="lineNum">    1720 </span>                :            : 
<span class="lineNum">    1721 </span>                :<span class="lineCov">        365 :         ds_put_format(&amp;ctx-&gt;output, &quot;%s &quot;, show-&gt;table-&gt;name);</span>
<span class="lineNum">    1722 </span>                :<span class="lineCov">        365 :         datum = ovsdb_idl_read(row, show-&gt;name_column);</span>
<span class="lineNum">    1723 </span>                :<span class="lineCov">        365 :         ovsdb_datum_to_string(datum, &amp;show-&gt;name_column-&gt;type, &amp;ctx-&gt;output);</span>
<span class="lineNum">    1724 </span>                :            :     } else {
<span class="lineNum">    1725 </span>                :<span class="lineCov">         35 :         ds_put_format(&amp;ctx-&gt;output, UUID_FMT, UUID_ARGS(&amp;row-&gt;uuid));</span>
<span class="lineNum">    1726 </span>                :            :     }
<span class="lineNum">    1727 </span>                :<span class="lineCov">        400 :     ds_put_char(&amp;ctx-&gt;output, '\n');</span>
<span class="lineNum">    1728 </span>                :            : 
<span class="lineNum">    1729 </span>[<span class="branchCov" title="Branch 0 was taken 400 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 400 times"> + </span>]:<span class="lineCov">        400 :     if (!show || sset_find(shown, show-&gt;table-&gt;name)) {</span>
<span class="lineNum">    1730 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1731 </span>                :            :     }
<span class="lineNum">    1732 </span>                :            : 
<span class="lineNum">    1733 </span>                :<span class="lineCov">        400 :     sset_add(shown, show-&gt;table-&gt;name);</span>
<span class="lineNum">    1734 </span>        [<span class="branchCov" title="Branch 0 was taken 1188 times"> + </span><span class="branchCov" title="Branch 1 was taken 336 times"> + </span>]:<span class="lineCov">       1524 :     for (i = 0; i &lt; ARRAY_SIZE(show-&gt;columns); i++) {</span>
<span class="lineNum">    1735 </span>                :<span class="lineCov">       1188 :         const struct ovsdb_idl_column *column = show-&gt;columns[i];</span>
<span class="lineNum">    1736 </span>                :            :         const struct ovsdb_datum *datum;
<span class="lineNum">    1737 </span>                :            : 
<span class="lineNum">    1738 </span>        [<span class="branchCov" title="Branch 0 was taken 64 times"> + </span><span class="branchCov" title="Branch 1 was taken 1124 times"> + </span>]:<span class="lineCov">       1188 :         if (!column) {</span>
<span class="lineNum">    1739 </span>                :<span class="lineCov">         64 :             break;</span>
<span class="lineNum">    1740 </span>                :            :         }
<span class="lineNum">    1741 </span>                :            : 
<span class="lineNum">    1742 </span>                :<span class="lineCov">       1124 :         datum = ovsdb_idl_read(row, column);</span>
<span class="lineNum">    1743 </span>[<span class="branchCov" title="Branch 0 was taken 304 times"> + </span><span class="branchCov" title="Branch 1 was taken 820 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 304 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1124 :         if (column-&gt;type.key.type == OVSDB_TYPE_UUID &amp;&amp;</span>
<span class="lineNum">    1744 </span>                :<span class="lineNoCov">          0 :             column-&gt;type.key.u.uuid.refTableName) {</span>
<span class="lineNum">    1745 </span>                :            :             const struct cmd_show_table *ref_show;
<span class="lineNum">    1746 </span>                :            :             size_t j;
<span class="lineNum">    1747 </span>                :            : 
<span class="lineNum">    1748 </span>                :<span class="lineCov">        304 :             ref_show = cmd_show_find_table_by_name(</span>
<span class="lineNum">    1749 </span>                :<span class="lineCov">        304 :                 column-&gt;type.key.u.uuid.refTableName);</span>
<span class="lineNum">    1750 </span>        [<span class="branchCov" title="Branch 0 was taken 304 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        304 :             if (ref_show) {</span>
<span class="lineNum">    1751 </span>        [<span class="branchCov" title="Branch 0 was taken 351 times"> + </span><span class="branchCov" title="Branch 1 was taken 304 times"> + </span>]:<span class="lineCov">        655 :                 for (j = 0; j &lt; datum-&gt;n; j++) {</span>
<span class="lineNum">    1752 </span>                :            :                     const struct ovsdb_idl_row *ref_row;
<span class="lineNum">    1753 </span>                :            : 
<span class="lineNum">    1754 </span>                :<span class="lineCov">        351 :                     ref_row = ovsdb_idl_get_row_for_uuid(ctx-&gt;idl,</span>
<span class="lineNum">    1755 </span>                :            :                                                          ref_show-&gt;table,
<span class="lineNum">    1756 </span>                :<span class="lineCov">        351 :                                                          &amp;datum-&gt;keys[j].uuid);</span>
<span class="lineNum">    1757 </span>        [<span class="branchCov" title="Branch 0 was taken 351 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        351 :                     if (ref_row) {</span>
<span class="lineNum">    1758 </span>                :<span class="lineCov">        351 :                         cmd_show_row(ctx, ref_row, level + 1, shown);</span>
<span class="lineNum">    1759 </span>                :            :                     }
<span class="lineNum">    1760 </span>                :            :                 }
<span class="lineNum">    1761 </span>                :<span class="lineCov">        304 :                 continue;</span>
<span class="lineNum">    1762 </span>                :            :             }
<span class="lineNum">    1763 </span>[<span class="branchCov" title="Branch 1 was taken 165 times"> + </span><span class="branchCov" title="Branch 2 was taken 655 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 11 times"> + </span><span class="branchCov" title="Branch 4 was taken 154 times"> + </span>]:<span class="lineCov">        820 :         } else if (ovsdb_type_is_map(&amp;column-&gt;type) &amp;&amp;</span>
<span class="lineNum">    1764 </span>        [<span class="branchCov" title="Branch 0 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">         11 :                    column-&gt;type.value.type == OVSDB_TYPE_UUID &amp;&amp;</span>
<span class="lineNum">    1765 </span>                :<span class="lineCov">         11 :                    column-&gt;type.value.u.uuid.refTableName) {</span>
<span class="lineNum">    1766 </span>                :            :             const struct cmd_show_table *ref_show;
<span class="lineNum">    1767 </span>                :            :             size_t j;
<span class="lineNum">    1768 </span>                :            : 
<span class="lineNum">    1769 </span>                :            :             /* Prints the key to ref'ed table name map if the ref'ed table
<span class="lineNum">    1770 </span>                :            :              * is also defined in 'cmd_show_tables'.  */
<span class="lineNum">    1771 </span>                :<span class="lineCov">         11 :             ref_show = cmd_show_find_table_by_name(</span>
<span class="lineNum">    1772 </span>                :<span class="lineCov">         11 :                 column-&gt;type.value.u.uuid.refTableName);</span>
<span class="lineNum">    1773 </span>[<span class="branchCov" title="Branch 0 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 11 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         11 :             if (ref_show &amp;&amp; ref_show-&gt;name_column) {</span>
<span class="lineNum">    1774 </span>                :<span class="lineCov">         11 :                 ds_put_char_multiple(&amp;ctx-&gt;output, ' ', (level + 1) * 4);</span>
<span class="lineNum">    1775 </span>                :<span class="lineCov">         11 :                 ds_put_format(&amp;ctx-&gt;output, &quot;%s:\n&quot;, column-&gt;name);</span>
<span class="lineNum">    1776 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 11 times"> + </span>]:<span class="lineCov">         12 :                 for (j = 0; j &lt; datum-&gt;n; j++) {</span>
<span class="lineNum">    1777 </span>                :            :                     const struct ovsdb_idl_row *ref_row;
<span class="lineNum">    1778 </span>                :            : 
<span class="lineNum">    1779 </span>                :<span class="lineCov">          1 :                     ref_row = ovsdb_idl_get_row_for_uuid(ctx-&gt;idl,</span>
<span class="lineNum">    1780 </span>                :            :                                                          ref_show-&gt;table,
<span class="lineNum">    1781 </span>                :<span class="lineCov">          1 :                                                          &amp;datum-&gt;values[j].uuid);</span>
<span class="lineNum">    1782 </span>                :            : 
<span class="lineNum">    1783 </span>                :<span class="lineCov">          1 :                     ds_put_char_multiple(&amp;ctx-&gt;output, ' ', (level + 2) * 4);</span>
<span class="lineNum">    1784 </span>                :<span class="lineCov">          1 :                     ovsdb_atom_to_string(&amp;datum-&gt;keys[j], column-&gt;type.key.type,</span>
<span class="lineNum">    1785 </span>                :            :                                          &amp;ctx-&gt;output);
<span class="lineNum">    1786 </span>                :<span class="lineCov">          1 :                     ds_put_char(&amp;ctx-&gt;output, '=');</span>
<span class="lineNum">    1787 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                     if (ref_row) {</span>
<span class="lineNum">    1788 </span>                :            :                         const struct ovsdb_datum *ref_datum;
<span class="lineNum">    1789 </span>                :            : 
<span class="lineNum">    1790 </span>                :<span class="lineCov">          1 :                         ref_datum = ovsdb_idl_read(ref_row,</span>
<span class="lineNum">    1791 </span>                :            :                                                    ref_show-&gt;name_column);
<span class="lineNum">    1792 </span>                :<span class="lineCov">          1 :                         ovsdb_datum_to_string(ref_datum,</span>
<span class="lineNum">    1793 </span>                :<span class="lineCov">          1 :                                               &amp;ref_show-&gt;name_column-&gt;type,</span>
<span class="lineNum">    1794 </span>                :            :                                               &amp;ctx-&gt;output);
<span class="lineNum">    1795 </span>                :            :                     } else {
<span class="lineNum">    1796 </span>                :<span class="lineNoCov">          0 :                         ds_put_cstr(&amp;ctx-&gt;output, &quot;\&quot;&lt;null&gt;\&quot;&quot;);</span>
<span class="lineNum">    1797 </span>                :            :                     }
<span class="lineNum">    1798 </span>                :<span class="lineCov">          1 :                     ds_put_char(&amp;ctx-&gt;output, '\n');</span>
<span class="lineNum">    1799 </span>                :            :                 }
<span class="lineNum">    1800 </span>                :<span class="lineCov">         11 :                 continue;</span>
<span class="lineNum">    1801 </span>                :            :             }
<span class="lineNum">    1802 </span>                :            :         }
<span class="lineNum">    1803 </span>                :            : 
<span class="lineNum">    1804 </span>        [<span class="branchCov" title="Branch 1 was taken 273 times"> + </span><span class="branchCov" title="Branch 2 was taken 536 times"> + </span>]:<span class="lineCov">        809 :         if (!ovsdb_datum_is_default(datum, &amp;column-&gt;type)) {</span>
<span class="lineNum">    1805 </span>                :<span class="lineCov">        273 :             ds_put_char_multiple(&amp;ctx-&gt;output, ' ', (level + 1) * 4);</span>
<span class="lineNum">    1806 </span>                :<span class="lineCov">        273 :             ds_put_format(&amp;ctx-&gt;output, &quot;%s: &quot;, column-&gt;name);</span>
<span class="lineNum">    1807 </span>                :<span class="lineCov">        273 :             ovsdb_datum_to_string(datum, &amp;column-&gt;type, &amp;ctx-&gt;output);</span>
<span class="lineNum">    1808 </span>                :<span class="lineCov">        273 :             ds_put_char(&amp;ctx-&gt;output, '\n');</span>
<span class="lineNum">    1809 </span>                :            :         }
<span class="lineNum">    1810 </span>                :            :     }
<span class="lineNum">    1811 </span>                :<span class="lineCov">        400 :     cmd_show_weak_ref(ctx, show, row, level);</span>
<span class="lineNum">    1812 </span>                :<span class="lineCov">        400 :     sset_find_and_delete_assert(shown, show-&gt;table-&gt;name);</span>
<span class="lineNum">    1813 </span>                :            : }
<a name="1814"><span class="lineNum">    1814 </span>                :            : </a>
<span class="lineNum">    1815 </span>                :            : static void
<span class="lineNum">    1816 </span>                :<span class="lineCov">         44 : cmd_show(struct ctl_context *ctx)</span>
<span class="lineNum">    1817 </span>                :            : {
<span class="lineNum">    1818 </span>                :            :     const struct ovsdb_idl_row *row;
<span class="lineNum">    1819 </span>                :<span class="lineCov">         44 :     struct sset shown = SSET_INITIALIZER(&amp;shown);</span>
<span class="lineNum">    1820 </span>                :            : 
<span class="lineNum">    1821 </span>        [<span class="branchCov" title="Branch 1 was taken 49 times"> + </span><span class="branchCov" title="Branch 2 was taken 44 times"> + </span>]:<span class="lineCov">         93 :     for (row = ovsdb_idl_first_row(ctx-&gt;idl, cmd_show_tables[0].table);</span>
<span class="lineNum">    1822 </span>                :<span class="lineCov">         49 :          row; row = ovsdb_idl_next_row(row)) {</span>
<span class="lineNum">    1823 </span>                :<span class="lineCov">         49 :         cmd_show_row(ctx, row, 0, &amp;shown);</span>
<span class="lineNum">    1824 </span>                :            :     }
<span class="lineNum">    1825 </span>                :            : 
<span class="lineNum">    1826 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 44 times"> + </span>]:<span class="lineCov">         44 :     ovs_assert(sset_is_empty(&amp;shown));</span>
<span class="lineNum">    1827 </span>                :<span class="lineCov">         44 :     sset_destroy(&amp;shown);</span>
<span class="lineNum">    1828 </span>                :<span class="lineCov">         44 : }</span>
<span class="lineNum">    1829 </span>                :            : 
<span class="lineNum">    1830 </span>                :            : 
<span class="lineNum">    1831 </span>                :            : /* Given pointer to dynamic array 'options_p',  array's current size
<span class="lineNum">    1832 </span>                :            :  * 'allocated_options_p' and number of added options 'n_options_p',
<span class="lineNum">    1833 </span>                :            :  * adds all command options to the array.  Enlarges the array if
<a name="1834"><span class="lineNum">    1834 </span>                :            :  * necessary. */</a>
<span class="lineNum">    1835 </span>                :            : void
<span class="lineNum">    1836 </span>                :<span class="lineCov">       6458 : ctl_add_cmd_options(struct option **options_p, size_t *n_options_p,</span>
<span class="lineNum">    1837 </span>                :            :                     size_t *allocated_options_p, int opt_val)
<span class="lineNum">    1838 </span>                :            : {
<span class="lineNum">    1839 </span>                :            :     struct option *o;
<span class="lineNum">    1840 </span>                :            :     const struct shash_node *node;
<span class="lineNum">    1841 </span>                :<span class="lineCov">       6458 :     size_t n_existing_options = *n_options_p;</span>
<span class="lineNum">    1842 </span>                :            : 
<span class="lineNum">    1843 </span>[<span class="branchCov" title="Branch 2 was taken 290759 times"> + </span><span class="branchCov" title="Branch 3 was taken 6458 times"> + </span>][<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 6458 times"> + </span>]:<span class="lineCov">     297217 :     SHASH_FOR_EACH (node, &amp;all_commands) {</span>
<span class="lineNum">    1844 </span>                :<span class="lineCov">     290759 :         const struct ctl_command_syntax *p = node-&gt;data;</span>
<span class="lineNum">    1845 </span>                :            : 
<span class="lineNum">    1846 </span>        [<span class="branchCov" title="Branch 0 was taken 107091 times"> + </span><span class="branchCov" title="Branch 1 was taken 183668 times"> + </span>]:<span class="lineCov">     290759 :         if (p-&gt;options[0]) {</span>
<span class="lineNum">    1847 </span>                :<span class="lineCov">     107091 :             char *save_ptr = NULL;</span>
<span class="lineNum">    1848 </span>                :            :             char *name;
<span class="lineNum">    1849 </span>                :            :             char *s;
<span class="lineNum">    1850 </span>                :            : 
<span class="lineNum">    1851 </span>                :<span class="lineCov">     107091 :             s = xstrdup(p-&gt;options);</span>
<span class="lineNum">    1852 </span>        [<span class="branchCov" title="Branch 1 was taken 142201 times"> + </span><span class="branchCov" title="Branch 2 was taken 107091 times"> + </span>]:<span class="lineCov">     249292 :             for (name = strtok_r(s, &quot;,&quot;, &amp;save_ptr); name != NULL;</span>
<span class="lineNum">    1853 </span>                :<span class="lineCov">     142201 :                  name = strtok_r(NULL, &quot;,&quot;, &amp;save_ptr)) {</span>
<span class="lineNum">    1854 </span>                :            :                 char *equals;
<span class="lineNum">    1855 </span>                :            :                 int has_arg;
<span class="lineNum">    1856 </span>                :            : 
<span class="lineNum">    1857 </span>[<span class="branchCov" title="Branch 0 was taken 142201 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 142201 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">     142201 :                 ovs_assert(name[0] == '-' &amp;&amp; name[1] == '-' &amp;&amp; name[2]);</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 142201 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>][<span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 142201 times"> + </span>]
<span class="lineNum">    1858 </span>                :<span class="lineCov">     142201 :                 name += 2;</span>
<span class="lineNum">    1859 </span>                :            : 
<span class="lineNum">    1860 </span>                :<span class="lineCov">     142201 :                 equals = strchr(name, '=');</span>
<span class="lineNum">    1861 </span>        [<span class="branchCov" title="Branch 0 was taken 25832 times"> + </span><span class="branchCov" title="Branch 1 was taken 116369 times"> + </span>]:<span class="lineCov">     142201 :                 if (equals) {</span>
<span class="lineNum">    1862 </span>                :<span class="lineCov">      25832 :                     has_arg = required_argument;</span>
<span class="lineNum">    1863 </span>                :<span class="lineCov">      25832 :                     *equals = '\0';</span>
<span class="lineNum">    1864 </span>                :            :                 } else {
<span class="lineNum">    1865 </span>                :<span class="lineCov">     116369 :                     has_arg = no_argument;</span>
<span class="lineNum">    1866 </span>                :            :                 }
<span class="lineNum">    1867 </span>                :            : 
<span class="lineNum">    1868 </span>                :<span class="lineCov">     142201 :                 o = find_option(name, *options_p, *n_options_p);</span>
<span class="lineNum">    1869 </span>        [<span class="branchCov" title="Branch 0 was taken 84875 times"> + </span><span class="branchCov" title="Branch 1 was taken 57326 times"> + </span>]:<span class="lineCov">     142201 :                 if (o) {</span>
<span class="lineNum">    1870 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 84875 times"> + </span>]:<span class="lineCov">      84875 :                     ovs_assert(o - *options_p &gt;= n_existing_options);</span>
<span class="lineNum">    1871 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 84875 times"> + </span>]:<span class="lineCov">      84875 :                     ovs_assert(o-&gt;has_arg == has_arg);</span>
<span class="lineNum">    1872 </span>                :            :                 } else {
<span class="lineNum">    1873 </span>                :<span class="lineCov">      57326 :                     o = add_option(options_p, n_options_p, allocated_options_p);</span>
<span class="lineNum">    1874 </span>                :<span class="lineCov">      57326 :                     o-&gt;name = xstrdup(name);</span>
<span class="lineNum">    1875 </span>                :<span class="lineCov">      57326 :                     o-&gt;has_arg = has_arg;</span>
<span class="lineNum">    1876 </span>                :<span class="lineCov">      57326 :                     o-&gt;flag = NULL;</span>
<span class="lineNum">    1877 </span>                :<span class="lineCov">      57326 :                     o-&gt;val = opt_val;</span>
<span class="lineNum">    1878 </span>                :            :                 }
<span class="lineNum">    1879 </span>                :            :             }
<span class="lineNum">    1880 </span>                :            : 
<span class="lineNum">    1881 </span>                :<span class="lineCov">     107091 :             free(s);</span>
<span class="lineNum">    1882 </span>                :            :         }
<span class="lineNum">    1883 </span>                :            :     }
<span class="lineNum">    1884 </span>                :<span class="lineCov">       6458 :     o = add_option(options_p, n_options_p, allocated_options_p);</span>
<span class="lineNum">    1885 </span>                :<span class="lineCov">       6458 :     memset(o, 0, sizeof *o);</span>
<span class="lineNum">    1886 </span>                :<span class="lineCov">       6458 : }</span>
<span class="lineNum">    1887 </span>                :            : 
<a name="1888"><span class="lineNum">    1888 </span>                :            : /* Parses command-line input for commands. */</a>
<span class="lineNum">    1889 </span>                :            : struct ctl_command *
<span class="lineNum">    1890 </span>                :<span class="lineCov">       6341 : ctl_parse_commands(int argc, char *argv[], struct shash *local_options,</span>
<span class="lineNum">    1891 </span>                :            :                    size_t *n_commandsp)
<span class="lineNum">    1892 </span>                :            : {
<span class="lineNum">    1893 </span>                :            :     struct ctl_command *commands;
<span class="lineNum">    1894 </span>                :            :     size_t n_commands, allocated_commands;
<span class="lineNum">    1895 </span>                :            :     int i, start;
<span class="lineNum">    1896 </span>                :            : 
<span class="lineNum">    1897 </span>                :<span class="lineCov">       6341 :     commands = NULL;</span>
<span class="lineNum">    1898 </span>                :<span class="lineCov">       6341 :     n_commands = allocated_commands = 0;</span>
<span class="lineNum">    1899 </span>                :            : 
<span class="lineNum">    1900 </span>        [<span class="branchCov" title="Branch 0 was taken 53419 times"> + </span><span class="branchCov" title="Branch 1 was taken 6338 times"> + </span>]:<span class="lineCov">      59757 :     for (start = i = 0; i &lt;= argc; i++) {</span>
<span class="lineNum">    1901 </span>[<span class="branchCov" title="Branch 0 was taken 47078 times"> + </span><span class="branchCov" title="Branch 1 was taken 6341 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 5819 times"> + </span><span class="branchCov" title="Branch 3 was taken 41259 times"> + </span>]:<span class="lineCov">      53419 :         if (i == argc || !strcmp(argv[i], &quot;--&quot;)) {</span>
<span class="lineNum">    1902 </span>        [<span class="branchCov" title="Branch 0 was taken 11708 times"> + </span><span class="branchCov" title="Branch 1 was taken 452 times"> + </span>]:<span class="lineCov">      12160 :             if (i &gt; start) {</span>
<span class="lineNum">    1903 </span>        [<span class="branchCov" title="Branch 0 was taken 9528 times"> + </span><span class="branchCov" title="Branch 1 was taken 2180 times"> + </span>]:<span class="lineCov">      11708 :                 if (n_commands &gt;= allocated_commands) {</span>
<span class="lineNum">    1904 </span>                :            :                     struct ctl_command *c;
<span class="lineNum">    1905 </span>                :            : 
<span class="lineNum">    1906 </span>                :<span class="lineCov">       9528 :                     commands = x2nrealloc(commands, &amp;allocated_commands,</span>
<span class="lineNum">    1907 </span>                :            :                                           sizeof *commands);
<span class="lineNum">    1908 </span>        [<span class="branchCov" title="Branch 0 was taken 6569 times"> + </span><span class="branchCov" title="Branch 1 was taken 9528 times"> + </span>]:<span class="lineCov">      16097 :                     for (c = commands; c &lt; &amp;commands[n_commands]; c++) {</span>
<span class="lineNum">    1909 </span>                :<span class="lineCov">       6569 :                         shash_moved(&amp;c-&gt;options);</span>
<span class="lineNum">    1910 </span>                :            :                     }
<span class="lineNum">    1911 </span>                :            :                 }
<span class="lineNum">    1912 </span>                :<span class="lineCov">      11708 :                 parse_command(i - start, &amp;argv[start], local_options,</span>
<span class="lineNum">    1913 </span>                :<span class="lineCov">      11708 :                               &amp;commands[n_commands++]);</span>
<span class="lineNum">    1914 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 450 times"> + </span>]:<span class="lineCov">        452 :             } else if (!shash_is_empty(local_options)) {</span>
<span class="lineNum">    1915 </span>                :<span class="lineCov">          2 :                 ctl_fatal(&quot;missing command name (use --help for help)&quot;);</span>
<span class="lineNum">    1916 </span>                :            :             }
<span class="lineNum">    1917 </span>                :<span class="lineCov">      12157 :             start = i + 1;</span>
<span class="lineNum">    1918 </span>                :            :         }
<span class="lineNum">    1919 </span>                :            :     }
<span class="lineNum">    1920 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 6338 times"> + </span>]:<span class="lineCov">       6338 :     if (!n_commands) {</span>
<span class="lineNum">    1921 </span>                :<span class="lineNoCov">          0 :         ctl_fatal(&quot;missing command name (use --help for help)&quot;);</span>
<span class="lineNum">    1922 </span>                :            :     }
<span class="lineNum">    1923 </span>                :<span class="lineCov">       6338 :     *n_commandsp = n_commands;</span>
<span class="lineNum">    1924 </span>                :<span class="lineCov">       6338 :     return commands;</span>
<span class="lineNum">    1925 </span>                :            : }
<span class="lineNum">    1926 </span>                :            : 
<a name="1927"><span class="lineNum">    1927 </span>                :            : /* Prints all registered commands. */</a>
<span class="lineNum">    1928 </span>                :            : void
<span class="lineNum">    1929 </span>                :<span class="lineCov">         56 : ctl_print_commands(void)</span>
<span class="lineNum">    1930 </span>                :            : {
<span class="lineNum">    1931 </span>                :            :     const struct shash_node *node;
<span class="lineNum">    1932 </span>                :            : 
<span class="lineNum">    1933 </span>[<span class="branchCov" title="Branch 2 was taken 2464 times"> + </span><span class="branchCov" title="Branch 3 was taken 56 times"> + </span>][<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 56 times"> + </span>]:<span class="lineCov">       2520 :     SHASH_FOR_EACH (node, &amp;all_commands) {</span>
<span class="lineNum">    1934 </span>                :<span class="lineCov">       2464 :         const struct ctl_command_syntax *p = node-&gt;data;</span>
<span class="lineNum">    1935 </span>                :<span class="lineCov">       2464 :         char *options = xstrdup(p-&gt;options);</span>
<span class="lineNum">    1936 </span>                :<span class="lineCov">       2464 :         char *options_begin = options;</span>
<span class="lineNum">    1937 </span>                :            :         char *item;
<span class="lineNum">    1938 </span>                :            : 
<span class="lineNum">    1939 </span>        [<span class="branchCov" title="Branch 1 was taken 2800 times"> + </span><span class="branchCov" title="Branch 2 was taken 2464 times"> + </span>]:<span class="lineCov">       5264 :         for (item = strsep(&amp;options, &quot;,&quot;); item != NULL;</span>
<span class="lineNum">    1940 </span>                :<span class="lineCov">       2800 :              item = strsep(&amp;options, &quot;,&quot;)) {</span>
<span class="lineNum">    1941 </span>        [<span class="branchCov" title="Branch 0 was taken 1232 times"> + </span><span class="branchCov" title="Branch 1 was taken 1568 times"> + </span>]:<span class="lineCov">       2800 :             if (item[0] != '\0') {</span>
<span class="lineNum">    1942 </span>                :<span class="lineCov">       1232 :                 printf(&quot;[%s] &quot;, item);</span>
<span class="lineNum">    1943 </span>                :            :             }
<span class="lineNum">    1944 </span>                :            :         }
<span class="lineNum">    1945 </span>                :<span class="lineCov">       2464 :         printf(&quot;,%s,&quot;, p-&gt;name);</span>
<span class="lineNum">    1946 </span>                :<span class="lineCov">       2464 :         print_command_arguments(p);</span>
<span class="lineNum">    1947 </span>                :<span class="lineCov">       2464 :         printf(&quot;\n&quot;);</span>
<span class="lineNum">    1948 </span>                :            : 
<span class="lineNum">    1949 </span>                :<span class="lineCov">       2464 :         free(options_begin);</span>
<span class="lineNum">    1950 </span>                :            :     }
<span class="lineNum">    1951 </span>                :            : 
<span class="lineNum">    1952 </span>                :<span class="lineCov">         56 :     exit(EXIT_SUCCESS);</span>
<span class="lineNum">    1953 </span>                :            : }
<span class="lineNum">    1954 </span>                :            : 
<a name="1955"><span class="lineNum">    1955 </span>                :            : /* Given array of options 'options', prints them. */</a>
<span class="lineNum">    1956 </span>                :            : void
<span class="lineNum">    1957 </span>                :<span class="lineCov">         54 : ctl_print_options(const struct option *options)</span>
<span class="lineNum">    1958 </span>                :            : {
<span class="lineNum">    1959 </span>        [<span class="branchCov" title="Branch 0 was taken 1350 times"> + </span><span class="branchCov" title="Branch 1 was taken 54 times"> + </span>]:<span class="lineCov">       1404 :     for (; options-&gt;name; options++) {</span>
<span class="lineNum">    1960 </span>                :<span class="lineCov">       1350 :         const struct option *o = options;</span>
<span class="lineNum">    1961 </span>                :            : 
<span class="lineNum">    1962 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchCov" title="Branch 1 was taken 648 times"> + </span>]:<span class="lineCov">       1350 :         printf(&quot;--%s%s\n&quot;, o-&gt;name, o-&gt;has_arg ? &quot;=ARG&quot; : &quot;&quot;);</span>
<span class="lineNum">    1963 </span>[<span class="branchCov" title="Branch 0 was taken 1350 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 1350 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1350 :         if (o-&gt;flag == NULL &amp;&amp; o-&gt;val &gt; 0 &amp;&amp; o-&gt;val &lt;= UCHAR_MAX) {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 486 times"> + </span><span class="branchCov" title="Branch 5 was taken 864 times"> + </span>]
<span class="lineNum">    1964 </span>        [<span class="branchCov" title="Branch 0 was taken 378 times"> + </span><span class="branchCov" title="Branch 1 was taken 108 times"> + </span>]:<span class="lineCov">        486 :             printf(&quot;-%c%s\n&quot;, o-&gt;val, o-&gt;has_arg ? &quot; ARG&quot; : &quot;&quot;);</span>
<span class="lineNum">    1965 </span>                :            :         }
<span class="lineNum">    1966 </span>                :            :     }
<span class="lineNum">    1967 </span>                :            : 
<span class="lineNum">    1968 </span>                :<span class="lineCov">         54 :     exit(EXIT_SUCCESS);</span>
<span class="lineNum">    1969 </span>                :            : }
<span class="lineNum">    1970 </span>                :            : 
<a name="1971"><span class="lineNum">    1971 </span>                :            : /* Returns the default local database path. */</a>
<span class="lineNum">    1972 </span>                :            : char *
<span class="lineNum">    1973 </span>                :<span class="lineCov">       4196 : ctl_default_db(void)</span>
<span class="lineNum">    1974 </span>                :            : {
<span class="lineNum">    1975 </span>                :            :     static char *def;
<span class="lineNum">    1976 </span>        [<span class="branchCov" title="Branch 0 was taken 4196 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       4196 :     if (!def) {</span>
<span class="lineNum">    1977 </span>                :<span class="lineCov">       4196 :         def = xasprintf(&quot;unix:%s/db.sock&quot;, ovs_rundir());</span>
<span class="lineNum">    1978 </span>                :            :     }
<span class="lineNum">    1979 </span>                :<span class="lineCov">       4196 :     return def;</span>
<span class="lineNum">    1980 </span>                :            : }
<span class="lineNum">    1981 </span>                :            : 
<span class="lineNum">    1982 </span>                :            : /* Returns true if it looks like this set of arguments might modify the
<span class="lineNum">    1983 </span>                :            :  * database, otherwise false.  (Not very smart, so it's prone to false
<a name="1984"><span class="lineNum">    1984 </span>                :            :  * positives.) */</a>
<span class="lineNum">    1985 </span>                :            : bool
<span class="lineNum">    1986 </span>                :<span class="lineCov">       6458 : ctl_might_write_to_db(char **argv)</span>
<span class="lineNum">    1987 </span>                :            : {
<span class="lineNum">    1988 </span>        [<span class="branchCov" title="Branch 0 was taken 24999 times"> + </span><span class="branchCov" title="Branch 1 was taken 2275 times"> + </span>]:<span class="lineCov">      27274 :     for (; *argv; argv++) {</span>
<span class="lineNum">    1989 </span>                :<span class="lineCov">      24999 :         const struct ctl_command_syntax *p = shash_find_data(&amp;all_commands,</span>
<span class="lineNum">    1990 </span>                :            :                                                              *argv);
<span class="lineNum">    1991 </span>[<span class="branchCov" title="Branch 0 was taken 6535 times"> + </span><span class="branchCov" title="Branch 1 was taken 18464 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 4183 times"> + </span><span class="branchCov" title="Branch 3 was taken 2352 times"> + </span>]:<span class="lineCov">      24999 :         if (p &amp;&amp; p-&gt;mode == RW) {</span>
<span class="lineNum">    1992 </span>                :<span class="lineCov">       4183 :             return true;</span>
<span class="lineNum">    1993 </span>                :            :         }
<span class="lineNum">    1994 </span>                :            :     }
<span class="lineNum">    1995 </span>                :<span class="lineCov">       2275 :     return false;</span>
<span class="lineNum">    1996 </span>                :            : }
<a name="1997"><span class="lineNum">    1997 </span>                :            : </a>
<span class="lineNum">    1998 </span>                :            : void
<span class="lineNum">    1999 </span>                :<span class="lineCov">        154 : ctl_fatal(const char *format, ...)</span>
<span class="lineNum">    2000 </span>                :            : {
<span class="lineNum">    2001 </span>                :            :     char *message;
<span class="lineNum">    2002 </span>                :            :     va_list args;
<span class="lineNum">    2003 </span>                :            : 
<span class="lineNum">    2004 </span>                :<span class="lineCov">        154 :     va_start(args, format);</span>
<span class="lineNum">    2005 </span>                :<span class="lineCov">        154 :     message = xvasprintf(format, args);</span>
<span class="lineNum">    2006 </span>                :<span class="lineCov">        154 :     va_end(args);</span>
<span class="lineNum">    2007 </span>                :            : 
<span class="lineNum">    2008 </span>                :<span class="lineCov">        154 :     vlog_set_levels(&amp;this_module, VLF_CONSOLE, VLL_OFF);</span>
<span class="lineNum">    2009 </span>        [<span class="branchCov" title="Branch 0 was taken 154 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        154 :     VLOG_ERR(&quot;%s&quot;, message);</span>
<span class="lineNum">    2010 </span>                :<span class="lineCov">        154 :     ovs_error(0, &quot;%s&quot;, message);</span>
<span class="lineNum">    2011 </span>                :<span class="lineCov">        154 :     ctl_exit(EXIT_FAILURE);</span>
<span class="lineNum">    2012 </span>                :            : }
<span class="lineNum">    2013 </span>                :            : 
<span class="lineNum">    2014 </span>                :            : /* Frees the current transaction and the underlying IDL and then calls
<span class="lineNum">    2015 </span>                :            :  * exit(status).
<span class="lineNum">    2016 </span>                :            :  *
<span class="lineNum">    2017 </span>                :            :  * Freeing the transaction and the IDL is not strictly necessary, but it makes
<span class="lineNum">    2018 </span>                :            :  * for a clean memory leak report from valgrind in the normal case.  That makes
<a name="2019"><span class="lineNum">    2019 </span>                :            :  * it easier to notice real memory leaks. */</a>
<span class="lineNum">    2020 </span>                :            : static void
<span class="lineNum">    2021 </span>                :<span class="lineCov">        154 : ctl_exit(int status)</span>
<span class="lineNum">    2022 </span>                :            : {
<span class="lineNum">    2023 </span>        [<span class="branchCov" title="Branch 0 was taken 154 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        154 :     if (ctl_exit_func) {</span>
<span class="lineNum">    2024 </span>                :<span class="lineCov">        154 :         ctl_exit_func(status);</span>
<span class="lineNum">    2025 </span>                :            :     }
<span class="lineNum">    2026 </span>                :<span class="lineNoCov">          0 :     exit(status);</span>
<span class="lineNum">    2027 </span>                :            : }
<span class="lineNum">    2028 </span>                :            : 
<span class="lineNum">    2029 </span>                :            : /* Comman database commands to be registered. */
<span class="lineNum">    2030 </span>                :            : static const struct ctl_command_syntax db_ctl_commands[] = {
<span class="lineNum">    2031 </span>                :            :     {&quot;comment&quot;, 0, INT_MAX, &quot;[ARG]...&quot;, NULL, NULL, NULL, &quot;&quot;, RO},
<span class="lineNum">    2032 </span>                :            :     {&quot;get&quot;, 2, INT_MAX, &quot;TABLE RECORD [COLUMN[:KEY]]...&quot;,pre_cmd_get, cmd_get,
<span class="lineNum">    2033 </span>                :            :      NULL, &quot;--if-exists,--id=&quot;, RO},
<span class="lineNum">    2034 </span>                :            :     {&quot;list&quot;, 1, INT_MAX, &quot;TABLE [RECORD]...&quot;, pre_cmd_list, cmd_list, NULL,
<span class="lineNum">    2035 </span>                :            :      &quot;--if-exists,--columns=&quot;, RO},
<span class="lineNum">    2036 </span>                :            :     {&quot;find&quot;, 1, INT_MAX, &quot;TABLE [COLUMN[:KEY]=VALUE]...&quot;, pre_cmd_find,
<span class="lineNum">    2037 </span>                :            :      cmd_find, NULL, &quot;--columns=&quot;, RO},
<span class="lineNum">    2038 </span>                :            :     {&quot;set&quot;, 3, INT_MAX, &quot;TABLE RECORD COLUMN[:KEY]=VALUE...&quot;, pre_cmd_set,
<span class="lineNum">    2039 </span>                :            :      cmd_set, NULL, &quot;--if-exists&quot;, RW},
<span class="lineNum">    2040 </span>                :            :     {&quot;add&quot;, 4, INT_MAX, &quot;TABLE RECORD COLUMN [KEY=]VALUE...&quot;, pre_cmd_add,
<span class="lineNum">    2041 </span>                :            :      cmd_add, NULL, &quot;--if-exists&quot;, RW},
<span class="lineNum">    2042 </span>                :            :     {&quot;remove&quot;, 4, INT_MAX, &quot;TABLE RECORD COLUMN KEY|VALUE|KEY=VALUE...&quot;,
<span class="lineNum">    2043 </span>                :            :      pre_cmd_remove, cmd_remove, NULL, &quot;--if-exists&quot;, RW},
<span class="lineNum">    2044 </span>                :            :     {&quot;clear&quot;, 3, INT_MAX, &quot;TABLE RECORD COLUMN...&quot;, pre_cmd_clear, cmd_clear,
<span class="lineNum">    2045 </span>                :            :      NULL, &quot;--if-exists&quot;, RW},
<span class="lineNum">    2046 </span>                :            :     {&quot;create&quot;, 2, INT_MAX, &quot;TABLE COLUMN[:KEY]=VALUE...&quot;, pre_create,
<span class="lineNum">    2047 </span>                :            :      cmd_create, post_create, &quot;--id=&quot;, RW},
<span class="lineNum">    2048 </span>                :            :     {&quot;destroy&quot;, 1, INT_MAX, &quot;TABLE [RECORD]...&quot;, pre_cmd_destroy, cmd_destroy,
<span class="lineNum">    2049 </span>                :            :      NULL, &quot;--if-exists,--all&quot;, RW},
<span class="lineNum">    2050 </span>                :            :     {&quot;wait-until&quot;, 2, INT_MAX, &quot;TABLE RECORD [COLUMN[:KEY]=VALUE]...&quot;,
<span class="lineNum">    2051 </span>                :            :      pre_cmd_wait_until, cmd_wait_until, NULL, &quot;&quot;, RO},
<span class="lineNum">    2052 </span>                :            :     {NULL, 0, 0, NULL, NULL, NULL, NULL, NULL, RO},
<span class="lineNum">    2053 </span>                :            : };
<a name="2054"><span class="lineNum">    2054 </span>                :            : </a>
<span class="lineNum">    2055 </span>                :            : static void
<span class="lineNum">    2056 </span>                :<span class="lineCov">     290759 : ctl_register_command(const struct ctl_command_syntax *command)</span>
<span class="lineNum">    2057 </span>                :            : {
<span class="lineNum">    2058 </span>                :<span class="lineCov">     290759 :     shash_add_assert(&amp;all_commands, command-&gt;name, command);</span>
<span class="lineNum">    2059 </span>                :<span class="lineCov">     290759 : }</span>
<span class="lineNum">    2060 </span>                :            : 
<span class="lineNum">    2061 </span>                :            : /* Registers commands represented by 'struct ctl_command_syntax's to
<span class="lineNum">    2062 </span>                :            :  * 'all_commands'.  The last element of 'commands' must be an all-NULL
<a name="2063"><span class="lineNum">    2063 </span>                :            :  * element. */</a>
<span class="lineNum">    2064 </span>                :            : void
<span class="lineNum">    2065 </span>                :<span class="lineCov">      12916 : ctl_register_commands(const struct ctl_command_syntax *commands)</span>
<span class="lineNum">    2066 </span>                :            : {
<span class="lineNum">    2067 </span>                :            :     const struct ctl_command_syntax *p;
<span class="lineNum">    2068 </span>                :            : 
<span class="lineNum">    2069 </span>        [<span class="branchCov" title="Branch 0 was taken 285194 times"> + </span><span class="branchCov" title="Branch 1 was taken 12916 times"> + </span>]:<span class="lineCov">     298110 :     for (p = commands; p-&gt;name; p++) {</span>
<span class="lineNum">    2070 </span>                :<span class="lineCov">     285194 :         ctl_register_command(p);</span>
<span class="lineNum">    2071 </span>                :            :     }
<span class="lineNum">    2072 </span>                :<span class="lineCov">      12916 : }</span>
<span class="lineNum">    2073 </span>                :            : 
<a name="2074"><span class="lineNum">    2074 </span>                :            : /* Registers the 'db_ctl_commands' to 'all_commands'. */</a>
<span class="lineNum">    2075 </span>                :            : void
<span class="lineNum">    2076 </span>                :<span class="lineCov">       6458 : ctl_init(const struct ctl_table_class tables_[],</span>
<span class="lineNum">    2077 </span>                :            :          const struct cmd_show_table cmd_show_tables_[],
<span class="lineNum">    2078 </span>                :            :          void (*ctl_exit_func_)(int status))
<span class="lineNum">    2079 </span>                :            : {
<span class="lineNum">    2080 </span>                :<span class="lineCov">       6458 :     tables = tables_;</span>
<span class="lineNum">    2081 </span>                :<span class="lineCov">       6458 :     ctl_exit_func = ctl_exit_func_;</span>
<span class="lineNum">    2082 </span>                :<span class="lineCov">       6458 :     ctl_register_commands(db_ctl_commands);</span>
<span class="lineNum">    2083 </span>                :            : 
<span class="lineNum">    2084 </span>                :<span class="lineCov">       6458 :     cmd_show_tables = cmd_show_tables_;</span>
<span class="lineNum">    2085 </span>        [<span class="branchCov" title="Branch 0 was taken 5565 times"> + </span><span class="branchCov" title="Branch 1 was taken 893 times"> + </span>]:<span class="lineCov">       6458 :     if (cmd_show_tables) {</span>
<span class="lineNum">    2086 </span>                :            :         static const struct ctl_command_syntax show =
<span class="lineNum">    2087 </span>                :            :             {&quot;show&quot;, 0, 0, &quot;&quot;, pre_cmd_show, cmd_show, NULL, &quot;&quot;, RO};
<span class="lineNum">    2088 </span>                :<span class="lineCov">       5565 :         ctl_register_command(&amp;show);</span>
<span class="lineNum">    2089 </span>                :            :     }
<span class="lineNum">    2090 </span>                :<span class="lineCov">       6458 : }</span>
<span class="lineNum">    2091 </span>                :            : 
<a name="2092"><span class="lineNum">    2092 </span>                :            : /* Returns the text for the database commands usage.  */</a>
<span class="lineNum">    2093 </span>                :            : const char *
<span class="lineNum">    2094 </span>                :<span class="lineNoCov">          0 : ctl_get_db_cmd_usage(void)</span>
<span class="lineNum">    2095 </span>                :            : {
<span class="lineNum">    2096 </span>                :<span class="lineNoCov">          0 :     return &quot;Database commands:\n\</span>
<span class="lineNum">    2097 </span>                :            :   list TBL [REC]              list RECord (or all records) in TBL\n\
<span class="lineNum">    2098 </span>                :            :   find TBL CONDITION...       list records satisfying CONDITION in TBL\n\
<span class="lineNum">    2099 </span>                :            :   get TBL REC COL[:KEY]       print values of COLumns in RECord in TBL\n\
<span class="lineNum">    2100 </span>                :            :   set TBL REC COL[:KEY]=VALUE set COLumn values in RECord in TBL\n\
<span class="lineNum">    2101 </span>                :            :   add TBL REC COL [KEY=]VALUE add (KEY=)VALUE to COLumn in RECord in TBL\n\
<span class="lineNum">    2102 </span>                :            :   remove TBL REC COL [KEY=]VALUE  remove (KEY=)VALUE from COLumn\n\
<span class="lineNum">    2103 </span>                :            :   clear TBL REC COL           clear values from COLumn in RECord in TBL\n\
<span class="lineNum">    2104 </span>                :            :   create TBL COL[:KEY]=VALUE  create and initialize new record\n\
<span class="lineNum">    2105 </span>                :            :   destroy TBL REC             delete RECord from TBL\n\
<span class="lineNum">    2106 </span>                :            :   wait-until TBL REC [COL[:KEY]=VALUE]  wait until condition is true\n\
<span class="lineNum">    2107 </span>                :            : Potentially unsafe database commands require --force option.\n&quot;;
<span class="lineNum">    2108 </span>                :            : }
<span class="lineNum">    2109 </span>                :            : 
<a name="2110"><span class="lineNum">    2110 </span>                :            : /* Initializes 'ctx' from 'command'. */</a>
<span class="lineNum">    2111 </span>                :            : void
<span class="lineNum">    2112 </span>                :<span class="lineCov">      21981 : ctl_context_init_command(struct ctl_context *ctx,</span>
<span class="lineNum">    2113 </span>                :            :                          struct ctl_command *command)
<span class="lineNum">    2114 </span>                :            : {
<span class="lineNum">    2115 </span>                :<span class="lineCov">      21981 :     ctx-&gt;argc = command-&gt;argc;</span>
<span class="lineNum">    2116 </span>                :<span class="lineCov">      21981 :     ctx-&gt;argv = command-&gt;argv;</span>
<span class="lineNum">    2117 </span>                :<span class="lineCov">      21981 :     ctx-&gt;options = command-&gt;options;</span>
<span class="lineNum">    2118 </span>                :            : 
<span class="lineNum">    2119 </span>                :<span class="lineCov">      21981 :     ds_swap(&amp;ctx-&gt;output, &amp;command-&gt;output);</span>
<span class="lineNum">    2120 </span>                :<span class="lineCov">      21981 :     ctx-&gt;table = command-&gt;table;</span>
<span class="lineNum">    2121 </span>                :<span class="lineCov">      21981 :     ctx-&gt;try_again = false;</span>
<span class="lineNum">    2122 </span>                :<span class="lineCov">      21981 : }</span>
<span class="lineNum">    2123 </span>                :            : 
<a name="2124"><span class="lineNum">    2124 </span>                :            : /* Initializes the entire 'ctx'. */</a>
<span class="lineNum">    2125 </span>                :            : void
<span class="lineNum">    2126 </span>                :<span class="lineCov">      16613 : ctl_context_init(struct ctl_context *ctx, struct ctl_command *command,</span>
<span class="lineNum">    2127 </span>                :            :                  struct ovsdb_idl *idl, struct ovsdb_idl_txn *txn,
<span class="lineNum">    2128 </span>                :            :                  struct ovsdb_symbol_table *symtab,
<span class="lineNum">    2129 </span>                :            :                  void (*invalidate_cache)(struct ctl_context *))
<span class="lineNum">    2130 </span>                :            : {
<span class="lineNum">    2131 </span>        [<span class="branchCov" title="Branch 0 was taken 10279 times"> + </span><span class="branchCov" title="Branch 1 was taken 6334 times"> + </span>]:<span class="lineCov">      16613 :     if (command) {</span>
<span class="lineNum">    2132 </span>                :<span class="lineCov">      10279 :         ctl_context_init_command(ctx, command);</span>
<span class="lineNum">    2133 </span>                :            :     }
<span class="lineNum">    2134 </span>                :<span class="lineCov">      16613 :     ctx-&gt;idl = idl;</span>
<span class="lineNum">    2135 </span>                :<span class="lineCov">      16613 :     ctx-&gt;txn = txn;</span>
<span class="lineNum">    2136 </span>                :<span class="lineCov">      16613 :     ctx-&gt;symtab = symtab;</span>
<span class="lineNum">    2137 </span>                :<span class="lineCov">      16613 :     ctx-&gt;invalidate_cache = invalidate_cache;</span>
<span class="lineNum">    2138 </span>                :<span class="lineCov">      16613 : }</span>
<span class="lineNum">    2139 </span>                :            : 
<a name="2140"><span class="lineNum">    2140 </span>                :            : /* Completes processing of 'command' within 'ctx'. */</a>
<span class="lineNum">    2141 </span>                :            : void
<span class="lineNum">    2142 </span>                :<span class="lineCov">      21780 : ctl_context_done_command(struct ctl_context *ctx,</span>
<span class="lineNum">    2143 </span>                :            :                          struct ctl_command *command)
<span class="lineNum">    2144 </span>                :            : {
<span class="lineNum">    2145 </span>                :<span class="lineCov">      21780 :     ds_swap(&amp;ctx-&gt;output, &amp;command-&gt;output);</span>
<span class="lineNum">    2146 </span>                :<span class="lineCov">      21780 :     command-&gt;table = ctx-&gt;table;</span>
<span class="lineNum">    2147 </span>                :<span class="lineCov">      21780 : }</span>
<span class="lineNum">    2148 </span>                :            : 
<span class="lineNum">    2149 </span>                :            : /* Finishes up with 'ctx'.
<span class="lineNum">    2150 </span>                :            :  *
<span class="lineNum">    2151 </span>                :            :  * If command is nonnull, first calls ctl_context_done_command() to complete
<a name="2152"><span class="lineNum">    2152 </span>                :            :  * processing that command within 'ctx'. */</a>
<span class="lineNum">    2153 </span>                :            : void
<span class="lineNum">    2154 </span>                :<span class="lineCov">      16412 : ctl_context_done(struct ctl_context *ctx,</span>
<span class="lineNum">    2155 </span>                :            :                  struct ctl_command *command)
<span class="lineNum">    2156 </span>                :            : {
<span class="lineNum">    2157 </span>        [<span class="branchCov" title="Branch 0 was taken 10273 times"> + </span><span class="branchCov" title="Branch 1 was taken 6139 times"> + </span>]:<span class="lineCov">      16412 :     if (command) {</span>
<span class="lineNum">    2158 </span>                :<span class="lineCov">      10273 :         ctl_context_done_command(ctx, command);</span>
<span class="lineNum">    2159 </span>                :            :     }
<span class="lineNum">    2160 </span>                :<span class="lineCov">      16412 :     invalidate_cache(ctx);</span>
<a name="2161"><span class="lineNum">    2161 </span>                :<span class="lineCov">      16412 : }</span></a>
<span class="lineNum">    2162 </span>                :            : 
<span class="lineNum">    2163 </span>                :<span class="lineCov">         67 : void ctl_set_column(const char *table_name,</span>
<span class="lineNum">    2164 </span>                :            :                     const struct ovsdb_idl_row *row, const char *arg,
<span class="lineNum">    2165 </span>                :            :                     struct ovsdb_symbol_table *symtab)
<span class="lineNum">    2166 </span>                :            : {
<span class="lineNum">    2167 </span>                :<span class="lineCov">         67 :     set_column(get_table(table_name), row, arg, symtab);</span>
<span class="lineNum">    2168 </span>                :<span class="lineCov">         67 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
