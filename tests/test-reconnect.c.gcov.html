<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - tests/test-reconnect.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">tests</a> - test-reconnect.c<span style="font-size: 80%;"> (source / <a href="test-reconnect.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">120</td>
            <td class="headerCovTableEntry">130</td>
            <td class="headerCovTableEntryHi">92.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2014-07-01</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">18</td>
            <td class="headerCovTableEntry">20</td>
            <td class="headerCovTableEntryHi">90.0 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">59</td>
            <td class="headerCovTableEntry">70</td>
            <td class="headerCovTableEntryMed">84.3 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /*</a>
<span class="lineNum">       2 </span>                :            :  * Copyright (c) 2009, 2010, 2011, 2012, 2014 Nicira, Inc.
<span class="lineNum">       3 </span>                :            :  *
<span class="lineNum">       4 </span>                :            :  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class="lineNum">       5 </span>                :            :  * you may not use this file except in compliance with the License.
<span class="lineNum">       6 </span>                :            :  * You may obtain a copy of the License at:
<span class="lineNum">       7 </span>                :            :  *
<span class="lineNum">       8 </span>                :            :  *     http://www.apache.org/licenses/LICENSE-2.0
<span class="lineNum">       9 </span>                :            :  *
<span class="lineNum">      10 </span>                :            :  * Unless required by applicable law or agreed to in writing, software
<span class="lineNum">      11 </span>                :            :  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class="lineNum">      12 </span>                :            :  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class="lineNum">      13 </span>                :            :  * See the License for the specific language governing permissions and
<span class="lineNum">      14 </span>                :            :  * limitations under the License.
<span class="lineNum">      15 </span>                :            :  */
<span class="lineNum">      16 </span>                :            : 
<span class="lineNum">      17 </span>                :            : #include &lt;config.h&gt;
<span class="lineNum">      18 </span>                :            : 
<span class="lineNum">      19 </span>                :            : #include &quot;reconnect.h&quot;
<span class="lineNum">      20 </span>                :            : 
<span class="lineNum">      21 </span>                :            : #include &lt;errno.h&gt;
<span class="lineNum">      22 </span>                :            : #include &lt;stdio.h&gt;
<span class="lineNum">      23 </span>                :            : #include &lt;stdlib.h&gt;
<span class="lineNum">      24 </span>                :            : #include &lt;string.h&gt;
<span class="lineNum">      25 </span>                :            : 
<span class="lineNum">      26 </span>                :            : #include &quot;command-line.h&quot;
<span class="lineNum">      27 </span>                :            : #include &quot;compiler.h&quot;
<span class="lineNum">      28 </span>                :            : #include &quot;svec.h&quot;
<span class="lineNum">      29 </span>                :            : #include &quot;util.h&quot;
<span class="lineNum">      30 </span>                :            : #include &quot;vlog.h&quot;
<span class="lineNum">      31 </span>                :            : #include &quot;ovstest.h&quot;
<span class="lineNum">      32 </span>                :            : 
<span class="lineNum">      33 </span>                :            : static struct reconnect *reconnect;
<span class="lineNum">      34 </span>                :            : static int now;
<span class="lineNum">      35 </span>                :            : 
<span class="lineNum">      36 </span>                :            : static void diff_stats(const struct reconnect_stats *old,
<span class="lineNum">      37 </span>                :            :                        const struct reconnect_stats *new,
<span class="lineNum">      38 </span>                :            :                        int delta);
<span class="lineNum">      39 </span>                :            : static const struct command *get_all_commands(void);
<a name="40"><span class="lineNum">      40 </span>                :            : </a>
<span class="lineNum">      41 </span>                :            : static void
<span class="lineNum">      42 </span>                :<span class="lineCov">         12 : test_reconnect_main(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">      43 </span>                :            : {
<span class="lineNum">      44 </span>                :            :     extern struct vlog_module VLM_reconnect;
<span class="lineNum">      45 </span>                :            :     struct reconnect_stats prev;
<span class="lineNum">      46 </span>                :            :     unsigned int old_max_tries;
<span class="lineNum">      47 </span>                :            :     int old_time;
<span class="lineNum">      48 </span>                :            :     char line[128];
<span class="lineNum">      49 </span>                :            : 
<span class="lineNum">      50 </span>                :<span class="lineCov">         12 :     vlog_set_levels(&amp;VLM_reconnect, VLF_ANY_FACILITY, VLL_OFF);</span>
<span class="lineNum">      51 </span>                :            : 
<span class="lineNum">      52 </span>                :<span class="lineCov">         12 :     now = 1000;</span>
<span class="lineNum">      53 </span>                :<span class="lineCov">         12 :     reconnect = reconnect_create(now);</span>
<span class="lineNum">      54 </span>                :<span class="lineCov">         12 :     reconnect_set_name(reconnect, &quot;remote&quot;);</span>
<span class="lineNum">      55 </span>                :<span class="lineCov">         12 :     reconnect_get_stats(reconnect, now, &amp;prev);</span>
<span class="lineNum">      56 </span>                :<span class="lineCov">         12 :     printf(&quot;### t=%d ###\n&quot;, now);</span>
<span class="lineNum">      57 </span>                :<span class="lineCov">         12 :     old_time = now;</span>
<span class="lineNum">      58 </span>                :<span class="lineCov">         12 :     old_max_tries = reconnect_get_max_tries(reconnect);</span>
<span class="lineNum">      59 </span>        [<span class="branchCov" title="Branch 1 was taken 338 times"> + </span><span class="branchCov" title="Branch 2 was taken 12 times"> + </span>]:<span class="lineCov">        350 :     while (fgets(line, sizeof line, stdin)) {</span>
<span class="lineNum">      60 </span>                :            :         struct reconnect_stats cur;
<span class="lineNum">      61 </span>                :            :         struct svec args;
<span class="lineNum">      62 </span>                :            : 
<span class="lineNum">      63 </span>                :<span class="lineCov">        338 :         fputs(line, stdout);</span>
<span class="lineNum">      64 </span>        [<span class="branchCov" title="Branch 0 was taken 60 times"> + </span><span class="branchCov" title="Branch 1 was taken 278 times"> + </span>]:<span class="lineCov">        338 :         if (line[0] == '#') {</span>
<span class="lineNum">      65 </span>                :<span class="lineCov">         60 :             continue;</span>
<span class="lineNum">      66 </span>                :            :         }
<span class="lineNum">      67 </span>                :            : 
<span class="lineNum">      68 </span>                :<span class="lineCov">        278 :         svec_init(&amp;args);</span>
<span class="lineNum">      69 </span>                :<span class="lineCov">        278 :         svec_parse_words(&amp;args, line);</span>
<span class="lineNum">      70 </span>                :<span class="lineCov">        278 :         svec_terminate(&amp;args);</span>
<span class="lineNum">      71 </span>        [<span class="branchCov" title="Branch 1 was taken 218 times"> + </span><span class="branchCov" title="Branch 2 was taken 60 times"> + </span>]:<span class="lineCov">        278 :         if (!svec_is_empty(&amp;args)) {</span>
<span class="lineNum">      72 </span>                :<span class="lineCov">        218 :             run_command(args.n, args.names, get_all_commands());</span>
<span class="lineNum">      73 </span>                :            :         }
<span class="lineNum">      74 </span>                :<span class="lineCov">        278 :         svec_destroy(&amp;args);</span>
<span class="lineNum">      75 </span>                :            : 
<span class="lineNum">      76 </span>        [<span class="branchCov" title="Branch 0 was taken 58 times"> + </span><span class="branchCov" title="Branch 1 was taken 220 times"> + </span>]:<span class="lineCov">        278 :         if (old_time != now) {</span>
<span class="lineNum">      77 </span>                :<span class="lineCov">         58 :             printf(&quot;\n### t=%d ###\n&quot;, now);</span>
<span class="lineNum">      78 </span>                :            :         }
<span class="lineNum">      79 </span>                :            : 
<span class="lineNum">      80 </span>                :<span class="lineCov">        278 :         reconnect_get_stats(reconnect, now, &amp;cur);</span>
<span class="lineNum">      81 </span>                :<span class="lineCov">        278 :         diff_stats(&amp;prev, &amp;cur, now - old_time);</span>
<span class="lineNum">      82 </span>                :<span class="lineCov">        278 :         prev = cur;</span>
<span class="lineNum">      83 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchCov" title="Branch 2 was taken 275 times"> + </span>]:<span class="lineCov">        278 :         if (reconnect_get_max_tries(reconnect) != old_max_tries) {</span>
<span class="lineNum">      84 </span>                :<span class="lineCov">          3 :             old_max_tries = reconnect_get_max_tries(reconnect);</span>
<span class="lineNum">      85 </span>                :<span class="lineCov">          3 :             printf(&quot;  %u tries left\n&quot;, old_max_tries);</span>
<span class="lineNum">      86 </span>                :            :         }
<span class="lineNum">      87 </span>                :            : 
<span class="lineNum">      88 </span>                :<span class="lineCov">        278 :         old_time = now;</span>
<span class="lineNum">      89 </span>                :            :     }
<span class="lineNum">      90 </span>                :<span class="lineCov">         12 : }</span>
<a name="91"><span class="lineNum">      91 </span>                :            : </a>
<span class="lineNum">      92 </span>                :            : static void
<span class="lineNum">      93 </span>                :<span class="lineCov">         11 : do_enable(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">      94 </span>                :            : {
<span class="lineNum">      95 </span>                :<span class="lineCov">         11 :     reconnect_enable(reconnect, now);</span>
<span class="lineNum">      96 </span>                :<span class="lineCov">         11 : }</span>
<a name="97"><span class="lineNum">      97 </span>                :            : </a>
<span class="lineNum">      98 </span>                :            : static void
<span class="lineNum">      99 </span>                :<span class="lineNoCov">          0 : do_disable(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     100 </span>                :            : {
<span class="lineNum">     101 </span>                :<span class="lineNoCov">          0 :     reconnect_disable(reconnect, now);</span>
<span class="lineNum">     102 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="103"><span class="lineNum">     103 </span>                :            : </a>
<span class="lineNum">     104 </span>                :            : static void
<span class="lineNum">     105 </span>                :<span class="lineNoCov">          0 : do_force_reconnect(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     106 </span>                :            : {
<span class="lineNum">     107 </span>                :<span class="lineNoCov">          0 :     reconnect_force_reconnect(reconnect, now);</span>
<span class="lineNum">     108 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="109"><span class="lineNum">     109 </span>                :            : </a>
<span class="lineNum">     110 </span>                :            : static int
<span class="lineNum">     111 </span>                :<span class="lineCov">         24 : error_from_string(const char *s)</span>
<span class="lineNum">     112 </span>                :            : {
<span class="lineNum">     113 </span>        [<span class="branchCov" title="Branch 0 was taken 22 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">         24 :     if (!s) {</span>
<span class="lineNum">     114 </span>                :<span class="lineCov">         22 :         return 0;</span>
<span class="lineNum">     115 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :     } else if (!strcmp(s, &quot;ECONNREFUSED&quot;)) {</span>
<span class="lineNum">     116 </span>                :<span class="lineCov">          2 :         return ECONNREFUSED;</span>
<span class="lineNum">     117 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     } else if (!strcmp(s, &quot;EOF&quot;)) {</span>
<span class="lineNum">     118 </span>                :<span class="lineNoCov">          0 :         return EOF;</span>
<span class="lineNum">     119 </span>                :            :     } else {
<span class="lineNum">     120 </span>                :<span class="lineCov">         24 :         ovs_fatal(0, &quot;unknown error '%s'&quot;, s);</span>
<span class="lineNum">     121 </span>                :            :     }
<span class="lineNum">     122 </span>                :            : }
<a name="123"><span class="lineNum">     123 </span>                :            : </a>
<span class="lineNum">     124 </span>                :            : static void
<span class="lineNum">     125 </span>                :<span class="lineCov">         10 : do_disconnected(int argc OVS_UNUSED, char *argv[])</span>
<span class="lineNum">     126 </span>                :            : {
<span class="lineNum">     127 </span>                :<span class="lineCov">         10 :     reconnect_disconnected(reconnect, now, error_from_string(argv[1]));</span>
<span class="lineNum">     128 </span>                :<span class="lineCov">         10 : }</span>
<a name="129"><span class="lineNum">     129 </span>                :            : </a>
<span class="lineNum">     130 </span>                :            : static void
<span class="lineNum">     131 </span>                :<span class="lineCov">         16 : do_connecting(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     132 </span>                :            : {
<span class="lineNum">     133 </span>                :<span class="lineCov">         16 :     reconnect_connecting(reconnect, now);</span>
<span class="lineNum">     134 </span>                :<span class="lineCov">         16 : }</span>
<a name="135"><span class="lineNum">     135 </span>                :            : </a>
<span class="lineNum">     136 </span>                :            : static void
<span class="lineNum">     137 </span>                :<span class="lineCov">         14 : do_connect_failed(int argc OVS_UNUSED, char *argv[])</span>
<span class="lineNum">     138 </span>                :            : {
<span class="lineNum">     139 </span>                :<span class="lineCov">         14 :     reconnect_connect_failed(reconnect, now, error_from_string(argv[1]));</span>
<span class="lineNum">     140 </span>                :<span class="lineCov">         14 : }</span>
<a name="141"><span class="lineNum">     141 </span>                :            : </a>
<span class="lineNum">     142 </span>                :            : static void
<span class="lineNum">     143 </span>                :<span class="lineCov">         10 : do_connected(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     144 </span>                :            : {
<span class="lineNum">     145 </span>                :<span class="lineCov">         10 :     reconnect_connected(reconnect, now);</span>
<span class="lineNum">     146 </span>                :<span class="lineCov">         10 : }</span>
<a name="147"><span class="lineNum">     147 </span>                :            : </a>
<span class="lineNum">     148 </span>                :            : static void
<span class="lineNum">     149 </span>                :<span class="lineCov">          8 : do_activity(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     150 </span>                :            : {
<span class="lineNum">     151 </span>                :<span class="lineCov">          8 :     reconnect_activity(reconnect, now);</span>
<span class="lineNum">     152 </span>                :<span class="lineCov">          8 : }</span>
<a name="153"><span class="lineNum">     153 </span>                :            : </a>
<span class="lineNum">     154 </span>                :            : static void
<span class="lineNum">     155 </span>                :<span class="lineCov">         79 : do_run(int argc, char *argv[])</span>
<span class="lineNum">     156 </span>                :            : {
<span class="lineNum">     157 </span>                :            :     enum reconnect_action action;
<span class="lineNum">     158 </span>                :            : 
<span class="lineNum">     159 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 79 times"> + </span>]:<span class="lineCov">         79 :     if (argc &gt; 1) {</span>
<span class="lineNum">     160 </span>                :<span class="lineNoCov">          0 :         now += atoi(argv[1]);</span>
<span class="lineNum">     161 </span>                :            :     }
<span class="lineNum">     162 </span>                :            : 
<span class="lineNum">     163 </span>                :<span class="lineCov">         79 :     action = reconnect_run(reconnect, now);</span>
<span class="lineNum">     164 </span>  [<span class="branchCov" title="Branch 0 was taken 22 times"> + </span><span class="branchCov" title="Branch 1 was taken 31 times"> + </span><span class="branchCov" title="Branch 2 was taken 19 times"> + </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">         79 :     switch (action) {</span>
<span class="lineNum">     165 </span>                :            :     default:
<span class="lineNum">     166 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 22 times"> + </span>]:<span class="lineCov">         22 :         if (action != 0) {</span>
<span class="lineNum">     167 </span>                :<span class="lineNoCov">          0 :             OVS_NOT_REACHED();</span>
<span class="lineNum">     168 </span>                :            :         }
<span class="lineNum">     169 </span>                :<span class="lineCov">         22 :         break;</span>
<span class="lineNum">     170 </span>                :            : 
<span class="lineNum">     171 </span>                :            :     case RECONNECT_CONNECT:
<span class="lineNum">     172 </span>                :<span class="lineCov">         31 :         printf(&quot;  should connect\n&quot;);</span>
<span class="lineNum">     173 </span>                :<span class="lineCov">         31 :         break;</span>
<span class="lineNum">     174 </span>                :            : 
<span class="lineNum">     175 </span>                :            :     case RECONNECT_DISCONNECT:
<span class="lineNum">     176 </span>                :<span class="lineCov">         19 :         printf(&quot;  should disconnect\n&quot;);</span>
<span class="lineNum">     177 </span>                :<span class="lineCov">         19 :         break;</span>
<span class="lineNum">     178 </span>                :            : 
<span class="lineNum">     179 </span>                :            :     case RECONNECT_PROBE:
<span class="lineNum">     180 </span>                :<span class="lineCov">          7 :         printf(&quot;  should send probe\n&quot;);</span>
<span class="lineNum">     181 </span>                :<span class="lineCov">          7 :         break;</span>
<span class="lineNum">     182 </span>                :            :     }
<span class="lineNum">     183 </span>                :<span class="lineCov">         79 : }</span>
<a name="184"><span class="lineNum">     184 </span>                :            : </a>
<span class="lineNum">     185 </span>                :            : static void
<span class="lineNum">     186 </span>                :<span class="lineCov">         12 : do_advance(int argc OVS_UNUSED, char *argv[])</span>
<span class="lineNum">     187 </span>                :            : {
<span class="lineNum">     188 </span>                :<span class="lineCov">         12 :     now += atoi(argv[1]);</span>
<span class="lineNum">     189 </span>                :<span class="lineCov">         12 : }</span>
<a name="190"><span class="lineNum">     190 </span>                :            : </a>
<span class="lineNum">     191 </span>                :            : static void
<span class="lineNum">     192 </span>                :<span class="lineCov">         51 : do_timeout(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     193 </span>                :            : {
<span class="lineNum">     194 </span>                :<span class="lineCov">         51 :     int timeout = reconnect_timeout(reconnect, now);</span>
<span class="lineNum">     195 </span>        [<span class="branchCov" title="Branch 0 was taken 48 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">         51 :     if (timeout &gt;= 0) {</span>
<span class="lineNum">     196 </span>                :<span class="lineCov">         48 :         printf(&quot;  advance %d ms\n&quot;, timeout);</span>
<span class="lineNum">     197 </span>                :<span class="lineCov">         48 :         now += timeout;</span>
<span class="lineNum">     198 </span>                :            :     } else {
<span class="lineNum">     199 </span>                :<span class="lineCov">          3 :         printf(&quot;  no timeout\n&quot;);</span>
<span class="lineNum">     200 </span>                :            :     }
<span class="lineNum">     201 </span>                :<span class="lineCov">         51 : }</span>
<a name="202"><span class="lineNum">     202 </span>                :            : </a>
<span class="lineNum">     203 </span>                :            : static void
<span class="lineNum">     204 </span>                :<span class="lineCov">          2 : do_set_max_tries(int argc OVS_UNUSED, char *argv[])</span>
<span class="lineNum">     205 </span>                :            : {
<span class="lineNum">     206 </span>                :<span class="lineCov">          2 :     reconnect_set_max_tries(reconnect, atoi(argv[1]));</span>
<span class="lineNum">     207 </span>                :<span class="lineCov">          2 : }</span>
<a name="208"><span class="lineNum">     208 </span>                :            : </a>
<span class="lineNum">     209 </span>                :            : static void
<span class="lineNum">     210 </span>                :<span class="lineCov">        278 : diff_stats(const struct reconnect_stats *old,</span>
<span class="lineNum">     211 </span>                :            :            const struct reconnect_stats *new,
<span class="lineNum">     212 </span>                :            :            int delta)
<span class="lineNum">     213 </span>                :            : {
<span class="lineNum">     214 </span>        [<span class="branchCov" title="Branch 0 was taken 209 times"> + </span><span class="branchCov" title="Branch 1 was taken 69 times"> + </span>]:<span class="lineCov">        278 :     if (old-&gt;state != new-&gt;state</span>
<span class="lineNum">     215 </span>        [<span class="branchCov" title="Branch 0 was taken 150 times"> + </span><span class="branchCov" title="Branch 1 was taken 59 times"> + </span>]:<span class="lineCov">        209 :         || old-&gt;state_elapsed != new-&gt;state_elapsed</span>
<span class="lineNum">     216 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 149 times"> + </span>]:<span class="lineCov">        150 :         || old-&gt;backoff != new-&gt;backoff) {</span>
<span class="lineNum">     217 </span>                :<span class="lineCov">        129 :         printf(&quot;  in %s for %u ms (%d ms backoff)\n&quot;,</span>
<span class="lineNum">     218 </span>                :            :                new-&gt;state, new-&gt;state_elapsed, new-&gt;backoff);
<span class="lineNum">     219 </span>                :            :     }
<span class="lineNum">     220 </span>        [<span class="branchCov" title="Branch 0 was taken 278 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        278 :     if (old-&gt;creation_time != new-&gt;creation_time</span>
<span class="lineNum">     221 </span>        [<span class="branchCov" title="Branch 0 was taken 270 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>]:<span class="lineCov">        278 :         || old-&gt;last_activity != new-&gt;last_activity</span>
<span class="lineNum">     222 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 260 times"> + </span>]:<span class="lineCov">        270 :         || old-&gt;last_connected != new-&gt;last_connected) {</span>
<span class="lineNum">     223 </span>                :<span class="lineCov">         18 :         printf(&quot;  created %lld, last activity %lld, last connected %lld\n&quot;,</span>
<span class="lineNum">     224 </span>                :            :                new-&gt;creation_time, new-&gt;last_activity, new-&gt;last_connected);
<span class="lineNum">     225 </span>                :            :     }
<span class="lineNum">     226 </span>        [<span class="branchCov" title="Branch 0 was taken 268 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">        278 :     if (old-&gt;n_successful_connections != new-&gt;n_successful_connections</span>
<span class="lineNum">     227 </span>        [<span class="branchCov" title="Branch 0 was taken 254 times"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">        268 :         || old-&gt;n_attempted_connections != new-&gt;n_attempted_connections</span>
<span class="lineNum">     228 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 244 times"> + </span>]:<span class="lineCov">        254 :         || old-&gt;seqno != new-&gt;seqno) {</span>
<span class="lineNum">     229 </span>                :<span class="lineCov">         34 :         printf(&quot;  %u successful connections out of %u attempts, seqno %u\n&quot;,</span>
<span class="lineNum">     230 </span>                :            :                new-&gt;n_successful_connections, new-&gt;n_attempted_connections,
<span class="lineNum">     231 </span>                :            :                new-&gt;seqno);
<span class="lineNum">     232 </span>                :            :     }
<span class="lineNum">     233 </span>        [<span class="branchCov" title="Branch 0 was taken 20 times"> + </span><span class="branchCov" title="Branch 1 was taken 258 times"> + </span>]:<span class="lineCov">        278 :     if (old-&gt;is_connected != new-&gt;is_connected) {</span>
<span class="lineNum">     234 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">         20 :         printf(&quot;  %sconnected\n&quot;, new-&gt;is_connected ? &quot;&quot; : &quot;dis&quot;);</span>
<span class="lineNum">     235 </span>                :            :     }
<span class="lineNum">     236 </span>        [<span class="branchCov" title="Branch 0 was taken 268 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">        278 :     if (old-&gt;last_connected != new-&gt;last_connected</span>
<span class="lineNum">     237 </span>        [<span class="branchCov" title="Branch 0 was taken 30 times"> + </span><span class="branchCov" title="Branch 1 was taken 238 times"> + </span>]:<span class="lineCov">        268 :         || (old-&gt;msec_since_connect != new-&gt;msec_since_connect - delta</span>
<span class="lineNum">     238 </span>[<span class="branchCov" title="Branch 0 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 30 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         30 :             &amp;&amp; !(old-&gt;msec_since_connect == UINT_MAX</span>
<span class="lineNum">     239 </span>                :<span class="lineCov">         30 :                  &amp;&amp; new-&gt;msec_since_connect == UINT_MAX))</span>
<span class="lineNum">     240 </span>        [<span class="branchCov" title="Branch 0 was taken 36 times"> + </span><span class="branchCov" title="Branch 1 was taken 232 times"> + </span>]:<span class="lineCov">        268 :         || (old-&gt;total_connected_duration != new-&gt;total_connected_duration - delta</span>
<span class="lineNum">     241 </span>[<span class="branchCov" title="Branch 0 was taken 30 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 30 times"> + </span>]:<span class="lineCov">         36 :             &amp;&amp; !(old-&gt;total_connected_duration == 0</span>
<span class="lineNum">     242 </span>                :<span class="lineCov">         30 :                  &amp;&amp; new-&gt;total_connected_duration == 0))) {</span>
<span class="lineNum">     243 </span>                :<span class="lineCov">         16 :         printf(&quot;  last connected %u ms ago, connected %u ms total\n&quot;,</span>
<span class="lineNum">     244 </span>                :            :                new-&gt;msec_since_connect, new-&gt;total_connected_duration);
<span class="lineNum">     245 </span>                :            :     }
<span class="lineNum">     246 </span>        [<span class="branchCov" title="Branch 0 was taken 268 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">        278 :     if (old-&gt;last_disconnected != new-&gt;last_disconnected</span>
<span class="lineNum">     247 </span>        [<span class="branchCov" title="Branch 0 was taken 48 times"> + </span><span class="branchCov" title="Branch 1 was taken 220 times"> + </span>]:<span class="lineCov">        268 :         || (old-&gt;msec_since_disconnect != new-&gt;msec_since_disconnect - delta</span>
<span class="lineNum">     248 </span>[<span class="branchCov" title="Branch 0 was taken 48 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 48 times"> + </span>]:<span class="lineCov">         48 :             &amp;&amp; !(old-&gt;msec_since_disconnect == UINT_MAX</span>
<span class="lineNum">     249 </span>                :<span class="lineCov">         48 :                  &amp;&amp; new-&gt;msec_since_disconnect == UINT_MAX))) {</span>
<span class="lineNum">     250 </span>                :<span class="lineCov">         10 :         printf(&quot;  disconnected at %llu ms (%u ms ago)\n&quot;,</span>
<span class="lineNum">     251 </span>                :            :                new-&gt;last_disconnected, new-&gt;msec_since_disconnect);
<span class="lineNum">     252 </span>                :            :     }
<span class="lineNum">     253 </span>                :<span class="lineCov">        278 : }</span>
<a name="254"><span class="lineNum">     254 </span>                :            : </a>
<span class="lineNum">     255 </span>                :            : static void
<span class="lineNum">     256 </span>                :<span class="lineCov">          1 : do_set_passive(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     257 </span>                :            : {
<span class="lineNum">     258 </span>                :<span class="lineCov">          1 :     reconnect_set_passive(reconnect, true, now);</span>
<span class="lineNum">     259 </span>                :<span class="lineCov">          1 : }</span>
<a name="260"><span class="lineNum">     260 </span>                :            : </a>
<span class="lineNum">     261 </span>                :            : static void
<span class="lineNum">     262 </span>                :<span class="lineCov">          3 : do_listening(int argc OVS_UNUSED, char *argv[] OVS_UNUSED)</span>
<span class="lineNum">     263 </span>                :            : {
<span class="lineNum">     264 </span>                :<span class="lineCov">          3 :     reconnect_listening(reconnect, now);</span>
<span class="lineNum">     265 </span>                :<span class="lineCov">          3 : }</span>
<a name="266"><span class="lineNum">     266 </span>                :            : </a>
<span class="lineNum">     267 </span>                :            : static void
<span class="lineNum">     268 </span>                :<span class="lineCov">          1 : do_listen_error(int argc OVS_UNUSED, char *argv[])</span>
<span class="lineNum">     269 </span>                :            : {
<span class="lineNum">     270 </span>                :<span class="lineCov">          1 :     reconnect_listen_error(reconnect, now, atoi(argv[1]));</span>
<span class="lineNum">     271 </span>                :<span class="lineCov">          1 : }</span>
<span class="lineNum">     272 </span>                :            : 
<span class="lineNum">     273 </span>                :            : static const struct command all_commands[] = {
<span class="lineNum">     274 </span>                :            :     { &quot;enable&quot;, 0, 0, do_enable },
<span class="lineNum">     275 </span>                :            :     { &quot;disable&quot;, 0, 0, do_disable },
<span class="lineNum">     276 </span>                :            :     { &quot;force-reconnect&quot;, 0, 0, do_force_reconnect },
<span class="lineNum">     277 </span>                :            :     { &quot;disconnected&quot;, 0, 1, do_disconnected },
<span class="lineNum">     278 </span>                :            :     { &quot;connecting&quot;, 0, 0, do_connecting },
<span class="lineNum">     279 </span>                :            :     { &quot;connect-failed&quot;, 0, 1, do_connect_failed },
<span class="lineNum">     280 </span>                :            :     { &quot;connected&quot;, 0, 0, do_connected },
<span class="lineNum">     281 </span>                :            :     { &quot;activity&quot;, 0, 0, do_activity },
<span class="lineNum">     282 </span>                :            :     { &quot;run&quot;, 0, 1, do_run },
<span class="lineNum">     283 </span>                :            :     { &quot;advance&quot;, 1, 1, do_advance },
<span class="lineNum">     284 </span>                :            :     { &quot;timeout&quot;, 0, 0, do_timeout },
<span class="lineNum">     285 </span>                :            :     { &quot;set-max-tries&quot;, 1, 1, do_set_max_tries },
<span class="lineNum">     286 </span>                :            :     { &quot;passive&quot;, 0, 0, do_set_passive },
<span class="lineNum">     287 </span>                :            :     { &quot;listening&quot;, 0, 0, do_listening },
<span class="lineNum">     288 </span>                :            :     { &quot;listen-error&quot;, 1, 1, do_listen_error },
<span class="lineNum">     289 </span>                :            :     { NULL, 0, 0, NULL },
<span class="lineNum">     290 </span>                :            : };
<a name="291"><span class="lineNum">     291 </span>                :            : </a>
<span class="lineNum">     292 </span>                :            : static const struct command *
<span class="lineNum">     293 </span>                :<span class="lineCov">        218 : get_all_commands(void)</span>
<span class="lineNum">     294 </span>                :            : {
<span class="lineNum">     295 </span>                :<span class="lineCov">        218 :     return all_commands;</span>
<a name="296"><span class="lineNum">     296 </span>                :            : }</a>
<span class="lineNum">     297 </span>                :            : 
<span class="lineNum">     298 </span>                :<span class="lineCov">        478 : OVSTEST_REGISTER(&quot;test-reconnect&quot;, test_reconnect_main);</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.9</a></td></tr>
  </table>
  <br>

</body>
</html>
